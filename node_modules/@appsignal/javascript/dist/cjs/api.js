"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var environment_1 = require("./environment");
var url_1 = require("./utils/url");
var xdomain_1 = require("./transports/xdomain");
var xhr_1 = require("./transports/xhr");
var fetch_1 = require("./transports/fetch");
var PushApi = (function () {
    function PushApi(options) {
        this._uri = options.uri || "https://appsignal-endpoint.net/collect";
        this._apiKey = options.key;
        this._clientVersion = options.version;
        this._transport = this._createTransport();
    }
    PushApi.prototype.push = function (span) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4, this._transport.send(span.toJSON())];
                    case 1:
                        _a.sent();
                        return [2, span];
                }
            });
        });
    };
    PushApi.prototype._createTransport = function () {
        var url = this._url();
        switch (environment_1.Environment.transport()) {
            case "XDomainRequest":
                return new xdomain_1.XDomainTransport(url);
            case "XMLHttpRequest":
                return new xhr_1.XHRTransport(url);
            default:
                return new fetch_1.FetchTransport(url);
        }
    };
    PushApi.prototype._url = function () {
        var auth = this._authorization();
        return this._uri + "?" + url_1.urlEncode(auth);
    };
    PushApi.prototype._authorization = function () {
        return {
            api_key: this._apiKey,
            version: this._clientVersion
        };
    };
    return PushApi;
}());
exports.PushApi = PushApi;
//# sourceMappingURL=api.js.map