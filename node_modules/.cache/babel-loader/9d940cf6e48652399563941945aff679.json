{"ast":null,"code":"import _objectSpread from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/accountingPeriods/index.js\";\n// Libraries\nimport React, { Component } from 'react';\nimport { browserHistory, Link } from 'react-router';\nimport accounting from 'accounting';\nimport classNames from 'classnames';\nimport { resetScroll } from 'utils'; // Components\n\nimport Card from 'shared/card';\nimport { STEPS_PERIOD, STEPS_PERIOD_NUMBER } from 'shared/catalogs';\nimport Paginator from 'shared/paginator';\nimport Modal from 'shared/modal'; // Stores\n\nimport AccountingPeriodsStore from 'stores/accountingPeriods'; // Acctions\n\nimport AccountingPeriodsActions from 'actions/accountingPeriods';\nimport moment from 'moment';\nimport pluralize from 'pluralize';\nvar STEPS = ['received_account_statement', 'accounting_done', 'accounting_accepted', 'tax_statement_done'];\n/**\n *\n * @param {AccountingPeriod} period\n */\n\nvar formatPeriod = function formatPeriod(_ref) {\n  var month = _ref.month,\n      year = _ref.year,\n      type = _ref.term_type;\n\n  switch (type) {\n    case 'monthly':\n      return moment({\n        month: month - 1,\n        year: year\n      }).format('MMMM YYYY');\n\n    case 'bimonthly':\n      var initMonth = moment({\n        month: month - 1,\n        year: year\n      }).format('MMMM');\n      var lastMonth = moment({\n        month: month,\n        year: year\n      }).format('MMMM YYYY');\n      return \"\".concat(initMonth, \"-\").concat(lastMonth);\n\n    default:\n      break;\n  }\n};\n\nfunction getCurrentState() {\n  var accountingPeriods = AccountingPeriodsStore.getAccountingPeriods();\n  var totalPages = AccountingPeriodsStore.getTotalPages();\n  var totalItems = AccountingPeriodsStore.getTotalItems();\n  return {\n    accountingPeriods: accountingPeriods,\n    totalItems: totalItems,\n    totalPages: totalPages\n  };\n}\n/**\n * @typedef {import('api').AccountingPeriod} AccountingPeriod\n * @typedef {import('api').Pagination} Pagination\n * @typedef {{}} Props\n * @typedef {{accountingPeriods: AccountingPeriod[], pagination: Pagination | null}} State\n\n * @extends {Component<Props, State>}\n */\n\n\nvar AccountingPeriods =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(AccountingPeriods, _Component);\n\n  function AccountingPeriods() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, AccountingPeriods);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(AccountingPeriods)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = _objectSpread({}, getCurrentState(), {\n      referralPromoActive: true\n    });\n\n    _this._onChange = function () {\n      // When the store changes, the state goes to it and pulls the updated data\n      // then sets it so the component rerender\n      var state = getCurrentState();\n\n      _this.setState(state);\n    };\n\n    _this.handleReferralPromo = function () {\n      var currentDay = moment().date();\n\n      if (currentDay > 15) {\n        _this.setState({\n          referralPromoActive: false\n        });\n      }\n    };\n\n    _this.toggleReferralPromo = function () {\n      _this.setState(function (state) {\n        return {\n          referralPromoActive: !state.referralPromoActive\n        };\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(AccountingPeriods, [{\n    key: \"componentDidMount\",\n\n    /**\n     *  Call accountiong periods list\n     *  And evaluate if needs to show the referral promo\n     */\n    value: function componentDidMount() {\n      // Adds listener, when the Store changes, trigger the _onChange callback func\n      AccountingPeriodsStore.addChangeListener(this._onChange);\n      this.loadData();\n      this.handleReferralPromo();\n      resetScroll();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.location.search !== prevProps.location.search) {\n        this.loadData();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Removes the listener to avoid memory leaks\n      AccountingPeriodsStore.removeChangeListener(this._onChange);\n    }\n  }, {\n    key: \"loadData\",\n    // Request email list page to the API\n    value: function loadData() {\n      var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.props;\n      var params = Object.assign({}, props.location.query);\n      AccountingPeriodsActions.getAccoutingPeriods(params);\n    }\n  }, {\n    key: \"goPeriod\",\n    value: function goPeriod(periodID) {\n      browserHistory.push(\"/mi-contabilidad/\".concat(periodID, \"/ver\"));\n    }\n  }, {\n    key: \"renderReferralPromo\",\n    value: function renderReferralPromo() {\n      var referralPromoActive = this.state.referralPromoActive;\n      return React.createElement(Modal, {\n        isActive: referralPromoActive,\n        toggleModal: this.toggleReferralPromo,\n        noFooter: true,\n        isAlert: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"columns referral-promo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column is-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        className: \"referral-promo__title brake-line\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }, \"Ahorra una mensualidad con nuestra \"), React.createElement(\"span\", {\n        className: \"referral-promo__title--highlight\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, \"Promoci\\xF3n de referidos\")), React.createElement(\"div\", {\n        className: \"columns is-centered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column is-6\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: \"img/referralPromo.svg\",\n        alt: 'Promoci√≥n de referidos',\n        className: \"referral-promo__img\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }))), React.createElement(\"p\", {\n        className: \"referral-promo__subtitle\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, \"\\xA1Es r\\xE1pido y sencillo!\"), React.createElement(\"p\", {\n        className: \"referral-promo__content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, \"Refiere a un conocido y si se vuelve cliente de Enconta te regalamos una mensualidad de tu servicio. *\"), React.createElement(Link, {\n        to: \"https://docs.google.com/forms/d/e/1FAIpQLSewxoMXBGAV_rfppnVeUgr5zsW_Oj4aG4LRFEMUrVUnkUl_Lw/viewform?usp=sf_link\",\n        className: \"referral-promo__link\",\n        target: '_blank',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }, \"Registrar referido\"), React.createElement(\"p\", {\n        className: \"caption\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, \"*Aplican restricciones.\"))));\n    } // Render table\n\n  }, {\n    key: \"renderTable\",\n    value: function renderTable() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          accountingPeriods = _this$state.accountingPeriods,\n          totalPages = _this$state.totalPages;\n      var location = this.props.location;\n\n      if (!accountingPeriods || accountingPeriods.length === 0) {\n        return React.createElement(\"div\", {\n          className: \"block unselectable\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        }, \"No hay periodos\"));\n      }\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, React.createElement(\"table\", {\n        className: \"table is-fullwidth\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        className: \"align-left\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, \"Periodo\"), React.createElement(\"th\", {\n        className: \"align-left\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"Paso Actual\"), React.createElement(\"th\", {\n        className: \"has-text-left\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, \" Estatus\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }))), React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, accountingPeriods.map(function (period) {\n        var id = period.id,\n            currentStep = period.actual_step;\n        return React.createElement(\"tr\", {\n          key: id,\n          className: \"current-month\",\n          onClick: function onClick() {\n            return _this2.goPeriod(id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          className: \"align-left\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          className: \"monthPeriod\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 202\n          },\n          __self: this\n        }, formatPeriod(period))), React.createElement(\"td\", {\n          className: \"align-left\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 204\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          className: \"infoPeriods\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205\n          },\n          __self: this\n        }, STEPS_PERIOD_NUMBER[currentStep]), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 208\n          },\n          __self: this\n        }, STEPS.map(function (step, index, array) {\n          if (step === currentStep) return true;\n          return index < array.indexOf(currentStep);\n        }).map(function (step, i) {\n          return React.createElement(\"div\", {\n            key: i,\n            className: classNames('accountabilityPeriods--periodStep', {\n              'accountabilityPeriods--periodStep-completed': step\n            }),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 214\n            },\n            __self: this\n          });\n        }))), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 226\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          className: \"has-text-left\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 227\n          },\n          __self: this\n        }, STEPS_PERIOD[currentStep])), React.createElement(\"td\", {\n          className: \"align-right\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 229\n          },\n          __self: this\n        }, React.createElement(\"p\", {\n          className: \"accounting-periods-go flex-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 230\n          },\n          __self: this\n        }, React.createElement(\"i\", {\n          className: \"mdi mdi-arrow-right mdi-18px\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 231\n          },\n          __self: this\n        }), \"IR\")));\n      }))), React.createElement(Paginator, {\n        totalPages: totalPages,\n        location: location,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }));\n    } // Main render\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var totalItems = this.state.totalItems;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        className: \"headline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }, \"Mi contabilidad\"), React.createElement(Card, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250\n        },\n        __self: this\n      }, totalItems && React.createElement(\"p\", {\n        className: \"infoPeriods\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"infoPeriods infoPeriods--semibold\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, accounting.formatNumber(totalItems)), ' ', \"\".concat(pluralize('periodo', totalItems), \" \").concat(pluralize('activo', totalItems))), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262\n        },\n        __self: this\n      }), this.renderTable()), this.renderReferralPromo());\n    }\n  }]);\n\n  return AccountingPeriods;\n}(Component);\n\nexport { AccountingPeriods as default };","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/accountingPeriods/index.js"],"names":["React","Component","browserHistory","Link","accounting","classNames","resetScroll","Card","STEPS_PERIOD","STEPS_PERIOD_NUMBER","Paginator","Modal","AccountingPeriodsStore","AccountingPeriodsActions","moment","pluralize","STEPS","formatPeriod","month","year","type","term_type","format","initMonth","lastMonth","getCurrentState","accountingPeriods","getAccountingPeriods","totalPages","getTotalPages","totalItems","getTotalItems","AccountingPeriods","state","referralPromoActive","_onChange","setState","handleReferralPromo","currentDay","date","toggleReferralPromo","addChangeListener","loadData","prevProps","props","location","search","removeChangeListener","params","Object","assign","query","getAccoutingPeriods","periodID","push","length","map","period","id","currentStep","actual_step","goPeriod","step","index","array","indexOf","i","formatNumber","renderTable","renderReferralPromo"],"mappings":"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","sourcesContent":["// Libraries\nimport React, { Component } from 'react'\nimport { browserHistory, Link } from 'react-router'\nimport accounting from 'accounting'\nimport classNames from 'classnames'\nimport { resetScroll } from 'utils'\n// Components\nimport Card from 'shared/card'\nimport { STEPS_PERIOD, STEPS_PERIOD_NUMBER } from 'shared/catalogs'\nimport Paginator from 'shared/paginator'\nimport Modal from 'shared/modal'\n\n// Stores\nimport AccountingPeriodsStore from 'stores/accountingPeriods'\n// Acctions\nimport AccountingPeriodsActions from 'actions/accountingPeriods'\n\nimport moment from 'moment'\nimport pluralize from 'pluralize'\n\nconst STEPS = [\n  'received_account_statement',\n  'accounting_done',\n  'accounting_accepted',\n  'tax_statement_done'\n]\n\n/**\n *\n * @param {AccountingPeriod} period\n */\nconst formatPeriod = ({ month, year, term_type: type }) => {\n  switch (type) {\n    case 'monthly':\n      return moment({ month: month - 1, year }).format('MMMM YYYY')\n    case 'bimonthly':\n      const initMonth = moment({ month: month - 1, year }).format('MMMM')\n      const lastMonth = moment({ month: month, year }).format('MMMM YYYY')\n      return `${initMonth}-${lastMonth}`\n    default:\n      break\n  }\n}\n\nfunction getCurrentState () {\n  const accountingPeriods = AccountingPeriodsStore.getAccountingPeriods()\n  const totalPages = AccountingPeriodsStore.getTotalPages()\n  const totalItems = AccountingPeriodsStore.getTotalItems()\n  return {\n    accountingPeriods,\n    totalItems,\n    totalPages\n  }\n}\n/**\n * @typedef {import('api').AccountingPeriod} AccountingPeriod\n * @typedef {import('api').Pagination} Pagination\n * @typedef {{}} Props\n * @typedef {{accountingPeriods: AccountingPeriod[], pagination: Pagination | null}} State\n\n * @extends {Component<Props, State>}\n */\nexport default class AccountingPeriods extends Component {\n  /**\n   * @type {State}\n   */\n  state = { ...getCurrentState(), referralPromoActive: true }\n  /**\n   *  Call accountiong periods list\n   *  And evaluate if needs to show the referral promo\n   */\n\n  componentDidMount () {\n    // Adds listener, when the Store changes, trigger the _onChange callback func\n    AccountingPeriodsStore.addChangeListener(this._onChange)\n    this.loadData()\n    this.handleReferralPromo()\n    resetScroll()\n  }\n\n  componentDidUpdate (prevProps) {\n    if (this.props.location.search !== prevProps.location.search) {\n      this.loadData()\n    }\n  }\n\n  componentWillUnmount () {\n    // Removes the listener to avoid memory leaks\n    AccountingPeriodsStore.removeChangeListener(this._onChange)\n  }\n\n  _onChange = () => {\n    // When the store changes, the state goes to it and pulls the updated data\n    // then sets it so the component rerender\n    const state = getCurrentState()\n    this.setState(state)\n  }\n\n  /**\n   * It shows the promotion only the first 15 days of month\n   */\n  handleReferralPromo = () => {\n    const currentDay = moment().date()\n    if (currentDay > 15) {\n      this.setState({ referralPromoActive: false })\n    }\n  }\n  // Request email list page to the API\n  loadData (props = this.props) {\n    const params = Object.assign({}, props.location.query)\n\n    AccountingPeriodsActions.getAccoutingPeriods(params)\n  }\n\n  goPeriod (periodID) {\n    browserHistory.push(`/mi-contabilidad/${periodID}/ver`)\n  }\n\n  toggleReferralPromo = () => {\n    this.setState(state => ({ referralPromoActive: !state.referralPromoActive }))\n  }\n\n  renderReferralPromo () {\n    const { referralPromoActive } = this.state\n    return (\n      <Modal\n        isActive={referralPromoActive}\n        toggleModal={this.toggleReferralPromo}\n        noFooter\n        isAlert\n      >\n        <div className='columns referral-promo'>\n          <div className='column is-12'>\n            <p className='referral-promo__title brake-line'>\n              <span>Ahorra una mensualidad con nuestra </span>\n              <span className='referral-promo__title--highlight'>\n                Promoci√≥n de referidos\n              </span>\n            </p>\n            <div className='columns is-centered'>\n              <div className='column is-6'>\n                <img\n                  src={`img/referralPromo.svg`}\n                  alt={'Promoci√≥n de referidos'}\n                  className='referral-promo__img'\n                />\n              </div>\n            </div>\n            <p className='referral-promo__subtitle'>¬°Es r√°pido y sencillo!</p>\n            <p className='referral-promo__content'>\n              Refiere a un conocido y si se vuelve cliente de Enconta te\n              regalamos una mensualidad de tu servicio. *\n            </p>\n\n            <Link\n              to='https://docs.google.com/forms/d/e/1FAIpQLSewxoMXBGAV_rfppnVeUgr5zsW_Oj4aG4LRFEMUrVUnkUl_Lw/viewform?usp=sf_link'\n              className='referral-promo__link'\n              target={'_blank'}\n            >\n              Registrar referido\n            </Link>\n            <p className='caption'>*Aplican restricciones.</p>\n          </div>\n        </div>\n      </Modal>\n    )\n  }\n\n  // Render table\n  renderTable () {\n    const { accountingPeriods, totalPages } = this.state\n    const { location } = this.props\n    if (!accountingPeriods || accountingPeriods.length === 0) {\n      return (\n        <div className='block unselectable'>\n          <p>No hay periodos</p>\n        </div>\n      )\n    }\n\n    return (\n      <div>\n        <table className='table is-fullwidth'>\n          <thead>\n            <tr>\n              <th className='align-left'>Periodo</th>\n              <th className='align-left'>Paso Actual</th>\n              <th className='has-text-left'> Estatus</th>\n              <th />\n            </tr>\n          </thead>\n          <tbody>\n            {accountingPeriods.map(period => {\n              const { id, actual_step: currentStep } = period\n              return (\n                <tr\n                  key={id}\n                  className='current-month'\n                  onClick={() => this.goPeriod(id)}\n                >\n                  <td className='align-left'>\n                    <p className='monthPeriod'>{formatPeriod(period)}</p>\n                  </td>\n                  <td className='align-left'>\n                    <p className='infoPeriods'>\n                      {STEPS_PERIOD_NUMBER[currentStep]}\n                    </p>\n                    <div>\n                      {STEPS.map((step, index, array) => {\n                        if (step === currentStep) return true\n\n                        return index < array.indexOf(currentStep)\n                      }).map((step, i) => (\n                        <div\n                          key={i}\n                          className={classNames(\n                            'accountabilityPeriods--periodStep',\n                            {\n                              'accountabilityPeriods--periodStep-completed': step\n                            }\n                          )}\n                        />\n                      ))}\n                    </div>\n                  </td>\n                  <td>\n                    <p className='has-text-left'>{STEPS_PERIOD[currentStep]}</p>\n                  </td>\n                  <td className='align-right'>\n                    <p className='accounting-periods-go flex-center'>\n                      <i className='mdi mdi-arrow-right mdi-18px' />\n                      IR\n                    </p>\n                  </td>\n                </tr>\n              )\n            })}\n          </tbody>\n        </table>\n        <Paginator totalPages={totalPages} location={location} />\n      </div>\n    )\n  }\n  // Main render\n  render () {\n    const { totalItems } = this.state\n    return (\n      <div>\n        <h1 className='headline'>Mi contabilidad</h1>\n        <Card>\n          {totalItems && (\n            <p className='infoPeriods'>\n              <span className='infoPeriods infoPeriods--semibold'>\n                {accounting.formatNumber(totalItems)}\n              </span>{' '}\n              {`${pluralize('periodo', totalItems)} ${pluralize(\n                'activo',\n                totalItems\n              )}`}\n            </p>\n          )}\n          <br />\n          {this.renderTable()}\n        </Card>\n        {this.renderReferralPromo()}\n      </div>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}