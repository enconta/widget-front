{"ast":null,"code":"import _regeneratorRuntime from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nvar _filters,\n    _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/reports/rankings/components/Ranking.js\";\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport RankingFilters from './RankingFilters';\nimport Table from './Table';\nimport { prettyDiffPeriod } from 'utils';\nimport { calculateDates, calculateQuery, calculatePositions } from '../utils';\nimport moment from 'moment';\nimport API from 'api';\nimport { RANGE_KEY, PERIOD_KEY, MONTH_KEY, YEAR_KEY, RANGE, PERIODS } from '../../constants';\nvar defaultState = {\n  filters: (_filters = {}, _defineProperty(_filters, PERIOD_KEY, PERIODS[0].id), _defineProperty(_filters, MONTH_KEY, moment().format('MM')), _defineProperty(_filters, YEAR_KEY, moment().format('YYYY')), _defineProperty(_filters, RANGE_KEY, RANGE[1].id), _filters),\n  data: {\n    current_report: [],\n    last_report: []\n  },\n  loading: true\n};\n\nvar Ranking =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Ranking, _Component);\n\n  function Ranking() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Ranking);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Ranking)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = _objectSpread({}, defaultState);\n\n    _this.onChangeFilter = function (filter, value) {\n      _this.setState(function (state) {\n        return _objectSpread({}, state, {\n          filters: _objectSpread({}, state.filters, _defineProperty({}, filter, value))\n        });\n      }, _this.loadData);\n    };\n\n    _this.componentDidUpdate = function (prevProps) {\n      if (_this.props.type !== prevProps.type) {\n        _this.loadData();\n      }\n    };\n\n    _this.loadData =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var filters,\n          data,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              filters = _args.length > 0 && _args[0] !== undefined ? _args[0] : _this.state.filters;\n\n              _this.setState({\n                loading: true\n              });\n\n              _context.next = 4;\n              return API.Reports.Rankings(calculateQuery(filters));\n\n            case 4:\n              data = _context.sent;\n\n              _this.setState({\n                data: data,\n                loading: false\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _this;\n  }\n\n  _createClass(Ranking, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.loadData(this.state.filters);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var type = this.props.type;\n      var _this$state = this.state,\n          data = _this$state.data,\n          filters = _this$state.filters,\n          loading = _this$state.loading;\n      var dataSource = data.current_report.map(calculatePositions(data.last_report));\n\n      var _calculateDates = calculateDates(filters),\n          lastStartMonth = _calculateDates.lastStartMonth,\n          lastEndMonth = _calculateDates.lastEndMonth,\n          startMonth = _calculateDates.startMonth,\n          endMonth = _calculateDates.endMonth;\n\n      var currentPeriod = prettyDiffPeriod(startMonth, endMonth, true);\n      var lastPeriod = prettyDiffPeriod(lastStartMonth, lastEndMonth, true);\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96\n        },\n        __self: this\n      }, React.createElement(RankingFilters, {\n        onChangeFilter: this.onChangeFilter,\n        filters: filters,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }), loading ? React.createElement(\"i\", {\n        className: \"mdi mdi-loading mdi-spin mdi-18px mdi-dark\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }) : React.createElement(Table, {\n        type: type,\n        currentPeriod: currentPeriod,\n        lastPeriod: lastPeriod,\n        data: dataSource,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Ranking;\n}(Component);\n\nRanking.propTypes = {\n  type: PropTypes.string.isRequired\n};\n\nRanking.getDerivedStateFromProps = function (nextProps, prevState) {\n  return _objectSpread({}, prevState, {\n    filters: _objectSpread({}, prevState.filters, {\n      type: nextProps.type\n    })\n  });\n};\n\nexport { Ranking as default };","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/reports/rankings/components/Ranking.js"],"names":["React","Component","PropTypes","RankingFilters","Table","prettyDiffPeriod","calculateDates","calculateQuery","calculatePositions","moment","API","RANGE_KEY","PERIOD_KEY","MONTH_KEY","YEAR_KEY","RANGE","PERIODS","defaultState","filters","id","format","data","current_report","last_report","loading","Ranking","state","onChangeFilter","filter","value","setState","loadData","componentDidUpdate","prevProps","props","type","Reports","Rankings","dataSource","map","lastStartMonth","lastEndMonth","startMonth","endMonth","currentPeriod","lastPeriod","propTypes","string","isRequired","getDerivedStateFromProps","nextProps","prevState"],"mappings":";;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AAEA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAASC,gBAAT,QAAiC,OAAjC;AACA,SAASC,cAAT,EAAyBC,cAAzB,EAAyCC,kBAAzC,QAAmE,UAAnE;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,OAAOC,GAAP,MAAgB,KAAhB;AAEA,SACEC,SADF,EAEEC,UAFF,EAGEC,SAHF,EAIEC,QAJF,EAKEC,KALF,EAMEC,OANF,QAOO,iBAPP;AASA,IAAMC,YAAY,GAAG;AACnBC,EAAAA,OAAO,4CACJN,UADI,EACSI,OAAO,CAAC,CAAD,CAAP,CAAWG,EADpB,6BAEJN,SAFI,EAEQJ,MAAM,GAAGW,MAAT,CAAgB,IAAhB,CAFR,6BAGJN,QAHI,EAGOL,MAAM,GAAGW,MAAT,CAAgB,MAAhB,CAHP,6BAIJT,SAJI,EAIQI,KAAK,CAAC,CAAD,CAAL,CAASI,EAJjB,YADY;AAOnBE,EAAAA,IAAI,EAAE;AACJC,IAAAA,cAAc,EAAE,EADZ;AAEJC,IAAAA,WAAW,EAAE;AAFT,GAPa;AAWnBC,EAAAA,OAAO,EAAE;AAXU,CAArB;;IAcqBC,O;;;;;;;;;;;;;;;;;UAKnBC,K,qBAAaT,Y;;UAEbU,c,GAAiB,UAACC,MAAD,EAASC,KAAT,EAAmB;AAClC,YAAKC,QAAL,CACE,UAAAJ,KAAK;AAAA,iCACAA,KADA;AAEHR,UAAAA,OAAO,oBAAOQ,KAAK,CAACR,OAAb,sBAAuBU,MAAvB,EAAgCC,KAAhC;AAFJ;AAAA,OADP,EAKE,MAAKE,QALP;AAOD,K;;UAMDC,kB,GAAqB,UAAAC,SAAS,EAAI;AAChC,UAAI,MAAKC,KAAL,CAAWC,IAAX,KAAoBF,SAAS,CAACE,IAAlC,EAAwC;AACtC,cAAKJ,QAAL;AACD;AACF,K;;UASDA,Q;;;;6BAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAOb,cAAAA,OAAP,2DAAiB,MAAKQ,KAAL,CAAWR,OAA5B;;AACT,oBAAKY,QAAL,CAAc;AAAEN,gBAAAA,OAAO,EAAE;AAAX,eAAd;;AADS;AAAA,qBAGUd,GAAG,CAAC0B,OAAJ,CAAYC,QAAZ,CAAqB9B,cAAc,CAACW,OAAD,CAAnC,CAHV;;AAAA;AAGHG,cAAAA,IAHG;;AAKT,oBAAKS,QAAL,CAAc;AAAET,gBAAAA,IAAI,EAAJA,IAAF;AAAQG,gBAAAA,OAAO,EAAE;AAAjB,eAAd;;AALS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;;;;;wCAjBU;AACnB,WAAKO,QAAL,CAAc,KAAKL,KAAL,CAAWR,OAAzB;AACD;;;6BAuBS;AAAA,UACAiB,IADA,GACS,KAAKD,KADd,CACAC,IADA;AAAA,wBAE2B,KAAKT,KAFhC;AAAA,UAEAL,IAFA,eAEAA,IAFA;AAAA,UAEMH,OAFN,eAEMA,OAFN;AAAA,UAEeM,OAFf,eAEeA,OAFf;AAIR,UAAMc,UAAU,GAAGjB,IAAI,CAACC,cAAL,CAAoBiB,GAApB,CACjB/B,kBAAkB,CAACa,IAAI,CAACE,WAAN,CADD,CAAnB;;AAJQ,4BAaJjB,cAAc,CAACY,OAAD,CAbV;AAAA,UASNsB,cATM,mBASNA,cATM;AAAA,UAUNC,YAVM,mBAUNA,YAVM;AAAA,UAWNC,UAXM,mBAWNA,UAXM;AAAA,UAYNC,QAZM,mBAYNA,QAZM;;AAeR,UAAMC,aAAa,GAAGvC,gBAAgB,CAACqC,UAAD,EAAaC,QAAb,EAAuB,IAAvB,CAAtC;AACA,UAAME,UAAU,GAAGxC,gBAAgB,CAACmC,cAAD,EAAiBC,YAAjB,EAA+B,IAA/B,CAAnC;AAEA,aACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,cAAD;AACE,QAAA,cAAc,EAAE,KAAKd,cADvB;AAEE,QAAA,OAAO,EAAET,OAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAKGM,OAAO,GACN;AAAG,QAAA,SAAS,EAAC,4CAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADM,GAGN,oBAAC,KAAD;AACE,QAAA,IAAI,EAAEW,IADR;AAEE,QAAA,aAAa,EAAES,aAFjB;AAGE,QAAA,UAAU,EAAEC,UAHd;AAIE,QAAA,IAAI,EAAEP,UAJR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QARJ,CADF;AAkBD;;;;EA9EkCrC,S;;AAAhBwB,O,CACZqB,S,GAAY;AACjBX,EAAAA,IAAI,EAAEjC,SAAS,CAAC6C,MAAV,CAAiBC;AADN,C;;AADAvB,O,CA2BZwB,wB,GAA2B,UAACC,SAAD,EAAYC,SAAZ,EAA0B;AAC1D,2BACKA,SADL;AAEEjC,IAAAA,OAAO,oBAAOiC,SAAS,CAACjC,OAAjB;AAA0BiB,MAAAA,IAAI,EAAEe,SAAS,CAACf;AAA1C;AAFT;AAID,C;;SAhCkBV,O","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport RankingFilters from './RankingFilters'\n\nimport Table from './Table'\nimport { prettyDiffPeriod } from 'utils'\nimport { calculateDates, calculateQuery, calculatePositions } from '../utils'\nimport moment from 'moment'\n\nimport API from 'api'\n\nimport {\n  RANGE_KEY,\n  PERIOD_KEY,\n  MONTH_KEY,\n  YEAR_KEY,\n  RANGE,\n  PERIODS\n} from '../../constants'\n\nconst defaultState = {\n  filters: {\n    [PERIOD_KEY]: PERIODS[0].id,\n    [MONTH_KEY]: moment().format('MM'),\n    [YEAR_KEY]: moment().format('YYYY'),\n    [RANGE_KEY]: RANGE[1].id\n  },\n  data: {\n    current_report: [],\n    last_report: []\n  },\n  loading: true\n}\n\nexport default class Ranking extends Component {\n  static propTypes = {\n    type: PropTypes.string.isRequired\n  }\n\n  state = { ...defaultState }\n\n  onChangeFilter = (filter, value) => {\n    this.setState(\n      state => ({\n        ...state,\n        filters: { ...state.filters, [filter]: value }\n      }),\n      this.loadData\n    )\n  }\n\n  componentDidMount () {\n    this.loadData(this.state.filters)\n  }\n\n  componentDidUpdate = prevProps => {\n    if (this.props.type !== prevProps.type) {\n      this.loadData()\n    }\n  }\n\n  static getDerivedStateFromProps = (nextProps, prevState) => {\n    return {\n      ...prevState,\n      filters: { ...prevState.filters, type: nextProps.type }\n    }\n  }\n\n  loadData = async (filters = this.state.filters) => {\n    this.setState({ loading: true })\n\n    const data = await API.Reports.Rankings(calculateQuery(filters))\n\n    this.setState({ data, loading: false })\n  }\n\n  render () {\n    const { type } = this.props\n    const { data, filters, loading } = this.state\n\n    const dataSource = data.current_report.map(\n      calculatePositions(data.last_report)\n    )\n\n    const {\n      lastStartMonth,\n      lastEndMonth,\n      startMonth,\n      endMonth\n    } = calculateDates(filters)\n\n    const currentPeriod = prettyDiffPeriod(startMonth, endMonth, true)\n    const lastPeriod = prettyDiffPeriod(lastStartMonth, lastEndMonth, true)\n\n    return (\n      <div>\n        <RankingFilters\n          onChangeFilter={this.onChangeFilter}\n          filters={filters}\n        />\n        {loading ? (\n          <i className='mdi mdi-loading mdi-spin mdi-18px mdi-dark' />\n        ) : (\n          <Table\n            type={type}\n            currentPeriod={currentPeriod}\n            lastPeriod={lastPeriod}\n            data={dataSource}\n          />\n        )}\n      </div>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}