{"ast":null,"code":"import _toConsumableArray from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/newInvoice/complementos/ine/preCampaign/index.js\";\n// Libraries\nimport React, { Component } from 'react';\nimport update from 'immutability-helper';\nimport uuid from 'uuid'; // Components\n\nimport Button from 'shared/button';\nimport { STATE_LIST } from 'shared/catalogs';\nimport TextField from 'shared/textField';\nimport SelectField from 'shared/selectField';\nimport { removeEmpty } from 'utils';\nvar STATE_OPTIONS = STATE_LIST.filter(function (i) {\n  return i.country === 'MEX';\n});\nvar STATES_MAX = 64;\nvar STATES_MIN = 1;\nvar STATE_SCOPES = [{\n  id: 'Local',\n  label: 'Local'\n}, {\n  id: 'Federal',\n  label: 'Federal'\n}]; // Keys\n\nvar STATES = 'preCampaignStates';\nvar STATE_ID_KEY = 'entity_key';\nvar STATE_SCOPE_KEY = 'ambit';\nvar STATE_TAX_ID_KEY = 'accounting_id';\nvar TAX_ID_WRAPPER_KEY = 'ine_accounting_mgs';\nvar requiredFields = new Set();\n\nvar PreCampaign =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(PreCampaign, _Component);\n\n  function PreCampaign(props) {\n    var _this;\n\n    _classCallCheck(this, PreCampaign);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(PreCampaign).call(this, props));\n    _this.data = _defineProperty({}, STATES, []);\n    _this.state = Object.assign({}, _this.data);\n    return _this;\n  } // Add first state on mount\n\n\n  _createClass(PreCampaign, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.addState();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Clears the stored requiredFields\n      requiredFields.clear();\n    } // Iterates over required fields and validates every one of them\n    // Then it returns true if all validations succeedeed, else false.\n\n  }, {\n    key: \"validateRequiredFields\",\n    value: function validateRequiredFields() {\n      return _toConsumableArray(requiredFields) // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(function (form) {\n        return form.validate();\n      }) // Calls the validate() method on each form\n      .every(function (e) {\n        return e;\n      }); // Checks if all validations suceeded\n    } // Set target value to this.state[STATES][field]\n\n  }, {\n    key: \"onChange\",\n    value: function onChange(id, field, e) {\n      this.setState(_defineProperty({}, STATES, update(this.state[STATES], _defineProperty({}, this.state[STATES].findIndex(function (s) {\n        return s.uuid === id;\n      }), _defineProperty({}, field, {\n        $set: e.target.value\n      })))));\n    } // Add state to this.state[STATES][]\n\n  }, {\n    key: \"addState\",\n    value: function addState() {\n      var _states$push;\n\n      var states = this.state[STATES];\n      states.push((_states$push = {\n        uuid: uuid()\n      }, _defineProperty(_states$push, STATE_ID_KEY, STATE_LIST[0].state), _defineProperty(_states$push, STATE_SCOPE_KEY, STATE_SCOPES[0].id), _defineProperty(_states$push, STATE_TAX_ID_KEY, ''), _states$push));\n      this.setState(_defineProperty({}, STATES, states));\n    } // Remove state with uuid\n\n  }, {\n    key: \"deleteState\",\n    value: function deleteState(uuid, e) {\n      requiredFields.clear();\n      this.setState(_defineProperty({}, STATES, this.state[STATES].filter(function (s) {\n        return s.uuid !== uuid;\n      })));\n    } // Make inner data available to parent\n\n  }, {\n    key: \"exportData\",\n    value: function exportData() {\n      if (this.validateRequiredFields()) {\n        var data = {\n          lowData: this.state[STATES].map(function (state) {\n            var _ref2;\n\n            return _ref2 = {}, _defineProperty(_ref2, STATE_ID_KEY, state[STATE_ID_KEY]), _defineProperty(_ref2, STATE_SCOPE_KEY, state[STATE_SCOPE_KEY]), _defineProperty(_ref2, TAX_ID_WRAPPER_KEY, [_defineProperty({}, STATE_TAX_ID_KEY, state[STATE_TAX_ID_KEY])]), _ref2;\n          })\n        };\n        var cleanData = Object.assign({}, data);\n        cleanData = removeEmpty(cleanData);\n        return cleanData;\n      } else {\n        return {\n          topData: null,\n          lowData: null\n        };\n      }\n    } // Render add button if there's less than STATES_MAX states\n\n  }, {\n    key: \"renderAddButton\",\n    value: function renderAddButton() {\n      return React.createElement(\"div\", {\n        className: \"block\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, React.createElement(Button, {\n        buttonStyle: \"primaryLink\",\n        icon: \"plus\",\n        onClick: this.addState.bind(this),\n        disabled: this.state[STATES].length >= STATES_MAX,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, \"Agregar Estado\"));\n    } // Render single state\n\n  }, {\n    key: \"renderState\",\n    value: function renderState(state) {\n      var deleteIcon = {\n        icon: 'close-circle',\n        label: 'Eliminar',\n        onClick: this.deleteState.bind(this, state.uuid),\n        disabled: this.state[STATES].length <= STATES_MIN\n      };\n      return React.createElement(\"div\", {\n        className: \"columns control\",\n        key: state.uuid,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"control\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }, React.createElement(SelectField, {\n        label: \"Estado: Clave Entidad\",\n        placeholder: \"Selecciona una opci\\xF3n\",\n        options: STATE_OPTIONS,\n        value: state[STATE_ID_KEY],\n        onChange: this.onChange.bind(this, state.uuid, STATE_ID_KEY),\n        optionsConfig: {\n          id: 'state',\n          label: 'label'\n        },\n        required: true,\n        ref: function ref(r) {\n          return requiredFields.add(r);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"control\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151\n        },\n        __self: this\n      }, React.createElement(SelectField, {\n        label: \"Estado: \\xC1mbito\",\n        placeholder: \"Selecciona una opci\\xF3n\",\n        options: STATE_SCOPES,\n        value: state[STATE_SCOPE_KEY],\n        onChange: this.onChange.bind(this, state.uuid, STATE_SCOPE_KEY),\n        required: true,\n        ref: function ref(r) {\n          return requiredFields.add(r);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"control has-info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        label: \"Estado: Id de contabilidad\",\n        value: state[STATE_TAX_ID_KEY],\n        onChange: this.onChange.bind(this, state.uuid, STATE_TAX_ID_KEY),\n        type: \"number\",\n        maxLength: 6,\n        required: true,\n        ref: function ref(r) {\n          return requiredFields.add(r);\n        },\n        icon: deleteIcon,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165\n        },\n        __self: this\n      }))));\n    } // Main render\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var states = this.state[STATES];\n      var preCampaignStates = states.length > 0 ? states.map(function (state) {\n        return _this2.renderState(state);\n      }) : null;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, preCampaignStates, this.renderAddButton());\n    }\n  }]);\n\n  return PreCampaign;\n}(Component);\n\nexport default PreCampaign;","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/newInvoice/complementos/ine/preCampaign/index.js"],"names":["React","Component","update","uuid","Button","STATE_LIST","TextField","SelectField","removeEmpty","STATE_OPTIONS","filter","i","country","STATES_MAX","STATES_MIN","STATE_SCOPES","id","label","STATES","STATE_ID_KEY","STATE_SCOPE_KEY","STATE_TAX_ID_KEY","TAX_ID_WRAPPER_KEY","requiredFields","Set","PreCampaign","props","data","state","Object","assign","addState","clear","Boolean","map","form","validate","every","e","field","setState","findIndex","s","$set","target","value","states","push","validateRequiredFields","lowData","cleanData","topData","bind","length","deleteIcon","icon","onClick","deleteState","disabled","onChange","r","add","preCampaignStates","renderState","renderAddButton"],"mappings":"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","sourcesContent":["// Libraries\nimport React, { Component } from 'react'\nimport update from 'immutability-helper'\nimport uuid from 'uuid'\n\n// Components\nimport Button from 'shared/button'\nimport { STATE_LIST } from 'shared/catalogs'\nimport TextField from 'shared/textField'\nimport SelectField from 'shared/selectField'\nimport { removeEmpty } from 'utils'\n\nconst STATE_OPTIONS = STATE_LIST.filter(i => i.country === 'MEX')\nconst STATES_MAX = 64\nconst STATES_MIN = 1\n\nconst STATE_SCOPES = [\n  { id: 'Local', label: 'Local' },\n  { id: 'Federal', label: 'Federal' }\n]\n\n// Keys\nconst STATES = 'preCampaignStates'\nconst STATE_ID_KEY = 'entity_key'\nconst STATE_SCOPE_KEY = 'ambit'\nconst STATE_TAX_ID_KEY = 'accounting_id'\nconst TAX_ID_WRAPPER_KEY = 'ine_accounting_mgs'\n\nconst requiredFields = new Set()\n\nclass PreCampaign extends Component {\n  constructor (props) {\n    super(props)\n    this.data = {\n      [STATES]: []\n    }\n    this.state = Object.assign({}, this.data)\n  }\n\n  // Add first state on mount\n  componentDidMount () {\n    this.addState()\n  }\n\n  componentWillUnmount () {\n    // Clears the stored requiredFields\n    requiredFields.clear()\n  }\n\n  // Iterates over required fields and validates every one of them\n  // Then it returns true if all validations succeedeed, else false.\n  validateRequiredFields () {\n    return [...requiredFields] // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(form => form.validate()) // Calls the validate() method on each form\n      .every(e => e) // Checks if all validations suceeded\n  }\n\n  // Set target value to this.state[STATES][field]\n  onChange (id, field, e) {\n    this.setState({\n      [STATES]: update(this.state[STATES], {\n        [this.state[STATES].findIndex(s => s.uuid === id)]: {\n          [field]: { $set: e.target.value }\n        }\n      })\n    })\n  }\n\n  // Add state to this.state[STATES][]\n  addState () {\n    let states = this.state[STATES]\n    states.push({\n      uuid: uuid(),\n      [STATE_ID_KEY]: STATE_LIST[0].state,\n      [STATE_SCOPE_KEY]: STATE_SCOPES[0].id,\n      [STATE_TAX_ID_KEY]: ''\n    })\n    this.setState({ [STATES]: states })\n  }\n\n  // Remove state with uuid\n  deleteState (uuid, e) {\n    requiredFields.clear()\n    this.setState({\n      [STATES]: this.state[STATES].filter(s => s.uuid !== uuid)\n    })\n  }\n\n  // Make inner data available to parent\n  exportData () {\n    if (this.validateRequiredFields()) {\n      let data = {\n        lowData: this.state[STATES].map(state => ({\n          [STATE_ID_KEY]: state[STATE_ID_KEY],\n          [STATE_SCOPE_KEY]: state[STATE_SCOPE_KEY],\n          [TAX_ID_WRAPPER_KEY]: [\n            { [STATE_TAX_ID_KEY]: state[STATE_TAX_ID_KEY] }\n          ]\n        }))\n      }\n      let cleanData = Object.assign({}, data)\n      cleanData = removeEmpty(cleanData)\n      return cleanData\n    } else {\n      return { topData: null, lowData: null }\n    }\n  }\n\n  // Render add button if there's less than STATES_MAX states\n  renderAddButton () {\n    return (\n      <div className='block'>\n        <Button\n          buttonStyle='primaryLink'\n          icon='plus'\n          onClick={this.addState.bind(this)}\n          disabled={this.state[STATES].length >= STATES_MAX}\n        >\n          Agregar Estado\n        </Button>\n      </div>\n    )\n  }\n\n  // Render single state\n  renderState (state) {\n    let deleteIcon = {\n      icon: 'close-circle',\n      label: 'Eliminar',\n      onClick: this.deleteState.bind(this, state.uuid),\n      disabled: this.state[STATES].length <= STATES_MIN\n    }\n    return (\n      <div className='columns control' key={state.uuid}>\n        <div className='column'>\n          <div className='control'>\n            <SelectField\n              label='Estado: Clave Entidad'\n              placeholder='Selecciona una opción'\n              options={STATE_OPTIONS}\n              value={state[STATE_ID_KEY]}\n              onChange={this.onChange.bind(this, state.uuid, STATE_ID_KEY)}\n              optionsConfig={{ id: 'state', label: 'label' }}\n              required\n              ref={r => requiredFields.add(r)}\n            />\n          </div>\n        </div>\n        <div className='column'>\n          <div className='control'>\n            <SelectField\n              label='Estado: Ámbito'\n              placeholder='Selecciona una opción'\n              options={STATE_SCOPES}\n              value={state[STATE_SCOPE_KEY]}\n              onChange={this.onChange.bind(this, state.uuid, STATE_SCOPE_KEY)}\n              required\n              ref={r => requiredFields.add(r)}\n            />\n          </div>\n        </div>\n        <div className='column'>\n          <div className='control has-info'>\n            <TextField\n              label='Estado: Id de contabilidad'\n              value={state[STATE_TAX_ID_KEY]}\n              onChange={this.onChange.bind(this, state.uuid, STATE_TAX_ID_KEY)}\n              type='number'\n              maxLength={6}\n              required\n              ref={r => requiredFields.add(r)}\n              icon={deleteIcon}\n            />\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  // Main render\n  render () {\n    let states = this.state[STATES]\n    let preCampaignStates =\n      states.length > 0 ? states.map(state => this.renderState(state)) : null\n    return (\n      <div>\n        {preCampaignStates}\n        {this.renderAddButton()}\n      </div>\n    )\n  }\n}\n\nexport default PreCampaign\n"]},"metadata":{},"sourceType":"module"}