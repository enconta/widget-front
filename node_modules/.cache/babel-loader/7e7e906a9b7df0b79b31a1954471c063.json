{"ast":null,"code":"import _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/shared/satCredentials/csd.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport clipboard from 'clipboard-polyfill';\nimport update from 'immutability-helper';\nimport validator from 'validator';\nimport NotificationsActions from 'actions/notifications';\nimport SatCredentialsActions from 'actions/satCredentials';\nimport SessionStore from 'stores/session';\nimport SatCredentialsStore from 'stores/satCredentials';\nimport SelectFile from 'shared/selectFile';\nimport TextField from 'shared/textField';\nimport Button from 'shared/button';\n\nfunction getCurrentState() {\n  var currentEntity = SessionStore.getCurrentEntity();\n  var credentials = SatCredentialsStore.getCredentials();\n  var user = SessionStore.getUser();\n  return {\n    currentEntity: currentEntity,\n    credentials: credentials,\n    user: user\n  };\n}\n\nvar Csd =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Csd, _Component);\n\n  function Csd() {\n    var _this;\n\n    _classCallCheck(this, Csd);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Csd).call(this));\n    _this.data = {\n      requestInProgress: false,\n      isCsdKeyModalOpen: false,\n      isCsdCerModalOpen: false,\n      csd: {\n        key_file_password: '',\n        key_file: {\n          attached_file: '',\n          original_filename: '',\n          content_type: ''\n        },\n        cer_file: {\n          attached_file: '',\n          original_filename: '',\n          content_type: ''\n        }\n      },\n      isValid: {\n        key_file_password: true,\n        key_file: true,\n        cer_file: true\n      }\n    };\n    _this.state = Object.assign({}, _this.data, getCurrentState());\n    _this._onChange = _this._onChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Csd, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Adds listener, when the Store changes, trigger the _onChange callback func\n      SatCredentialsStore.addChangeListener(this._onChange);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Removes the listener to avoid memory leaks\n      SatCredentialsStore.removeChangeListener(this._onChange);\n    }\n  }, {\n    key: \"_onChange\",\n    value: function _onChange() {\n      // When the store changes, the state goes to it and pulls the updated data\n      // then sets it so the component rerenders\n      var state = getCurrentState();\n      this.setState(state);\n    } // Persist password to state\n\n  }, {\n    key: \"onChangeCsdPassword\",\n    value: function onChangeCsdPassword(e) {\n      this.setState({\n        csd: update(this.state.csd, {\n          key_file_password: {\n            $set: e.target.value\n          }\n        })\n      });\n    } // Toggle key modal\n\n  }, {\n    key: \"toggleCsdKeyModal\",\n    value: function toggleCsdKeyModal() {\n      this.setState({\n        isCsdKeyModalOpen: !this.state.isCsdKeyModalOpen\n      });\n    } // Toggle certificate modal\n\n  }, {\n    key: \"toggleCsdCerModal\",\n    value: function toggleCsdCerModal() {\n      this.setState({\n        isCsdCerModalOpen: !this.state.isCsdCerModalOpen\n      });\n    } // Persist key to state\n\n  }, {\n    key: \"setCsdKey\",\n    value: function setCsdKey(file, filename, mime) {\n      var key = {\n        attached_file: file,\n        original_filename: filename,\n        content_type: mime\n      };\n      this.setState({\n        csd: update(this.state.csd, {\n          key_file: {\n            $set: key\n          }\n        })\n      });\n    } // Persist certificate to state\n\n  }, {\n    key: \"setCsdCer\",\n    value: function setCsdCer(file, filename, mime) {\n      var cer = {\n        attached_file: file,\n        original_filename: filename,\n        content_type: mime\n      };\n      this.setState({\n        csd: update(this.state.csd, {\n          cer_file: {\n            $set: cer\n          }\n        })\n      });\n    } // Validate non empty key\n\n  }, {\n    key: \"isValidCsdKey\",\n    value: function isValidCsdKey() {\n      var isValid = !validator.isEmpty(this.state.csd.key_file.attached_file);\n      this.setState({\n        isValid: update(this.state.isValid, {\n          key_file: {\n            $set: isValid\n          }\n        })\n      });\n      return isValid;\n    } // Validate non empty certificate\n\n  }, {\n    key: \"isValidCsdCer\",\n    value: function isValidCsdCer() {\n      var isValid = !validator.isEmpty(this.state.csd.cer_file.attached_file);\n      this.setState({\n        isValid: update(this.state.isValid, {\n          cer_file: {\n            $set: isValid\n          }\n        })\n      });\n      return isValid;\n    } // Validate non empty password\n\n  }, {\n    key: \"isValidCsdPassword\",\n    value: function isValidCsdPassword() {\n      var isValid = !validator.isEmpty(this.state.csd.key_file_password);\n      this.setState({\n        isValid: update(this.state.isValid, {\n          key_file_password: {\n            $set: isValid\n          }\n        })\n      });\n      return isValid;\n    }\n  }, {\n    key: \"uploadCsd\",\n    value: function uploadCsd(e) {\n      var _this2 = this;\n\n      e.preventDefault();\n\n      if (this.isValidCsdKey() && this.isValidCsdCer() && this.isValidCsdPassword()) {\n        this.setState({\n          requestInProgress: true\n        }, function () {\n          SatCredentialsActions.updateSatCredentials({\n            taxable_entity: _this2.state.csd\n          }).then(function () {\n            NotificationsActions.success('CSD guardado correctamente');\n\n            _this2.setState({\n              requestInProgress: false\n            });\n\n            SatCredentialsActions.getSatCredentials();\n          }).catch(function (error) {\n            NotificationsActions.error(error);\n\n            _this2.setState({\n              requestInProgress: false\n            });\n          });\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var hidden = this.props.hideIfFull && this.state.credentials.csd && this.state.credentials.csd.key_file && this.state.credentials.csd.cer_file && this.state.credentials.csd.password;\n      var user = this.state.user;\n      return React.createElement(\"div\", {\n        className: classNames({\n          'is-hidden': hidden\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }, React.createElement(\"h5\", {\n        className: \"subtitle is-6 is-marginless\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }, \"CSD\"), React.createElement(\"div\", {\n        className: \"columns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"field\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        label: \"Contrase\\xF1a del CSD\",\n        placeholder: \"Contrase\\xF1a del CSD\",\n        type: \"password\",\n        className: classNames('input', {\n          'is-danger': !this.state.isValid.key_file_password\n        }),\n        onChange: this.onChangeCsdPassword.bind(this),\n        value: this.state.csd.key_file_password,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }), user.role !== 'sales' && React.createElement(\"a\", {\n        onClick: function onClick() {\n          clipboard.writeText(_this3.state.credentials.csd.password).then(NotificationsActions.success('Contraseña copiada al portapapeles'));\n        },\n        className: classNames({\n          'is-hidden': !this.state.credentials.csd.password\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      }, \"Copiar contrase\\xF1a almacenada\"))), React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"field\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"caption\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }, \"Extensi\\xF3n .key\"), React.createElement(Button, {\n        buttonStyle: \"info\",\n        onClick: this.toggleCsdKeyModal.bind(this),\n        className: \"is-fullwidth\",\n        icon: this.state.csd.key_file.original_filename ? 'file-outline' : 'plus',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }, this.state.csd.key_file.original_filename || 'Seleccionar Archivo'), React.createElement(\"p\", {\n        className: classNames('help is-danger', {\n          'is-hidden': this.state.isValid.key_file\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }, \"* Campo requerido\"), user.role !== 'sales' && React.createElement(\"a\", {\n        className: classNames({\n          'is-hidden': !this.state.credentials.csd.key_file\n        }),\n        href: this.state.credentials.csd.key_file,\n        download: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }, \"Descargar archivo key almacenado\"))), React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"field\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"caption\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253\n        },\n        __self: this\n      }, \"Extensi\\xF3n .cer\"), React.createElement(Button, {\n        buttonStyle: \"info\",\n        className: \"is-fullwidth\",\n        onClick: this.toggleCsdCerModal.bind(this),\n        icon: this.state.csd.cer_file.original_filename ? 'file-outline' : 'plus',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254\n        },\n        __self: this\n      }, this.state.csd.cer_file.original_filename || 'Seleccionar Archivo'), React.createElement(\"p\", {\n        className: classNames('help is-danger', {\n          'is-hidden': this.state.isValid.cer_file\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267\n        },\n        __self: this\n      }, \"* Campo requerido\"), user.role !== 'sales' && React.createElement(\"a\", {\n        className: classNames({\n          'is-hidden': !this.state.credentials.csd.cer_file\n        }),\n        href: this.state.credentials.csd.cer_file,\n        download: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276\n        },\n        __self: this\n      }, \"Descargar archivo .cer almacenado\")))), React.createElement(Button, {\n        className: \"align-right\",\n        buttonStyle: \"primary\",\n        icon: \"content-save\",\n        loading: this.state.requestInProgress,\n        onClick: this.uploadCsd.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 289\n        },\n        __self: this\n      }, \"Guardar CSD\"), React.createElement(SelectFile, {\n        isActive: this.state.isCsdKeyModalOpen,\n        toggleModal: this.toggleCsdKeyModal.bind(this),\n        title: \"Archivo .key del CSD\",\n        fileTypePlaceholder: \"Extensi\\xF3n .key del CSD\",\n        setFile: this.setCsdKey.bind(this),\n        accept: '.key',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }), React.createElement(SelectFile, {\n        isActive: this.state.isCsdCerModalOpen,\n        toggleModal: this.toggleCsdCerModal.bind(this),\n        title: \"Archivo .cer del CSD\",\n        fileTypePlaceholder: \"Extensi\\xF3n .cer del CSD\",\n        setFile: this.setCsdCer.bind(this),\n        accept: '.cer',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Csd;\n}(Component);\n\nexport default Csd;\nCsd.propTypes = {\n  hideIfFull: PropTypes.bool\n};\nCsd.defaultProps = {\n  hideIfFull: false\n};","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/shared/satCredentials/csd.js"],"names":["React","Component","PropTypes","classNames","clipboard","update","validator","NotificationsActions","SatCredentialsActions","SessionStore","SatCredentialsStore","SelectFile","TextField","Button","getCurrentState","currentEntity","getCurrentEntity","credentials","getCredentials","user","getUser","Csd","data","requestInProgress","isCsdKeyModalOpen","isCsdCerModalOpen","csd","key_file_password","key_file","attached_file","original_filename","content_type","cer_file","isValid","state","Object","assign","_onChange","bind","addChangeListener","removeChangeListener","setState","e","$set","target","value","file","filename","mime","key","cer","isEmpty","preventDefault","isValidCsdKey","isValidCsdCer","isValidCsdPassword","updateSatCredentials","taxable_entity","then","success","getSatCredentials","catch","error","hidden","props","hideIfFull","password","onChangeCsdPassword","role","writeText","toggleCsdKeyModal","toggleCsdCerModal","uploadCsd","setCsdKey","setCsdCer","propTypes","bool","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport classNames from 'classnames'\nimport clipboard from 'clipboard-polyfill'\nimport update from 'immutability-helper'\nimport validator from 'validator'\n\nimport NotificationsActions from 'actions/notifications'\nimport SatCredentialsActions from 'actions/satCredentials'\nimport SessionStore from 'stores/session'\nimport SatCredentialsStore from 'stores/satCredentials'\nimport SelectFile from 'shared/selectFile'\nimport TextField from 'shared/textField'\nimport Button from 'shared/button'\n\nfunction getCurrentState () {\n  let currentEntity = SessionStore.getCurrentEntity()\n  let credentials = SatCredentialsStore.getCredentials()\n  const user = SessionStore.getUser()\n  return {\n    currentEntity,\n    credentials,\n    user\n  }\n}\n\nclass Csd extends Component {\n  constructor () {\n    super()\n    this.data = {\n      requestInProgress: false,\n      isCsdKeyModalOpen: false,\n      isCsdCerModalOpen: false,\n      csd: {\n        key_file_password: '',\n        key_file: {\n          attached_file: '',\n          original_filename: '',\n          content_type: ''\n        },\n        cer_file: {\n          attached_file: '',\n          original_filename: '',\n          content_type: ''\n        }\n      },\n      isValid: {\n        key_file_password: true,\n        key_file: true,\n        cer_file: true\n      }\n    }\n    this.state = Object.assign({}, this.data, getCurrentState())\n    this._onChange = this._onChange.bind(this)\n  }\n\n  componentDidMount () {\n    // Adds listener, when the Store changes, trigger the _onChange callback func\n    SatCredentialsStore.addChangeListener(this._onChange)\n  }\n\n  componentWillUnmount () {\n    // Removes the listener to avoid memory leaks\n    SatCredentialsStore.removeChangeListener(this._onChange)\n  }\n\n  _onChange () {\n    // When the store changes, the state goes to it and pulls the updated data\n    // then sets it so the component rerenders\n    let state = getCurrentState()\n    this.setState(state)\n  }\n\n  // Persist password to state\n  onChangeCsdPassword (e) {\n    this.setState({\n      csd: update(this.state.csd, {\n        key_file_password: { $set: e.target.value }\n      })\n    })\n  }\n\n  // Toggle key modal\n  toggleCsdKeyModal () {\n    this.setState({ isCsdKeyModalOpen: !this.state.isCsdKeyModalOpen })\n  }\n\n  // Toggle certificate modal\n  toggleCsdCerModal () {\n    this.setState({ isCsdCerModalOpen: !this.state.isCsdCerModalOpen })\n  }\n\n  // Persist key to state\n  setCsdKey (file, filename, mime) {\n    let key = {\n      attached_file: file,\n      original_filename: filename,\n      content_type: mime\n    }\n    this.setState({\n      csd: update(this.state.csd, { key_file: { $set: key } })\n    })\n  }\n\n  // Persist certificate to state\n  setCsdCer (file, filename, mime) {\n    let cer = {\n      attached_file: file,\n      original_filename: filename,\n      content_type: mime\n    }\n    this.setState({\n      csd: update(this.state.csd, { cer_file: { $set: cer } })\n    })\n  }\n\n  // Validate non empty key\n  isValidCsdKey () {\n    let isValid = !validator.isEmpty(this.state.csd.key_file.attached_file)\n    this.setState({\n      isValid: update(this.state.isValid, { key_file: { $set: isValid } })\n    })\n    return isValid\n  }\n\n  // Validate non empty certificate\n  isValidCsdCer () {\n    let isValid = !validator.isEmpty(this.state.csd.cer_file.attached_file)\n    this.setState({\n      isValid: update(this.state.isValid, { cer_file: { $set: isValid } })\n    })\n    return isValid\n  }\n\n  // Validate non empty password\n  isValidCsdPassword () {\n    let isValid = !validator.isEmpty(this.state.csd.key_file_password)\n    this.setState({\n      isValid: update(this.state.isValid, {\n        key_file_password: { $set: isValid }\n      })\n    })\n    return isValid\n  }\n\n  uploadCsd (e) {\n    e.preventDefault()\n    if (\n      this.isValidCsdKey() &&\n      this.isValidCsdCer() &&\n      this.isValidCsdPassword()\n    ) {\n      this.setState({ requestInProgress: true }, () => {\n        SatCredentialsActions.updateSatCredentials({\n          taxable_entity: this.state.csd\n        })\n          .then(() => {\n            NotificationsActions.success('CSD guardado correctamente')\n            this.setState({ requestInProgress: false })\n            SatCredentialsActions.getSatCredentials()\n          })\n          .catch(error => {\n            NotificationsActions.error(error)\n            this.setState({ requestInProgress: false })\n          })\n      })\n    }\n  }\n\n  render () {\n    let hidden =\n      this.props.hideIfFull &&\n      this.state.credentials.csd &&\n      this.state.credentials.csd.key_file &&\n      this.state.credentials.csd.cer_file &&\n      this.state.credentials.csd.password\n    const { user } = this.state\n    return (\n      <div className={classNames({ 'is-hidden': hidden })}>\n        <h5 className='subtitle is-6 is-marginless'>CSD</h5>\n        <div className='columns'>\n          <div className='column'>\n            <div className='field'>\n              <TextField\n                label='Contraseña del CSD'\n                placeholder='Contraseña del CSD'\n                type='password'\n                className={classNames('input', {\n                  'is-danger': !this.state.isValid.key_file_password\n                })}\n                onChange={this.onChangeCsdPassword.bind(this)}\n                value={this.state.csd.key_file_password}\n              />\n              {user.role !== 'sales' && (\n                <a\n                  onClick={() => {\n                    clipboard\n                      .writeText(this.state.credentials.csd.password)\n                      .then(\n                        NotificationsActions.success(\n                          'Contraseña copiada al portapapeles'\n                        )\n                      )\n                  }}\n                  className={classNames({\n                    'is-hidden': !this.state.credentials.csd.password\n                  })}\n                >\n                  Copiar contraseña almacenada\n                </a>\n              )}\n            </div>\n          </div>\n          <div className='column'>\n            <div className='field'>\n              <label className='caption'>Extensión .key</label>\n              <Button\n                buttonStyle='info'\n                onClick={this.toggleCsdKeyModal.bind(this)}\n                className='is-fullwidth'\n                icon={\n                  this.state.csd.key_file.original_filename\n                    ? 'file-outline'\n                    : 'plus'\n                }\n              >\n                {this.state.csd.key_file.original_filename ||\n                  'Seleccionar Archivo'}\n              </Button>\n              <p\n                className={classNames('help is-danger', {\n                  'is-hidden': this.state.isValid.key_file\n                })}\n              >\n                * Campo requerido\n              </p>\n\n              {user.role !== 'sales' && (\n                <a\n                  className={classNames({\n                    'is-hidden': !this.state.credentials.csd.key_file\n                  })}\n                  href={this.state.credentials.csd.key_file}\n                  download\n                >\n                  Descargar archivo key almacenado\n                </a>\n              )}\n            </div>\n          </div>\n          <div className='column'>\n            <div className='field'>\n              <label className='caption'>Extensión .cer</label>\n              <Button\n                buttonStyle='info'\n                className='is-fullwidth'\n                onClick={this.toggleCsdCerModal.bind(this)}\n                icon={\n                  this.state.csd.cer_file.original_filename\n                    ? 'file-outline'\n                    : 'plus'\n                }\n              >\n                {this.state.csd.cer_file.original_filename ||\n                  'Seleccionar Archivo'}\n              </Button>\n              <p\n                className={classNames('help is-danger', {\n                  'is-hidden': this.state.isValid.cer_file\n                })}\n              >\n                * Campo requerido\n              </p>\n\n              {user.role !== 'sales' && (\n                <a\n                  className={classNames({\n                    'is-hidden': !this.state.credentials.csd.cer_file\n                  })}\n                  href={this.state.credentials.csd.cer_file}\n                  download\n                >\n                  Descargar archivo .cer almacenado\n                </a>\n              )}\n            </div>\n          </div>\n        </div>\n        <Button\n          className='align-right'\n          buttonStyle='primary'\n          icon='content-save'\n          loading={this.state.requestInProgress}\n          onClick={this.uploadCsd.bind(this)}\n        >\n          Guardar CSD\n        </Button>\n        <SelectFile\n          isActive={this.state.isCsdKeyModalOpen}\n          toggleModal={this.toggleCsdKeyModal.bind(this)}\n          title='Archivo .key del CSD'\n          fileTypePlaceholder='Extensión .key del CSD'\n          setFile={this.setCsdKey.bind(this)}\n          accept={'.key'}\n        />\n        <SelectFile\n          isActive={this.state.isCsdCerModalOpen}\n          toggleModal={this.toggleCsdCerModal.bind(this)}\n          title='Archivo .cer del CSD'\n          fileTypePlaceholder='Extensión .cer del CSD'\n          setFile={this.setCsdCer.bind(this)}\n          accept={'.cer'}\n        />\n      </div>\n    )\n  }\n}\n\nexport default Csd\n\nCsd.propTypes = {\n  hideIfFull: PropTypes.bool\n}\n\nCsd.defaultProps = {\n  hideIfFull: false\n}\n"]},"metadata":{},"sourceType":"module"}