{"ast":null,"code":"import _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/accountDisabled/makePayment/index.js\";\n// Libraries\nimport React, { Component } from 'react';\nimport { browserHistory } from 'react-router';\nimport Button from 'shared/button';\nimport { formatCurrency } from 'utils'; // components\n\nimport PaymentMethods from '../../app/views/editUser/suscription/paymentMethods'; // Actions\n\nimport SuscriptionActions from 'actions/suscription'; // Stores\n\nimport SuscriptionStore from 'stores/suscription';\nimport NotificationsActions from '../../../actions/notifications';\nvar requiredFields = new Set();\n\nfunction getCurrentState() {\n  return {\n    paymentLog: SuscriptionStore.getPendingPayments(),\n    ordersToPay: SuscriptionStore.getMinimumPayments(),\n    checkedItems: new Set(SuscriptionStore.getMinimumPayments()),\n    paymentSources: SuscriptionStore.getPaymentSourcesList()\n  };\n}\n\nvar CHECKED = 'checked';\n\nvar MakePayment =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(MakePayment, _Component);\n\n  function MakePayment(props) {\n    var _this;\n\n    _classCallCheck(this, MakePayment);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MakePayment).call(this, props));\n\n    _this._onChange = function () {\n      _this.setState(getCurrentState());\n    };\n\n    _this.returnToListing = function () {\n      browserHistory.push('/plataforma-bloqueada');\n    };\n\n    _this.goToPaymentDone = function () {\n      var orderIds = {\n        payment_orders: {\n          ids: _toConsumableArray(_this.state.checkedItems)\n        }\n      };\n\n      _this.setState({\n        requestInProgress: true\n      });\n\n      SuscriptionActions.payOrders(orderIds).then(function () {\n        browserHistory.push('/plataforma-bloqueada/pago-exitoso');\n      }).catch(function (error) {\n        NotificationsActions.error(error);\n      }).finally(function () {\n        _this.setState({\n          requestInProgress: false\n        });\n      });\n    };\n\n    _this.showPaymentMethodForm = function () {\n      browserHistory.push('/plataforma-bloqueada/agregar-metodo-pago');\n    };\n\n    _this.handleChange = function (e) {\n      var copy = Object.assign(new Set(), _this.state.checkedItems);\n      e.target.checked ? copy.add(parseInt(e.target.name)) : parseInt(copy.delete(e.target.name));\n\n      _this.setState(function (state) {\n        return {\n          checkedItems: copy\n        };\n      });\n    };\n\n    _this.state = _objectSpread(_defineProperty({}, CHECKED, false), getCurrentState(), {\n      requestInProgress: false\n    });\n    _this.state = Object.assign({}, _this.state);\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(MakePayment, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Adds listener, when the Store changes, trigger the _onChange callback func\n      SuscriptionStore.addChangeListener(this._onChange);\n      SuscriptionActions.getPendingPayments();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      SuscriptionStore.removeChangeListener(this._onChange);\n      requiredFields.clear();\n    } // When the store changes, the state goes to it and pulls the updated data\n    // then sets it so the component renders\n\n  }, {\n    key: \"renderTablePayServices\",\n    // body table\n    value: function renderTablePayServices() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          paymentLog = _this$state.paymentLog,\n          checkedItems = _this$state.checkedItems,\n          ordersToPay = _this$state.ordersToPay;\n      var rows = paymentLog.map(function (service) {\n        return React.createElement(\"tr\", {\n          key: service.id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 99\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 100\n          },\n          __self: this\n        }, service.name, React.createElement(\"input\", {\n          name: service.id,\n          type: \"checkbox\",\n          value: service.total,\n          className: \"aligned--checkbox\",\n          defaultChecked: ordersToPay.includes(service.id),\n          disabled: checkedItems.has(service.id),\n          onChange: _this2.handleChange,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 102\n          },\n          __self: this\n        }), service.description), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 113\n          },\n          __self: this\n        }, service.period), React.createElement(\"td\", {\n          className: \"has-text-right\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 114\n          },\n          __self: this\n        }, formatCurrency(service.total)));\n      });\n      return React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119\n        },\n        __self: this\n      }, rows);\n    } // render the complete table\n\n  }, {\n    key: \"renderTableMakePayment\",\n    value: function renderTableMakePayment() {\n      var table = React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"columns is-centered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column is-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      }, React.createElement(\"table\", {\n        className: \"paytable\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, \"Servicios sin pagar\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, \"Periodo\"), React.createElement(\"th\", {\n        className: \"has-text-right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, \"Monto\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      }))), this.renderTablePayServices()))));\n      return table;\n    } // Renders the main view\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          paymentLog = _this$state2.paymentLog,\n          checkedItems = _this$state2.checkedItems,\n          paymentSources = _this$state2.paymentSources,\n          requestInProgress = _this$state2.requestInProgress;\n      var total = paymentLog.reduce(function (sum, payment) {\n        return checkedItems.has(payment.id) ? sum + payment.total : sum;\n      }, 0);\n      var hasNotPaymentSources = paymentSources.length === 0;\n      return React.createElement(\"div\", {\n        className: \"columns is-centered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column is-9\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        className: \"headline--style is-uppercase has-text-centered \",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }, \"pago de servicios atrasados\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }), this.renderTableMakePayment(), React.createElement(\"hr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \" has-text-right text-style\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }, formatCurrency(total), React.createElement(\"p\", {\n        className: \"has-text-right paragraph-info--iva\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }, \"IVA incluido\"), React.createElement(\"p\", {\n        className: \"caption caption-margin-9 has-text-right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, \"Monto m\\xEDnimo a pagar para reactivaci\\xF3n de plataforma.\")), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"columns is-centered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column is-12\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }, React.createElement(PaymentMethods, {\n        showPaymentMethodForm: this.showPaymentMethodForm,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }))), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"has-text-centered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, React.createElement(Button, {\n        buttonStyle: \"silver\",\n        type: \"submit\",\n        onClick: this.returnToListing,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"cancelar\"), React.createElement(Button, {\n        buttonStyle: \"primary-invert\",\n        type: \"submit\",\n        onClick: this.goToPaymentDone,\n        disabled: hasNotPaymentSources || requestInProgress,\n        loading: requestInProgress,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, \"realizar pago\")), React.createElement(\"p\", {\n        className: \"caption caption-margin has-text-centered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 204\n        },\n        __self: this\n      }, ' ', \"Para dudas o aclaraciones comun\\xEDcate con nosotros al 800 9531 299.\")));\n    }\n  }]);\n\n  return MakePayment;\n}(Component);\n\nexport default MakePayment;","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/accountDisabled/makePayment/index.js"],"names":["React","Component","browserHistory","Button","formatCurrency","PaymentMethods","SuscriptionActions","SuscriptionStore","NotificationsActions","requiredFields","Set","getCurrentState","paymentLog","getPendingPayments","ordersToPay","getMinimumPayments","checkedItems","paymentSources","getPaymentSourcesList","CHECKED","MakePayment","props","_onChange","setState","returnToListing","push","goToPaymentDone","orderIds","payment_orders","ids","state","requestInProgress","payOrders","then","catch","error","finally","showPaymentMethodForm","handleChange","e","copy","Object","assign","target","checked","add","parseInt","name","delete","bind","addChangeListener","removeChangeListener","clear","rows","map","service","id","total","includes","has","description","period","table","renderTablePayServices","reduce","sum","payment","hasNotPaymentSources","length","renderTableMakePayment"],"mappings":"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","sourcesContent":["// Libraries\nimport React, { Component } from 'react'\nimport { browserHistory } from 'react-router'\nimport Button from 'shared/button'\nimport { formatCurrency } from 'utils'\n// components\nimport PaymentMethods from '../../app/views/editUser/suscription/paymentMethods'\n// Actions\nimport SuscriptionActions from 'actions/suscription'\n// Stores\nimport SuscriptionStore from 'stores/suscription'\nimport NotificationsActions from '../../../actions/notifications'\n\nconst requiredFields = new Set()\n\nfunction getCurrentState () {\n  return {\n    paymentLog: SuscriptionStore.getPendingPayments(),\n    ordersToPay: SuscriptionStore.getMinimumPayments(),\n    checkedItems: new Set(SuscriptionStore.getMinimumPayments()),\n    paymentSources: SuscriptionStore.getPaymentSourcesList()\n  }\n}\n\nconst CHECKED = 'checked'\n\nclass MakePayment extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      [CHECKED]: false,\n      ...getCurrentState(),\n      requestInProgress: false\n    }\n    this.state = Object.assign({}, this.state)\n    this.handleChange = this.handleChange.bind(this)\n  }\n\n  componentDidMount () {\n    // Adds listener, when the Store changes, trigger the _onChange callback func\n    SuscriptionStore.addChangeListener(this._onChange)\n    SuscriptionActions.getPendingPayments()\n  }\n\n  componentWillUnmount () {\n    SuscriptionStore.removeChangeListener(this._onChange)\n\n    requiredFields.clear()\n  }\n\n  // When the store changes, the state goes to it and pulls the updated data\n  // then sets it so the component renders\n  _onChange = () => {\n    this.setState(getCurrentState())\n  }\n\n  // when the user wants to cancel the payment\n  returnToListing = () => {\n    browserHistory.push('/plataforma-bloqueada')\n  }\n\n  // button when the user is ready to pay\n  goToPaymentDone = () => {\n    const orderIds = { payment_orders: { ids: [...this.state.checkedItems] } }\n\n    this.setState({ requestInProgress: true })\n    SuscriptionActions.payOrders(orderIds)\n      .then(() => {\n        browserHistory.push('/plataforma-bloqueada/pago-exitoso')\n      })\n      .catch(error => {\n        NotificationsActions.error(error)\n      })\n      .finally(() => {\n        this.setState({ requestInProgress: false })\n      })\n  }\n\n  // when user wants to add a new payment method\n  showPaymentMethodForm = () => {\n    browserHistory.push('/plataforma-bloqueada/agregar-metodo-pago')\n  }\n\n  // Adds or removes ids from checkedItems when an element is checked\n  handleChange = e => {\n    const copy = Object.assign(new Set(), this.state.checkedItems)\n    e.target.checked\n      ? copy.add(parseInt(e.target.name))\n      : parseInt(copy.delete(e.target.name))\n    this.setState(state => ({ checkedItems: copy }))\n  }\n\n  // body table\n  renderTablePayServices () {\n    const { paymentLog, checkedItems, ordersToPay } = this.state\n\n    const rows = paymentLog.map(service => {\n      return (\n        <tr key={service.id}>\n          <td>\n            {service.name}\n            <input\n              name={service.id}\n              type='checkbox'\n              value={service.total}\n              className='aligned--checkbox'\n              defaultChecked={ordersToPay.includes(service.id)}\n              disabled={checkedItems.has(service.id)}\n              onChange={this.handleChange}\n            />\n            {service.description}\n          </td>\n          <td>{service.period}</td>\n          <td className='has-text-right'>{formatCurrency(service.total)}</td>\n        </tr>\n      )\n    })\n\n    return <tbody>{rows}</tbody>\n  }\n\n  // render the complete table\n  renderTableMakePayment () {\n    const table = (\n      <div>\n        <div className='columns is-centered'>\n          <div className='column is-12'>\n            <table className='paytable'>\n              <thead>\n                <tr>\n                  <th>Servicios sin pagar</th>\n                  <th>Periodo</th>\n                  <th className='has-text-right'>Monto</th>\n                  <th />\n                </tr>\n              </thead>\n              {this.renderTablePayServices()}\n            </table>\n          </div>\n        </div>\n      </div>\n    )\n    return table\n  }\n\n  // Renders the main view\n  render () {\n    let {\n      paymentLog,\n      checkedItems,\n      paymentSources,\n      requestInProgress\n    } = this.state\n    const total = paymentLog.reduce(\n      (sum, payment) =>\n        checkedItems.has(payment.id) ? sum + payment.total : sum,\n      0\n    )\n    const hasNotPaymentSources = paymentSources.length === 0\n\n    return (\n      <div className='columns is-centered'>\n        <div className='column is-9'>\n          <h1 className='headline--style is-uppercase has-text-centered '>\n            pago de servicios atrasados\n          </h1>\n          <br />\n          {this.renderTableMakePayment()}\n          <hr />\n          <div className=' has-text-right text-style'>\n            {formatCurrency(total)}\n            <p className='has-text-right paragraph-info--iva'>IVA incluido</p>\n            <p className='caption caption-margin-9 has-text-right'>\n              Monto mínimo a pagar para reactivación de plataforma.\n            </p>\n          </div>\n          <br />\n          <div className='columns is-centered'>\n            <div className='column is-12'>\n              <PaymentMethods\n                showPaymentMethodForm={this.showPaymentMethodForm}\n              />\n            </div>\n          </div>\n          <br />\n          <div className='has-text-centered'>\n            <Button\n              buttonStyle='silver'\n              type='submit'\n              onClick={this.returnToListing}\n            >\n              cancelar\n            </Button>\n            <Button\n              buttonStyle='primary-invert'\n              type='submit'\n              onClick={this.goToPaymentDone}\n              disabled={hasNotPaymentSources || requestInProgress}\n              loading={requestInProgress}\n            >\n              realizar pago\n            </Button>\n          </div>\n          <p className='caption caption-margin has-text-centered'>\n            {' '}\n            Para dudas o aclaraciones comunícate con nosotros al 800 9531 299.\n          </p>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default MakePayment\n"]},"metadata":{},"sourceType":"module"}