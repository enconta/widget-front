{"ast":null,"code":"import _toConsumableArray from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/editClient/clients/editingForm/index.js\";\n// Libraries\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { browserHistory } from 'react-router'; // Components\n\nimport EditClientActions from 'actions/editClient';\nimport NotificationActions from 'actions/notifications';\nimport ClientsStore from 'stores/clients';\nimport TextField from 'shared/textField';\nimport Button from 'shared/button';\nimport Alert from 'shared/alert';\nimport { avoidBlankSpace } from 'utils'; // Set where all the required field refs are going to be\n// stored so we can validate them all when submit\n\nvar requiredFields = new Set();\n\nfunction getCurrentState() {\n  return ClientsStore.getCurrentClient();\n}\n\nvar EditClientInfo =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(EditClientInfo, _Component);\n\n  function EditClientInfo() {\n    var _this;\n\n    _classCallCheck(this, EditClientInfo);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EditClientInfo).call(this));\n    _this.data = {\n      requestInProgress: false,\n      alertOpen: false\n    };\n    _this.state = Object.assign({}, _this.data, getCurrentState());\n    _this._onChange = _this._onChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(EditClientInfo, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Adds listener, when the Store changes, trigger the _onChange callback func\n      ClientsStore.addChangeListener(this._onChange); // If we are supposed to be editing a document, ask for document info\n\n      if (!this.props.location.pathname.includes('/proveedor/nuevo') && typeof this.props.params.id !== 'undefined') {\n        this.setState({\n          isUpdate: true\n        });\n        EditClientActions.getClientData(this.props.params.id);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Removes the listener to avoid memory leaks\n      ClientsStore.removeChangeListener(this._onChange); // Clears the stored requiredFields\n\n      requiredFields.clear();\n    }\n  }, {\n    key: \"_onChange\",\n    value: function _onChange() {\n      // When the store changes, the state goes to it and pulls the updated data\n      // then sets it so the component rerenders\n      var state = getCurrentState();\n      this.setState(state);\n    }\n  }, {\n    key: \"toggleAlert\",\n    value: function toggleAlert() {\n      this.setState(function (prevState) {\n        return {\n          alertOpen: !prevState.alertOpen\n        };\n      });\n    }\n  }, {\n    key: \"onChangeField\",\n    value: function onChangeField(field, e) {\n      this.setState(_defineProperty({}, field, avoidBlankSpace(e.target.value)));\n    } // Iterates over required fields and validates every one of them\n    // Then it returns true if all validations succeedeed, else false.\n\n  }, {\n    key: \"validateAll\",\n    value: function validateAll() {\n      return _toConsumableArray(requiredFields) // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(function (form) {\n        return form.validate();\n      }) // Calls the validate() method on each form\n      .every(function (e) {\n        return e;\n      }); // Checks if all validations suceeded\n    } // Clears the current Document and redirects to the documents listing\n\n  }, {\n    key: \"returnToListing\",\n    value: function returnToListing() {\n      var pathname = this.props.location.pathname;\n      var route = pathname === '/cliente/nuevo' ? 'clientes' : 'proveedores';\n      this.setState({\n        requestInProgress: false\n      });\n      EditClientActions.clearClient();\n      browserHistory.push(\"/\".concat(route));\n    }\n  }, {\n    key: \"deleteClient\",\n    value: function deleteClient() {\n      var _this2 = this;\n\n      var id = this.props.params.id;\n      EditClientActions.deleteClient(id).then(function () {\n        NotificationActions.success('El cliente ha sido borrado correctamente');\n\n        _this2.returnToListing();\n      }).catch(function (err) {\n        return NotificationActions.error(err);\n      });\n    }\n  }, {\n    key: \"sendData\",\n    value: function sendData(e) {\n      var _this3 = this;\n\n      var type = this.props.type;\n      e.preventDefault();\n\n      if (this.validateAll() && !this.state.requestInProgress) {\n        var data = {\n          client: {\n            rfc: this.state.clientRfc,\n            legal_name: this.state.clientLegalName,\n            email: this.state.clientEmail,\n            nickname: this.state.clientNickname,\n            postal_code: this.state.clientPostalCode,\n            client_type: type\n          }\n        }; // If the request is for update an existing employee, sets the id and calls the corresponding Action\n        // Otherwise, calls the action to create a new one.\n\n        this.setState({\n          requestInProgress: true\n        }, function () {\n          if (_this3.state.isUpdate) {\n            var id = _this3.props.params.id;\n            EditClientActions.setClientData(id, data).then(function () {\n              NotificationActions.success('El cliente ha sido editado correctamente');\n\n              _this3.returnToListing();\n            }).catch(function (error) {\n              NotificationActions.error(error.join('\\n'));\n\n              _this3.setState({\n                requestInProgress: false\n              });\n            });\n          } else {\n            EditClientActions.createClient(data).then(function () {\n              NotificationActions.success('El cliente ha sido creado correctamente');\n\n              _this3.returnToListing();\n            }).catch(function (error) {\n              NotificationActions.error(error.join('\\n'));\n\n              _this3.setState({\n                requestInProgress: false\n              });\n            });\n          }\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var isUpdate = this.state.isUpdate;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, React.createElement(Button, {\n        buttonStyle: \"link\",\n        icon: \"chevron-double-left\",\n        onClick: this.returnToListing.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, \"Volver\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }), React.createElement(\"h1\", {\n        className: \"subheader-green\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }, this.props.route.title), React.createElement(\"form\", {\n        onSubmit: this.sendData.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"columns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        label: \"Raz\\xF3n Social\",\n        value: this.state.clientLegalName,\n        onChange: this.onChangeField.bind(this, 'clientLegalName'),\n        required: true,\n        ref: function ref(r) {\n          return requiredFields.add(r);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"column is-4\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        label: \"RFC\",\n        value: this.state.clientRfc,\n        onChange: this.onChangeField.bind(this, 'clientRfc'),\n        required: true,\n        ref: function ref(r) {\n          return requiredFields.add(r);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"columns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        label: \"Email\",\n        value: this.state.clientEmail,\n        onChange: this.onChangeField.bind(this, 'clientEmail'),\n        type: \"email\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        label: \"Alias\",\n        value: this.state.clientNickname,\n        onChange: this.onChangeField.bind(this, 'clientNickname'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }))), React.createElement(\"div\", {\n        className: \"columns\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column is-one-quarter\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        label: \"C\\xF3digo Postal\",\n        value: this.state.clientPostalCode,\n        onChange: this.onChangeField.bind(this, 'clientPostalCode'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }))), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"caption required\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, \"* Campos obligatorios\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"flex-end\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210\n        },\n        __self: this\n      }, React.createElement(Button, {\n        icon: \"cancel\",\n        onClick: this.returnToListing.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, \"Cancelar\"), isUpdate ? React.createElement(Button, {\n        buttonStyle: \"danger\",\n        icon: \"delete\",\n        type: \"button\",\n        onClick: this.toggleAlert.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }, \"Eliminar Cliente\") : null, React.createElement(Button, {\n        buttonStyle: \"primary\",\n        icon: \"content-save\",\n        type: \"submit\",\n        loading: this.state.requestInProgress,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, \"Guardar\"))), React.createElement(Alert, {\n        isActive: this.state.alertOpen,\n        toggleAlert: this.toggleAlert.bind(this),\n        onSubmit: this.deleteClient.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return EditClientInfo;\n}(Component);\n\nEditClientInfo.propTypes = {\n  location: PropTypes.shape({\n    pathname: PropTypes.string\n  }),\n  params: PropTypes.shape({\n    id: PropTypes.string\n  }),\n  route: PropTypes.shape({\n    title: PropTypes.string\n  })\n};\nexport default EditClientInfo;","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/editClient/clients/editingForm/index.js"],"names":["React","Component","PropTypes","browserHistory","EditClientActions","NotificationActions","ClientsStore","TextField","Button","Alert","avoidBlankSpace","requiredFields","Set","getCurrentState","getCurrentClient","EditClientInfo","data","requestInProgress","alertOpen","state","Object","assign","_onChange","bind","addChangeListener","props","location","pathname","includes","params","id","setState","isUpdate","getClientData","removeChangeListener","clear","prevState","field","e","target","value","filter","Boolean","map","form","validate","every","route","clearClient","push","deleteClient","then","success","returnToListing","catch","err","error","type","preventDefault","validateAll","client","rfc","clientRfc","legal_name","clientLegalName","email","clientEmail","nickname","clientNickname","postal_code","clientPostalCode","client_type","setClientData","join","createClient","title","sendData","onChangeField","r","add","toggleAlert","propTypes","shape","string"],"mappings":"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","sourcesContent":["// Libraries\nimport React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { browserHistory } from 'react-router'\n\n// Components\nimport EditClientActions from 'actions/editClient'\nimport NotificationActions from 'actions/notifications'\nimport ClientsStore from 'stores/clients'\nimport TextField from 'shared/textField'\nimport Button from 'shared/button'\nimport Alert from 'shared/alert'\nimport { avoidBlankSpace } from 'utils'\n\n// Set where all the required field refs are going to be\n// stored so we can validate them all when submit\nconst requiredFields = new Set()\n\nfunction getCurrentState () {\n  return ClientsStore.getCurrentClient()\n}\n\nclass EditClientInfo extends Component {\n  constructor () {\n    super()\n    this.data = {\n      requestInProgress: false,\n      alertOpen: false\n    }\n    this.state = Object.assign({}, this.data, getCurrentState())\n    this._onChange = this._onChange.bind(this)\n  }\n\n  componentDidMount () {\n    // Adds listener, when the Store changes, trigger the _onChange callback func\n    ClientsStore.addChangeListener(this._onChange)\n    // If we are supposed to be editing a document, ask for document info\n    if (\n      !this.props.location.pathname.includes('/proveedor/nuevo') &&\n      typeof this.props.params.id !== 'undefined'\n    ) {\n      this.setState({ isUpdate: true })\n      EditClientActions.getClientData(this.props.params.id)\n    }\n  }\n\n  componentWillUnmount () {\n    // Removes the listener to avoid memory leaks\n    ClientsStore.removeChangeListener(this._onChange)\n    // Clears the stored requiredFields\n    requiredFields.clear()\n  }\n\n  _onChange () {\n    // When the store changes, the state goes to it and pulls the updated data\n    // then sets it so the component rerenders\n    let state = getCurrentState()\n    this.setState(state)\n  }\n\n  toggleAlert () {\n    this.setState(prevState => ({\n      alertOpen: !prevState.alertOpen\n    }))\n  }\n\n  onChangeField (field, e) {\n    this.setState({ [field]: avoidBlankSpace(e.target.value) })\n  }\n\n  // Iterates over required fields and validates every one of them\n  // Then it returns true if all validations succeedeed, else false.\n  validateAll () {\n    return [...requiredFields] // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(form => form.validate()) // Calls the validate() method on each form\n      .every(e => e) // Checks if all validations suceeded\n  }\n\n  // Clears the current Document and redirects to the documents listing\n  returnToListing () {\n    const pathname = this.props.location.pathname\n    const route = pathname === '/cliente/nuevo' ? 'clientes' : 'proveedores'\n    this.setState({ requestInProgress: false })\n    EditClientActions.clearClient()\n    browserHistory.push(`/${route}`)\n  }\n\n  deleteClient () {\n    const { id } = this.props.params\n    EditClientActions.deleteClient(id)\n      .then(() => {\n        NotificationActions.success('El cliente ha sido borrado correctamente')\n        this.returnToListing()\n      })\n      .catch(err => NotificationActions.error(err))\n  }\n\n  sendData (e) {\n    const type = this.props.type\n    e.preventDefault()\n    if (this.validateAll() && !this.state.requestInProgress) {\n      let data = {\n        client: {\n          rfc: this.state.clientRfc,\n          legal_name: this.state.clientLegalName,\n          email: this.state.clientEmail,\n          nickname: this.state.clientNickname,\n          postal_code: this.state.clientPostalCode,\n          client_type: type\n        }\n      }\n      // If the request is for update an existing employee, sets the id and calls the corresponding Action\n      // Otherwise, calls the action to create a new one.\n      this.setState({ requestInProgress: true }, () => {\n        if (this.state.isUpdate) {\n          let { id } = this.props.params\n          EditClientActions.setClientData(id, data)\n            .then(() => {\n              NotificationActions.success(\n                'El cliente ha sido editado correctamente'\n              )\n              this.returnToListing()\n            })\n            .catch(error => {\n              NotificationActions.error(error.join('\\n'))\n              this.setState({ requestInProgress: false })\n            })\n        } else {\n          EditClientActions.createClient(data)\n            .then(() => {\n              NotificationActions.success(\n                'El cliente ha sido creado correctamente'\n              )\n              this.returnToListing()\n            })\n            .catch(error => {\n              NotificationActions.error(error.join('\\n'))\n              this.setState({ requestInProgress: false })\n            })\n        }\n      })\n    }\n  }\n\n  render () {\n    const { isUpdate } = this.state\n    return (\n      <div>\n        <Button\n          buttonStyle='link'\n          icon='chevron-double-left'\n          onClick={this.returnToListing.bind(this)}\n        >\n          Volver\n        </Button>\n        <br />\n        <br />\n        <h1 className='subheader-green'>{this.props.route.title}</h1>\n        <form onSubmit={this.sendData.bind(this)}>\n          <div className='columns'>\n            <div className='column'>\n              <TextField\n                label='Razón Social'\n                value={this.state.clientLegalName}\n                onChange={this.onChangeField.bind(this, 'clientLegalName')}\n                required\n                ref={r => requiredFields.add(r)}\n              />\n            </div>\n            <div className='column is-4'>\n              <TextField\n                label='RFC'\n                value={this.state.clientRfc}\n                onChange={this.onChangeField.bind(this, 'clientRfc')}\n                required\n                ref={r => requiredFields.add(r)}\n              />\n            </div>\n          </div>\n          <div className='columns'>\n            <div className='column'>\n              <TextField\n                label='Email'\n                value={this.state.clientEmail}\n                onChange={this.onChangeField.bind(this, 'clientEmail')}\n                type='email'\n              />\n            </div>\n            <div className='column'>\n              <TextField\n                label='Alias'\n                value={this.state.clientNickname}\n                onChange={this.onChangeField.bind(this, 'clientNickname')}\n              />\n            </div>\n          </div>\n          <div className='columns'>\n            <div className='column is-one-quarter'>\n              <TextField\n                label='Código Postal'\n                value={this.state.clientPostalCode}\n                onChange={this.onChangeField.bind(this, 'clientPostalCode')}\n              />\n            </div>\n          </div>\n          <br />\n          <div className='caption required'>* Campos obligatorios</div>\n          <br />\n          <div className='flex-end'>\n            <Button icon='cancel' onClick={this.returnToListing.bind(this)}>\n              Cancelar\n            </Button>\n            {isUpdate ? (\n              <Button\n                buttonStyle='danger'\n                icon='delete'\n                type='button'\n                onClick={this.toggleAlert.bind(this)}\n              >\n                Eliminar Cliente\n              </Button>\n            ) : null}\n            <Button\n              buttonStyle='primary'\n              icon='content-save'\n              type='submit'\n              loading={this.state.requestInProgress}\n            >\n              Guardar\n            </Button>\n          </div>\n        </form>\n        <Alert\n          isActive={this.state.alertOpen}\n          toggleAlert={this.toggleAlert.bind(this)}\n          onSubmit={this.deleteClient.bind(this)}\n        />\n      </div>\n    )\n  }\n}\n\nEditClientInfo.propTypes = {\n  location: PropTypes.shape({\n    pathname: PropTypes.string\n  }),\n  params: PropTypes.shape({\n    id: PropTypes.string\n  }),\n  route: PropTypes.shape({\n    title: PropTypes.string\n  })\n}\nexport default EditClientInfo\n"]},"metadata":{},"sourceType":"module"}