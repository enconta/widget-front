{"ast":null,"code":"import _toConsumableArray from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/newInvoice/shared/payrollCharges/deductions/index.js\";\n// Libraries\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport update from 'immutability-helper';\nimport accounting from 'accounting';\nimport classNames from 'classnames'; // Components\n\nimport Button from 'shared/button';\nimport { amountToCents, absolutify } from 'utils'; // Catalogs\n\nimport { DEDUCTION_TYPE } from 'shared/catalogs';\nimport SelectField from 'shared/selectField';\nimport IconButton from 'shared/iconButton';\nimport TextField from 'shared/textField'; // Keys\n\nvar CHARGES_KEY = 'charges';\nvar CHARGES_KIND_KEY = 'deduction_type';\nvar CHARGES_CATEGORY_KEY = 'clave';\nvar CHARGES_CONCEPT_KEY = 'concept';\nvar CHARGES_AMOUNT_KEY = 'amount_cents';\nvar SUBTOTAL_KEY = 'subtotal'; // Prevent rendering this special cases\n\nvar DO_NOT_RENDER = ['006'];\nvar requiredFields = new Set();\n\nvar Deductions =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Deductions, _Component);\n\n  function Deductions() {\n    var _this$data;\n\n    var _this;\n\n    _classCallCheck(this, Deductions);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Deductions).call(this));\n    _this.data = (_this$data = {}, _defineProperty(_this$data, CHARGES_KEY, []), _defineProperty(_this$data, SUBTOTAL_KEY, 0), _this$data);\n    _this.state = Object.assign({}, _this.data);\n    return _this;\n  }\n\n  _createClass(Deductions, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Add the first, non-removable deduction\n      this.addItem();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Clears the stored requiredFields\n      requiredFields.clear();\n    }\n  }, {\n    key: \"exportDeductions\",\n    value: function exportDeductions() {\n      return this.state[CHARGES_KEY].map(function (charge) {\n        return Object.assign({}, charge, _defineProperty({}, CHARGES_AMOUNT_KEY, amountToCents(charge[CHARGES_AMOUNT_KEY])));\n      });\n    } // Iterates over required fields and validates every one of them\n    // Then it returns true if all validations succeedeed, else false.\n\n  }, {\n    key: \"validateRequiredFields\",\n    value: function validateRequiredFields() {\n      var _this2 = this;\n\n      return _toConsumableArray(requiredFields) // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(function (form) {\n        return form.validate.call(_this2);\n      }) // Calls the validate() method on each form\n      .every(function (e) {\n        return e;\n      }); // Checks if all validations suceeded\n    } // Adds one deduction to this.state.charges\n\n  }, {\n    key: \"addItem\",\n    value: function addItem() {\n      var _charges$push;\n\n      var charges = this.state[CHARGES_KEY];\n      charges.push((_charges$push = {}, _defineProperty(_charges$push, CHARGES_KIND_KEY, ''), _defineProperty(_charges$push, CHARGES_CATEGORY_KEY, ''), _defineProperty(_charges$push, CHARGES_CONCEPT_KEY, ''), _defineProperty(_charges$push, CHARGES_AMOUNT_KEY, '$ 0.00'), _charges$push));\n      this.setState(_defineProperty({}, CHARGES_KEY, charges));\n    } // Persist changes to charges[charge] in field\n\n  }, {\n    key: \"onChange\",\n    value: function onChange(charge, field, e) {\n      var _this3 = this;\n\n      this.setState(_defineProperty({}, CHARGES_KEY, update(this.state[CHARGES_KEY], _defineProperty({}, charge, _defineProperty({}, field, {\n        $set: e.target.value\n      })))), function () {\n        if (field === CHARGES_AMOUNT_KEY) _this3.updateSubtotals();\n      });\n    } // Format price as $ 1,234.56\n\n  }, {\n    key: \"formatPrice\",\n    value: function formatPrice(index, field) {\n      var formatted = accounting.formatMoney(absolutify(this.state[CHARGES_KEY][index][field]), '$ ');\n      this.setState(_defineProperty({}, CHARGES_KEY, update(this.state[CHARGES_KEY], _defineProperty({}, index, _defineProperty({}, field, {\n        $set: formatted\n      })))));\n    } // Parse formatted price\n\n  }, {\n    key: \"unformatPrice\",\n    value: function unformatPrice(index, field) {\n      var unformatted = absolutify(this.state[CHARGES_KEY][index][field]);\n      this.setState(_defineProperty({}, CHARGES_KEY, update(this.state[CHARGES_KEY], _defineProperty({}, index, _defineProperty({}, field, {\n        $set: unformatted\n      })))));\n    } // Update subtotal\n\n  }, {\n    key: \"updateSubtotals\",\n    value: function updateSubtotals() {\n      // Iterates over every charge and acumulativamente adds it and assigns the result to subtotal\n      var subtotal = this.state[CHARGES_KEY].reduce(function (acc, charge) {\n        return acc + absolutify(charge[CHARGES_AMOUNT_KEY]);\n      }, 0); // Update parent totals and subtotals\n\n      this.props.updatePayrollTotals(this.props.keyId, subtotal);\n      this.setState(_defineProperty({}, SUBTOTAL_KEY, subtotal.toFixed(2)));\n    } // Delete a deduction\n\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(index) {\n      requiredFields.clear();\n      var charges = this.state[CHARGES_KEY];\n      charges.splice(index, 1);\n      this.setState(_defineProperty({}, CHARGES_KEY, charges), this.updateSubtotals);\n    } // Items\n\n  }, {\n    key: \"renderItemList\",\n    value: function renderItemList() {\n      var _this4 = this;\n\n      var chargeList = null;\n\n      if (this.state[CHARGES_KEY].length > 0) {\n        chargeList = this.state[CHARGES_KEY].map(function (charge, index) {\n          return React.createElement(\"tr\", {\n            key: index,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 144\n            },\n            __self: this\n          }, React.createElement(\"td\", {\n            className: \"is-one-quarter\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 145\n            },\n            __self: this\n          }, React.createElement(SelectField, {\n            name: \"Tipo de deducci\\xF3n\",\n            placeholder: \"Selecciona una opci\\xF3n\",\n            value: charge[CHARGES_KIND_KEY],\n            onChange: _this4.onChange.bind(_this4, index, CHARGES_KIND_KEY),\n            options: DEDUCTION_TYPE,\n            hiddenOptions: DO_NOT_RENDER,\n            showId: true,\n            required: true,\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            onValidationError: _this4.props.onValidationError,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 146\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 159\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            name: \"Categor\\xEDa personalizada de deducci\\xF3n\",\n            value: charge[CHARGES_CATEGORY_KEY],\n            onChange: _this4.onChange.bind(_this4, index, CHARGES_CATEGORY_KEY),\n            required: true,\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            selectAllOnFocus: true,\n            onValidationError: _this4.props.onValidationError,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 160\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 170\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            name: \"Concepto de deducci\\xF3n\",\n            value: charge[CHARGES_CONCEPT_KEY],\n            onChange: _this4.onChange.bind(_this4, index, CHARGES_CONCEPT_KEY),\n            required: true,\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            selectAllOnFocus: true,\n            onValidationError: _this4.props.onValidationError,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 171\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 181\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            value: charge[CHARGES_AMOUNT_KEY],\n            onChange: _this4.onChange.bind(_this4, index, CHARGES_AMOUNT_KEY),\n            onBlur: _this4.formatPrice.bind(_this4, index, CHARGES_AMOUNT_KEY),\n            onFocus: _this4.unformatPrice.bind(_this4, index, CHARGES_AMOUNT_KEY),\n            selectAllOnFocus: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 182\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 194\n            },\n            __self: this\n          }, React.createElement(\"p\", {\n            className: classNames('table--actions', {\n              'is-hidden': _this4.state[CHARGES_KEY].length <= 1\n            }),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 195\n            },\n            __self: this\n          }, React.createElement(IconButton, {\n            icon: \"delete\",\n            onClick: _this4.deleteItem.bind(_this4, index),\n            tooltip: \"Borrar\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 200\n            },\n            __self: this\n          }))));\n        });\n      }\n\n      return chargeList;\n    } // Main render\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        className: \"subheader-green\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, \"Deducciones\"), React.createElement(\"table\", {\n        className: \"table\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 220\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }, \"Tipo\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, \"Categor\\xEDa personalizada (Min 4 d\\xEDgitos)\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, \"Concepto\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, \"Importe\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, \"Acciones\"))), React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }, this.renderItemList()), React.createElement(Button, {\n        buttonStyle: \"primaryLink\",\n        icon: \"plus\",\n        onClick: this.addItem.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }, \"Agregar Deducci\\xF3n\"), React.createElement(\"tfoot\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        colSpan: 2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240\n        },\n        __self: this\n      }, \"Subtotal:\"), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, accounting.formatMoney(this.state[SUBTOTAL_KEY], '$ ', 2)), React.createElement(\"td\", {\n        colSpan: 1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      })))));\n    }\n  }]);\n\n  return Deductions;\n}(Component);\n\nDeductions.propTypes = {\n  onValidationError: PropTypes.func,\n  updatePayrollTotals: PropTypes.func,\n  keyId: PropTypes.string\n};\nDeductions.defaultProps = {\n  onValidationError: function onValidationError() {}\n};\nexport default Deductions;","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/newInvoice/shared/payrollCharges/deductions/index.js"],"names":["React","Component","PropTypes","update","accounting","classNames","Button","amountToCents","absolutify","DEDUCTION_TYPE","SelectField","IconButton","TextField","CHARGES_KEY","CHARGES_KIND_KEY","CHARGES_CATEGORY_KEY","CHARGES_CONCEPT_KEY","CHARGES_AMOUNT_KEY","SUBTOTAL_KEY","DO_NOT_RENDER","requiredFields","Set","Deductions","data","state","Object","assign","addItem","clear","map","charge","filter","Boolean","form","validate","call","every","e","charges","push","setState","field","$set","target","value","updateSubtotals","index","formatted","formatMoney","unformatted","subtotal","reduce","acc","props","updatePayrollTotals","keyId","toFixed","splice","chargeList","length","onChange","bind","r","add","onValidationError","formatPrice","unformatPrice","deleteItem","renderItemList","propTypes","func","string","defaultProps"],"mappings":"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","sourcesContent":["// Libraries\nimport React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport update from 'immutability-helper'\nimport accounting from 'accounting'\nimport classNames from 'classnames'\n\n// Components\nimport Button from 'shared/button'\nimport { amountToCents, absolutify } from 'utils'\n\n// Catalogs\nimport { DEDUCTION_TYPE } from 'shared/catalogs'\nimport SelectField from 'shared/selectField'\nimport IconButton from 'shared/iconButton'\nimport TextField from 'shared/textField'\n\n// Keys\nlet CHARGES_KEY = 'charges'\nlet CHARGES_KIND_KEY = 'deduction_type'\nlet CHARGES_CATEGORY_KEY = 'clave'\nlet CHARGES_CONCEPT_KEY = 'concept'\nlet CHARGES_AMOUNT_KEY = 'amount_cents'\nlet SUBTOTAL_KEY = 'subtotal'\n\n// Prevent rendering this special cases\nconst DO_NOT_RENDER = ['006']\n\nconst requiredFields = new Set()\n\nclass Deductions extends Component {\n  constructor () {\n    super()\n    this.data = {\n      [CHARGES_KEY]: [],\n      [SUBTOTAL_KEY]: 0\n    }\n    this.state = Object.assign({}, this.data)\n  }\n\n  componentDidMount () {\n    // Add the first, non-removable deduction\n    this.addItem()\n  }\n\n  componentWillUnmount () {\n    // Clears the stored requiredFields\n    requiredFields.clear()\n  }\n\n  exportDeductions () {\n    return this.state[CHARGES_KEY].map(charge =>\n      Object.assign({}, charge, {\n        [CHARGES_AMOUNT_KEY]: amountToCents(charge[CHARGES_AMOUNT_KEY])\n      })\n    )\n  }\n\n  // Iterates over required fields and validates every one of them\n  // Then it returns true if all validations succeedeed, else false.\n  validateRequiredFields () {\n    return [...requiredFields] // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(form => form.validate.call(this)) // Calls the validate() method on each form\n      .every(e => e) // Checks if all validations suceeded\n  }\n\n  // Adds one deduction to this.state.charges\n  addItem () {\n    let charges = this.state[CHARGES_KEY]\n    charges.push({\n      [CHARGES_KIND_KEY]: '',\n      [CHARGES_CATEGORY_KEY]: '',\n      [CHARGES_CONCEPT_KEY]: '',\n      [CHARGES_AMOUNT_KEY]: '$ 0.00'\n    })\n    this.setState({ [CHARGES_KEY]: charges })\n  }\n\n  // Persist changes to charges[charge] in field\n  onChange (charge, field, e) {\n    this.setState(\n      {\n        [CHARGES_KEY]: update(this.state[CHARGES_KEY], {\n          [charge]: { [field]: { $set: e.target.value } }\n        })\n      },\n      () => {\n        if (field === CHARGES_AMOUNT_KEY) this.updateSubtotals()\n      }\n    )\n  }\n\n  // Format price as $ 1,234.56\n  formatPrice (index, field) {\n    let formatted = accounting.formatMoney(\n      absolutify(this.state[CHARGES_KEY][index][field]),\n      '$ '\n    )\n    this.setState({\n      [CHARGES_KEY]: update(this.state[CHARGES_KEY], {\n        [index]: { [field]: { $set: formatted } }\n      })\n    })\n  }\n\n  // Parse formatted price\n  unformatPrice (index, field) {\n    let unformatted = absolutify(this.state[CHARGES_KEY][index][field])\n    this.setState({\n      [CHARGES_KEY]: update(this.state[CHARGES_KEY], {\n        [index]: { [field]: { $set: unformatted } }\n      })\n    })\n  }\n\n  // Update subtotal\n  updateSubtotals () {\n    // Iterates over every charge and acumulativamente adds it and assigns the result to subtotal\n    let subtotal = this.state[CHARGES_KEY].reduce((acc, charge) => {\n      return acc + absolutify(charge[CHARGES_AMOUNT_KEY])\n    }, 0)\n    // Update parent totals and subtotals\n    this.props.updatePayrollTotals(this.props.keyId, subtotal)\n    this.setState({\n      [SUBTOTAL_KEY]: subtotal.toFixed(2)\n    })\n  }\n\n  // Delete a deduction\n  deleteItem (index) {\n    requiredFields.clear()\n    let charges = this.state[CHARGES_KEY]\n    charges.splice(index, 1)\n    this.setState({ [CHARGES_KEY]: charges }, this.updateSubtotals)\n  }\n\n  // Items\n  renderItemList () {\n    let chargeList = null\n    if (this.state[CHARGES_KEY].length > 0) {\n      chargeList = this.state[CHARGES_KEY].map((charge, index) => {\n        return (\n          <tr key={index}>\n            <td className='is-one-quarter'>\n              <SelectField\n                name='Tipo de deducción'\n                placeholder='Selecciona una opción'\n                value={charge[CHARGES_KIND_KEY]}\n                onChange={this.onChange.bind(this, index, CHARGES_KIND_KEY)}\n                options={DEDUCTION_TYPE}\n                hiddenOptions={DO_NOT_RENDER}\n                showId\n                required\n                ref={r => requiredFields.add(r)}\n                onValidationError={this.props.onValidationError}\n              />\n            </td>\n            <td>\n              <TextField\n                name='Categoría personalizada de deducción'\n                value={charge[CHARGES_CATEGORY_KEY]}\n                onChange={this.onChange.bind(this, index, CHARGES_CATEGORY_KEY)}\n                required\n                ref={r => requiredFields.add(r)}\n                selectAllOnFocus\n                onValidationError={this.props.onValidationError}\n              />\n            </td>\n            <td>\n              <TextField\n                name='Concepto de deducción'\n                value={charge[CHARGES_CONCEPT_KEY]}\n                onChange={this.onChange.bind(this, index, CHARGES_CONCEPT_KEY)}\n                required\n                ref={r => requiredFields.add(r)}\n                selectAllOnFocus\n                onValidationError={this.props.onValidationError}\n              />\n            </td>\n            <td>\n              <TextField\n                value={charge[CHARGES_AMOUNT_KEY]}\n                onChange={this.onChange.bind(this, index, CHARGES_AMOUNT_KEY)}\n                onBlur={this.formatPrice.bind(this, index, CHARGES_AMOUNT_KEY)}\n                onFocus={this.unformatPrice.bind(\n                  this,\n                  index,\n                  CHARGES_AMOUNT_KEY\n                )}\n                selectAllOnFocus\n              />\n            </td>\n            <td>\n              <p\n                className={classNames('table--actions', {\n                  'is-hidden': this.state[CHARGES_KEY].length <= 1\n                })}\n              >\n                <IconButton\n                  icon='delete'\n                  onClick={this.deleteItem.bind(this, index)}\n                  tooltip='Borrar'\n                />\n              </p>\n            </td>\n          </tr>\n        )\n      })\n    }\n    return chargeList\n  }\n\n  // Main render\n  render () {\n    return (\n      <div>\n        <h3 className='subheader-green'>Deducciones</h3>\n        <table className='table'>\n          <thead>\n            <tr>\n              <th>Tipo</th>\n              <th>Categoría personalizada (Min 4 dígitos)</th>\n              <th>Concepto</th>\n              <th>Importe</th>\n              <th>Acciones</th>\n            </tr>\n          </thead>\n          <tbody>{this.renderItemList()}</tbody>\n          <Button\n            buttonStyle='primaryLink'\n            icon='plus'\n            onClick={this.addItem.bind(this)}\n          >\n            Agregar Deducción\n          </Button>\n          <tfoot>\n            <tr>\n              <td colSpan={2} />\n              <td>Subtotal:</td>\n              <td>\n                {accounting.formatMoney(this.state[SUBTOTAL_KEY], '$ ', 2)}\n              </td>\n              <td colSpan={1} />\n            </tr>\n          </tfoot>\n        </table>\n      </div>\n    )\n  }\n}\n\nDeductions.propTypes = {\n  onValidationError: PropTypes.func,\n  updatePayrollTotals: PropTypes.func,\n  keyId: PropTypes.string\n}\n\nDeductions.defaultProps = {\n  onValidationError: () => {}\n}\n\nexport default Deductions\n"]},"metadata":{},"sourceType":"module"}