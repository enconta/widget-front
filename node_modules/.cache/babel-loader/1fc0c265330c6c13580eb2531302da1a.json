{"ast":null,"code":"import _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/documents/index.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport accounting from 'accounting';\nimport AppSignal from 'appsignal';\nimport API from 'api';\nimport { prettyPeriod, resetScroll } from 'utils';\nimport Card from 'shared/card';\nimport TextField from 'shared/textField';\nimport SelectField from 'shared/selectField';\nimport Paginator from 'shared/paginator';\nimport Button from 'shared/button';\nimport IconButton from 'shared/iconButton';\nimport TableFilter from 'shared/tableFilter';\nimport { Link } from 'react-router';\nimport NotificationsActions from 'actions/notifications';\nimport DocumentsActions from 'actions/documents';\nimport DocumentsStore from 'stores/documents';\nimport { DOCUMENT_CATEGORIES, MONTHS, ALL_ITEMS } from 'shared/catalogs';\n\nvar YEARS = _toConsumableArray(new Array(moment().year() - 2011)).map(function (x, i) {\n  return (moment().year() - i).toString();\n}); // Create an array of category labels with id's as key\n\n\nvar PARSED_CATEGORIES = DOCUMENT_CATEGORIES.map(function (category) {\n  return _defineProperty({}, category.id, category.label);\n}).reduce(function (acc, curr) {\n  return Object.assign(acc, curr);\n}, {}); // Render single document for documents table\n\nvar Doc = function Doc(_ref2) {\n  var id = _ref2.id,\n      name = _ref2.name,\n      documentType = _ref2.document_type,\n      taxMonth = _ref2.tax_month,\n      url = _ref2.url;\n  return React.createElement(\"tr\", {\n    key: id,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    className: \"align-left flexCell\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/documentos/ver/\".concat(id),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47\n    },\n    __self: this\n  }, name)), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49\n    },\n    __self: this\n  }, PARSED_CATEGORIES[documentType]), React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50\n    },\n    __self: this\n  }, prettyPeriod(taxMonth, 'YYYY-MM-DD', true, '-')), React.createElement(\"td\", {\n    className: \"table--actions\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51\n    },\n    __self: this\n  }, React.createElement(\"a\", {\n    href: url,\n    className: \"icon-button\",\n    download: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52\n    },\n    __self: this\n  }, React.createElement(IconButton, {\n    icon: \"download\",\n    tooltip: \"Descargar\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53\n    },\n    __self: this\n  })), React.createElement(Link, {\n    to: \"/documentos/editar/\".concat(id),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55\n    },\n    __self: this\n  }, React.createElement(IconButton, {\n    icon: \"pencil\",\n    tooltip: \"Editar\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56\n    },\n    __self: this\n  }))));\n};\n\nfunction getCurrentState() {\n  var documents = DocumentsStore.getDocumentsList();\n  var totalPages = DocumentsStore.getTotalPages();\n  var totalItems = DocumentsStore.getTotalItems();\n  return {\n    documents: documents,\n    totalPages: totalPages,\n    totalItems: totalItems\n  };\n}\n/*\n * Documents is a list of files uploaded by the user\n */\n\n\nvar Documents =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Documents, _Component);\n\n  function Documents() {\n    var _this;\n\n    _classCallCheck(this, Documents);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Documents).call(this));\n\n    _this.renderAdvertisment = function () {\n      var lastAccountingPeriod = _this.state.lastAccountingPeriod;\n      var link = lastAccountingPeriod ? \"/mi-contabilidad/\".concat(Number(lastAccountingPeriod.id), \"/ver\") : '/mi-contabilidad/';\n      return React.createElement(\"div\", {\n        className: \"app-wide-notifications\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"app-wide-notifications--notification light-blue\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 242\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"columns is-vcentered\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"column is-narrow\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 244\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"mdi mdi-information-outline icon\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"column is-10\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }, React.createElement(Link, {\n        to: link,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        className: \"app-wide-notifications--notification__text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }, \"Ahora tus res\\xFAmenes de movimientos se suben\", ' ', React.createElement(\"span\", {\n        className: \"text--highlighted\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, \"aqu\\xED.\")))))));\n    };\n\n    _this.data = {\n      filters: {\n        document_type: '',\n        month: '',\n        year: ''\n      },\n      lastAccountingPeriod: null\n    };\n    _this.state = Object.assign({}, _this.data, getCurrentState());\n    _this._onChange = _this._onChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Documents, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      DocumentsStore.addChangeListener(this._onChange);\n      this.loadData();\n      resetScroll();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.location.search !== prevProps.location.search) {\n        this.loadData(this.props);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      DocumentsStore.removeChangeListener(this._onChange);\n    }\n  }, {\n    key: \"_onChange\",\n    value: function _onChange() {\n      var state = getCurrentState();\n      this.setState(state);\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData() {\n      var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.props;\n      var params = Object.assign({}, props.location.query);\n      DocumentsActions.getDocumentsList(params);\n      this.getLastAccountingPeriod();\n      this.setState(function (prevState) {\n        return {\n          filters: Object.assign({}, prevState.filters, params)\n        };\n      });\n    }\n  }, {\n    key: \"getLastAccountingPeriod\",\n    value: function getLastAccountingPeriod() {\n      var _this2 = this;\n\n      API.AccountingPeriods.List().then(function (_ref3) {\n        var accountingPeriods = _ref3.accounting_periods;\n\n        _this2.setState({\n          lastAccountingPeriod: accountingPeriods[0]\n        });\n      });\n    }\n  }, {\n    key: \"deleteDocument\",\n    value: function deleteDocument(id) {\n      var _this3 = this;\n\n      API.Documents.DeleteDocument(id).then(function () {\n        NotificationsActions.success('Archivo borrado');\n\n        _this3.loadData();\n      }).catch(function (error) {\n        AppSignal.sendError(error);\n        NotificationsActions.error('Hubo un error al borrar el archivo');\n      });\n    }\n  }, {\n    key: \"onChangeFilter\",\n    value: function onChangeFilter(field, e) {\n      var filter = _defineProperty({}, field, e.target.value);\n\n      this.setState(function (prevState) {\n        return {\n          filters: Object.assign({}, prevState.filters, filter)\n        };\n      });\n    }\n  }, {\n    key: \"clearFilters\",\n    value: function clearFilters() {\n      this.setState({\n        filters: this.data.filters\n      });\n    }\n  }, {\n    key: \"renderNewButton\",\n    value: function renderNewButton() {\n      return React.createElement(Link, {\n        to: \"/documentos/nuevo\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, React.createElement(Button, {\n        className: \"is-pulled-right\",\n        buttonStyle: \"primary\",\n        icon: \"file-outline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, \"Nuevo Documento\"));\n    }\n  }, {\n    key: \"renderFilters\",\n    value: function renderFilters() {\n      var filters = this.state.filters;\n      return React.createElement(TableFilter, {\n        baseUrl: \"/documentos\",\n        filters: filters,\n        onClearFilters: this.clearFilters.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        placeholder: \"Nombre\",\n        value: filters.doc_name,\n        onChange: this.onChangeFilter.bind(this, 'doc_name'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }), React.createElement(SelectField, {\n        options: [].concat(_toConsumableArray(ALL_ITEMS), _toConsumableArray(DOCUMENT_CATEGORIES)),\n        value: filters.document_type,\n        placeholder: \"Tipo de documento\",\n        onChange: this.onChangeFilter.bind(this, 'document_type'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }), React.createElement(SelectField, {\n        options: [].concat(_toConsumableArray(ALL_ITEMS), _toConsumableArray(YEARS)),\n        value: filters.year,\n        placeholder: \"Seleccionar a\\xF1o\",\n        onChange: this.onChangeFilter.bind(this, 'year'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }), React.createElement(SelectField, {\n        options: [].concat(_toConsumableArray(ALL_ITEMS), _toConsumableArray(MONTHS)),\n        value: filters.month,\n        onChange: this.onChangeFilter.bind(this, 'month'),\n        placeholder: \"Mes\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }));\n    } // Render a list of documents, shows a special message if there's no documents\n\n  }, {\n    key: \"renderTable\",\n    value: function renderTable() {\n      var _this$state = this.state,\n          documents = _this$state.documents,\n          totalPages = _this$state.totalPages;\n      var renderTable = React.createElement(\"div\", {\n        className: \"block unselectable\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, \"No hay documentos\"));\n\n      if (documents.length > 0) {\n        var documentsList = documents.map(function (doc) {\n          return React.createElement(Doc, Object.assign({}, doc, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 212\n            },\n            __self: this\n          }));\n        });\n        renderTable = React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 214\n          },\n          __self: this\n        }, React.createElement(\"table\", {\n          className: \"table fixedTable\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 215\n          },\n          __self: this\n        }, React.createElement(\"thead\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 216\n          },\n          __self: this\n        }, React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 217\n          },\n          __self: this\n        }, React.createElement(\"th\", {\n          className: \"align-left\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 218\n          },\n          __self: this\n        }, \"Nombre\"), React.createElement(\"th\", {\n          style: {\n            width: '19rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 219\n          },\n          __self: this\n        }, \"Tipo de documento\"), React.createElement(\"th\", {\n          className: \"nowrap\",\n          style: {\n            width: '10rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 220\n          },\n          __self: this\n        }, \"Periodo\"), React.createElement(\"th\", {\n          style: {\n            width: '8rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 223\n          },\n          __self: this\n        }))), React.createElement(\"tbody\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 226\n          },\n          __self: this\n        }, documentsList)), React.createElement(Paginator, {\n          totalPages: totalPages,\n          location: this.props.location,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 228\n          },\n          __self: this\n        }));\n      }\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 232\n        },\n        __self: this\n      }, renderTable);\n    }\n  }, {\n    key: \"render\",\n    // Main render\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 263\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        className: \"headline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      }, \"Documentos\", this.renderNewButton()), React.createElement(Card, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268\n        },\n        __self: this\n      }, this.renderFilters(), this.renderAdvertisment(), React.createElement(\"div\", {\n        className: \"caption\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, accounting.formatNumber(this.state.totalItems), \" documentos visibles\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 274\n        },\n        __self: this\n      }), this.renderTable()));\n    }\n  }]);\n\n  return Documents;\n}(Component);\n\nDocuments.propTypes = {\n  location: PropTypes.object\n};\nDoc.propTypes = {\n  id: PropTypes.string,\n  name: PropTypes.string,\n  document_type: PropTypes.string,\n  tax_month: PropTypes.string,\n  url: PropTypes.string\n};\nexport default Documents;","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/documents/index.js"],"names":["React","Component","PropTypes","moment","accounting","AppSignal","API","prettyPeriod","resetScroll","Card","TextField","SelectField","Paginator","Button","IconButton","TableFilter","Link","NotificationsActions","DocumentsActions","DocumentsStore","DOCUMENT_CATEGORIES","MONTHS","ALL_ITEMS","YEARS","Array","year","map","x","i","toString","PARSED_CATEGORIES","category","id","label","reduce","acc","curr","Object","assign","Doc","name","documentType","document_type","taxMonth","tax_month","url","getCurrentState","documents","getDocumentsList","totalPages","getTotalPages","totalItems","getTotalItems","Documents","renderAdvertisment","lastAccountingPeriod","state","link","Number","data","filters","month","_onChange","bind","addChangeListener","loadData","prevProps","props","location","search","removeChangeListener","setState","params","query","getLastAccountingPeriod","prevState","AccountingPeriods","List","then","accountingPeriods","accounting_periods","DeleteDocument","success","catch","error","sendError","field","e","filter","target","value","clearFilters","doc_name","onChangeFilter","renderTable","length","documentsList","doc","width","renderNewButton","renderFilters","formatNumber","propTypes","object","string"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport moment from 'moment'\nimport accounting from 'accounting'\nimport AppSignal from 'appsignal'\nimport API from 'api'\nimport { prettyPeriod, resetScroll } from 'utils'\n\nimport Card from 'shared/card'\nimport TextField from 'shared/textField'\nimport SelectField from 'shared/selectField'\nimport Paginator from 'shared/paginator'\nimport Button from 'shared/button'\nimport IconButton from 'shared/iconButton'\nimport TableFilter from 'shared/tableFilter'\nimport { Link } from 'react-router'\n\nimport NotificationsActions from 'actions/notifications'\nimport DocumentsActions from 'actions/documents'\n\nimport DocumentsStore from 'stores/documents'\n\nimport { DOCUMENT_CATEGORIES, MONTHS, ALL_ITEMS } from 'shared/catalogs'\n\nconst YEARS = [...new Array(moment().year() - 2011)].map((x, i) =>\n  (moment().year() - i).toString()\n)\n\n// Create an array of category labels with id's as key\nconst PARSED_CATEGORIES = DOCUMENT_CATEGORIES.map(category => {\n  return { [category.id]: category.label }\n}).reduce((acc, curr) => {\n  return Object.assign(acc, curr)\n}, {})\n\n// Render single document for documents table\nconst Doc = ({\n  id,\n  name,\n  document_type: documentType,\n  tax_month: taxMonth,\n  url\n}) => {\n  return (\n    <tr key={id}>\n      <td className='align-left flexCell'>\n        <Link to={`/documentos/ver/${id}`}>{name}</Link>\n      </td>\n      <td>{PARSED_CATEGORIES[documentType]}</td>\n      <td>{prettyPeriod(taxMonth, 'YYYY-MM-DD', true, '-')}</td>\n      <td className='table--actions'>\n        <a href={url} className='icon-button' download>\n          <IconButton icon='download' tooltip='Descargar' />\n        </a>\n        <Link to={`/documentos/editar/${id}`}>\n          <IconButton icon='pencil' tooltip='Editar' />\n        </Link>\n      </td>\n    </tr>\n  )\n}\n\nfunction getCurrentState () {\n  const documents = DocumentsStore.getDocumentsList()\n  const totalPages = DocumentsStore.getTotalPages()\n  const totalItems = DocumentsStore.getTotalItems()\n  return {\n    documents,\n    totalPages,\n    totalItems\n  }\n}\n\n/*\n * Documents is a list of files uploaded by the user\n */\n\nclass Documents extends Component {\n  constructor () {\n    super()\n    this.data = {\n      filters: {\n        document_type: '',\n        month: '',\n        year: ''\n      },\n      lastAccountingPeriod: null\n    }\n    this.state = Object.assign({}, this.data, getCurrentState())\n    this._onChange = this._onChange.bind(this)\n  }\n\n  componentDidMount () {\n    DocumentsStore.addChangeListener(this._onChange)\n    this.loadData()\n    resetScroll()\n  }\n\n  componentDidUpdate (prevProps) {\n    if (this.props.location.search !== prevProps.location.search) {\n      this.loadData(this.props)\n    }\n  }\n\n  componentWillUnmount () {\n    DocumentsStore.removeChangeListener(this._onChange)\n  }\n\n  _onChange () {\n    const state = getCurrentState()\n    this.setState(state)\n  }\n\n  loadData (props = this.props) {\n    const params = Object.assign({}, props.location.query)\n    DocumentsActions.getDocumentsList(params)\n    this.getLastAccountingPeriod()\n    this.setState(prevState => ({\n      filters: Object.assign({}, prevState.filters, params)\n    }))\n  }\n\n  getLastAccountingPeriod () {\n    API.AccountingPeriods.List().then(\n      ({ accounting_periods: accountingPeriods }) => {\n        this.setState({ lastAccountingPeriod: accountingPeriods[0] })\n      }\n    )\n  }\n\n  deleteDocument (id) {\n    API.Documents.DeleteDocument(id)\n      .then(() => {\n        NotificationsActions.success('Archivo borrado')\n        this.loadData()\n      })\n      .catch(error => {\n        AppSignal.sendError(error)\n        NotificationsActions.error('Hubo un error al borrar el archivo')\n      })\n  }\n\n  onChangeFilter (field, e) {\n    const filter = { [field]: e.target.value }\n    this.setState(prevState => ({\n      filters: Object.assign({}, prevState.filters, filter)\n    }))\n  }\n\n  clearFilters () {\n    this.setState({ filters: this.data.filters })\n  }\n\n  renderNewButton () {\n    return (\n      <Link to='/documentos/nuevo'>\n        <Button\n          className='is-pulled-right'\n          buttonStyle='primary'\n          icon='file-outline'\n        >\n          Nuevo Documento\n        </Button>\n      </Link>\n    )\n  }\n\n  renderFilters () {\n    const { filters } = this.state\n    return (\n      <TableFilter\n        baseUrl='/documentos'\n        filters={filters}\n        onClearFilters={this.clearFilters.bind(this)}\n      >\n        <TextField\n          placeholder='Nombre'\n          value={filters.doc_name}\n          onChange={this.onChangeFilter.bind(this, 'doc_name')}\n        />\n        <SelectField\n          options={[...ALL_ITEMS, ...DOCUMENT_CATEGORIES]}\n          value={filters.document_type}\n          placeholder='Tipo de documento'\n          onChange={this.onChangeFilter.bind(this, 'document_type')}\n        />\n        <SelectField\n          options={[...ALL_ITEMS, ...YEARS]}\n          value={filters.year}\n          placeholder='Seleccionar año'\n          onChange={this.onChangeFilter.bind(this, 'year')}\n        />\n        <SelectField\n          options={[...ALL_ITEMS, ...MONTHS]}\n          value={filters.month}\n          onChange={this.onChangeFilter.bind(this, 'month')}\n          placeholder='Mes'\n        />\n      </TableFilter>\n    )\n  }\n\n  // Render a list of documents, shows a special message if there's no documents\n  renderTable () {\n    const { documents, totalPages } = this.state\n    let renderTable = (\n      <div className='block unselectable'>\n        <p>No hay documentos</p>\n      </div>\n    )\n    if (documents.length > 0) {\n      let documentsList = documents.map(doc => <Doc {...doc} />)\n      renderTable = (\n        <div>\n          <table className='table fixedTable'>\n            <thead>\n              <tr>\n                <th className='align-left'>Nombre</th>\n                <th style={{ width: '19rem' }}>Tipo de documento</th>\n                <th className='nowrap' style={{ width: '10rem' }}>\n                  Periodo\n                </th>\n                <th style={{ width: '8rem' }} />\n              </tr>\n            </thead>\n            <tbody>{documentsList}</tbody>\n          </table>\n          <Paginator totalPages={totalPages} location={this.props.location} />\n        </div>\n      )\n    }\n    return <div>{renderTable}</div>\n  }\n  renderAdvertisment = () => {\n    const { lastAccountingPeriod } = this.state\n    const link = lastAccountingPeriod\n      ? `/mi-contabilidad/${Number(lastAccountingPeriod.id)}/ver`\n      : '/mi-contabilidad/'\n\n    return (\n      <div className='app-wide-notifications'>\n        <div className='app-wide-notifications--notification light-blue'>\n          <div className='columns is-vcentered'>\n            <div className='column is-narrow'>\n              <i className='mdi mdi-information-outline icon' />\n            </div>\n            <div className='column is-10'>\n              <Link to={link}>\n                <p className='app-wide-notifications--notification__text'>\n                  Ahora tus resúmenes de movimientos se suben{' '}\n                  <span className='text--highlighted'>aquí.</span>\n                </p>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n  // Main render\n  render () {\n    return (\n      <div>\n        <h1 className='headline'>\n          Documentos\n          {this.renderNewButton()}\n        </h1>\n        <Card>\n          {this.renderFilters()}\n          {this.renderAdvertisment()}\n          <div className='caption'>\n            {accounting.formatNumber(this.state.totalItems)} documentos visibles\n          </div>\n          <br />\n          {this.renderTable()}\n        </Card>\n      </div>\n    )\n  }\n}\n\nDocuments.propTypes = {\n  location: PropTypes.object\n}\n\nDoc.propTypes = {\n  id: PropTypes.string,\n  name: PropTypes.string,\n  document_type: PropTypes.string,\n  tax_month: PropTypes.string,\n  url: PropTypes.string\n}\n\nexport default Documents\n"]},"metadata":{},"sourceType":"module"}