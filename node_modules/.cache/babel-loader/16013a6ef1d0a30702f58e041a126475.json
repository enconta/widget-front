{"ast":null,"code":"import _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/newInvoice/shared/payrollCharges/otherPerceptions/index.js\";\n// Libraries\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport accounting from 'accounting';\nimport classNames from 'classnames';\nimport uuid from 'uuid';\nimport moment from 'moment'; // Catalogs\n\nimport { OTHER_PAYMENT_TYPE } from 'shared/catalogs';\nimport SelectField from 'shared/selectField';\nimport IconButton from 'shared/iconButton';\nimport TextField from 'shared/textField';\nimport Button from 'shared/button';\nimport { amountToCents, absolutify } from 'utils';\nvar YEARS = [(moment().year() - 1).toString(), moment().year().toString()];\nvar requiredFields = new Set();\n\nvar OtherPerceptions =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(OtherPerceptions, _Component);\n\n  function OtherPerceptions() {\n    var _this;\n\n    _classCallCheck(this, OtherPerceptions);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(OtherPerceptions).call(this));\n    _this.data = {\n      charges: [],\n      chargesSubtotal: 0\n    };\n    _this.state = Object.assign({}, _this.data);\n    return _this;\n  }\n\n  _createClass(OtherPerceptions, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Clears the stored requiredFields\n      requiredFields.clear();\n    }\n  }, {\n    key: \"exportOtherPerceptions\",\n    value: function exportOtherPerceptions() {\n      return this.state.charges.map(function (charge) {\n        var subsidyCausedCents = {\n          subsidy_caused_cents: amountToCents(charge.subsidy_caused)\n        };\n        var employmentSubsidyMg = {\n          employment_subsidy_mg: subsidyCausedCents\n        };\n        var favorBalanceCents = {\n          favor_balance_cents: amountToCents(charge.favor_balance),\n          year: Number(charge.year),\n          remainder_cents: amountToCents(charge.remainder)\n        };\n        var compensationFavorBalanceMg = {\n          compensation_favor_balance_mg: favorBalanceCents\n        };\n        return _objectSpread({\n          type: charge.kind,\n          clave: charge.category,\n          concept: charge.concept,\n          amount_cents: amountToCents(charge.amount)\n        }, charge.kind === '002' ? employmentSubsidyMg : {}, charge.kind === '004' ? compensationFavorBalanceMg : {});\n      });\n    } // Iterates over required fields and validates every one of them\n    // Then it returns true if all validations succeedeed, else false.\n\n  }, {\n    key: \"validateRequiredFields\",\n    value: function validateRequiredFields() {\n      var _this2 = this;\n\n      return _toConsumableArray(requiredFields) // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(function (form) {\n        return form.validate.call(_this2);\n      }) // Calls the validate() method on each form\n      .every(function (e) {\n        return e;\n      }); // Checks if all validations suceeded\n    } // Adds one otherPerception to this.state.charges\n\n  }, {\n    key: \"addItem\",\n    value: function addItem() {\n      this.setState({\n        charges: [].concat(_toConsumableArray(this.state.charges), [{\n          id: uuid(),\n          kind: '',\n          category: '',\n          concept: '',\n          amount: 0,\n          subsidy_caused: 0,\n          favor_balance: 0,\n          year: YEARS[0],\n          remainder: 0\n        }])\n      });\n    }\n  }, {\n    key: \"setCharges\",\n    value: function setCharges(chargeId, field, value) {\n      var _this3 = this;\n\n      this.setState(function (prevState) {\n        return {\n          charges: prevState.charges.map(function (charge) {\n            return charge.id === chargeId ? Object.assign({}, charge, _defineProperty({}, field, value)) : charge;\n          })\n        };\n      }, function () {\n        if (field === 'amount') _this3.updateSubtotals();\n      });\n    } // Persist fields to charge\n\n  }, {\n    key: \"onChange\",\n    value: function onChange(chargeId, field, e) {\n      var value = e.target.value;\n      this.setCharges(chargeId, field, value);\n    } // Format price as $ 1,234.56\n\n  }, {\n    key: \"formatPrice\",\n    value: function formatPrice(chargeId, field) {\n      var charge = this.state.charges.find(function (charge) {\n        return charge.id === chargeId;\n      });\n      var formatted = accounting.formatMoney(absolutify(charge[field]), '$ ');\n      this.setCharges(chargeId, field, formatted);\n    } // Parse formatted price\n\n  }, {\n    key: \"unformatPrice\",\n    value: function unformatPrice(chargeId, field) {\n      var charge = this.state.charges.find(function (charge) {\n        return charge.id === chargeId;\n      });\n      var unformatted = absolutify(charge[field]);\n      this.setCharges(chargeId, field, unformatted);\n    } // Update subtotal\n\n  }, {\n    key: \"updateSubtotals\",\n    value: function updateSubtotals() {\n      // Iterates over every charge and acumulativamente adds it and assigns the result to subtotal\n      var chargesSubtotal = this.state.charges.reduce(function (acc, charge) {\n        return acc + absolutify(charge.amount);\n      }, 0); // Update parent totals and subtotals\n\n      this.props.updatePayrollTotals(this.props.keyId, chargesSubtotal);\n      this.setState({\n        chargesSubtotal: chargesSubtotal.toFixed(2)\n      });\n    } // Delete an otherPerception from this.state.charges\n\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(chargeId) {\n      requiredFields.clear();\n      this.setState({\n        charges: this.state.charges.filter(function (charge) {\n          return charge.id !== chargeId;\n        })\n      }, this.updateSubtotals);\n    }\n  }, {\n    key: \"renderSubsidyField\",\n    value: function renderSubsidyField(charge) {\n      if (this.state.charges.some(function (charge) {\n        return charge.kind === '002';\n      })) {\n        return React.createElement(\"td\", {\n          style: {\n            minWidth: '7rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 164\n          },\n          __self: this\n        }, charge.kind === '002' ? React.createElement(TextField, {\n          value: charge.subsidy_caused,\n          onChange: this.onChange.bind(this, charge.id, 'subsidy_caused'),\n          onBlur: this.formatPrice.bind(this, charge.id, 'subsidy_caused'),\n          onFocus: this.unformatPrice.bind(this, charge.id, 'subsidy_caused'),\n          selectAllOnFocus: true,\n          required: true,\n          onValidationError: this.props.onValidationError,\n          name: \"Subsidio causado de otro pago\",\n          ref: function ref(r) {\n            return requiredFields.add(r);\n          } // agregar cosa de isValid con una funcion que regrese la validez del campo\n          // en este caso seria que debe ser mayor al charge.amount\n          ,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166\n          },\n          __self: this\n        }) : null);\n      }\n\n      return null;\n    }\n  }, {\n    key: \"renderCompensationFields\",\n    value: function renderCompensationFields(charge) {\n      if (this.state.charges.some(function (charge) {\n        return charge.kind === '004';\n      })) {\n        if (charge.kind === '004') {\n          return [React.createElement(\"td\", {\n            style: {\n              minWidth: '7rem'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 194\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            value: charge.favor_balance,\n            onChange: this.onChange.bind(this, charge.id, 'favor_balance'),\n            onBlur: this.formatPrice.bind(this, charge.id, 'favor_balance'),\n            onFocus: this.unformatPrice.bind(this, charge.id, 'favor_balance'),\n            selectAllOnFocus: true,\n            required: true,\n            onValidationError: this.props.onValidationError,\n            name: \"Saldo a favor de otro pago\",\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 195\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            style: {\n              minWidth: '7rem'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 211\n            },\n            __self: this\n          }, React.createElement(SelectField, {\n            value: charge.year,\n            options: YEARS,\n            onChange: this.onChange.bind(this, charge.id, 'year'),\n            required: true,\n            onValidationError: this.props.onValidationError,\n            name: \"A\\xF1o de otro pago\",\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 212\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            style: {\n              minWidth: '7rem'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 222\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            value: charge.remainder,\n            onChange: this.onChange.bind(this, charge.id, 'remainder'),\n            onBlur: this.formatPrice.bind(this, charge.id, 'remainder'),\n            onFocus: this.unformatPrice.bind(this, charge.id, 'remainder'),\n            selectAllOnFocus: true,\n            required: true,\n            onValidationError: this.props.onValidationError,\n            name: \"Remanente del saldo a favor de otro pago\",\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 223\n            },\n            __self: this\n          }))];\n        } else {\n          return [React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 237\n            },\n            __self: this\n          }), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 237\n            },\n            __self: this\n          }), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 237\n            },\n            __self: this\n          })];\n        }\n      }\n\n      return null;\n    } // Items\n\n  }, {\n    key: \"renderItemList\",\n    value: function renderItemList() {\n      var _this4 = this;\n\n      var chargeList = null;\n\n      if (this.state.charges.length > 0) {\n        chargeList = this.state.charges.map(function (charge) {\n          return React.createElement(\"tr\", {\n            key: charge.id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 249\n            },\n            __self: this\n          }, React.createElement(\"td\", {\n            className: \"is-one-quarter\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 250\n            },\n            __self: this\n          }, React.createElement(SelectField, {\n            placeholder: \"Selecciona una opci\\xF3n\",\n            options: OTHER_PAYMENT_TYPE,\n            value: charge.kind,\n            onChange: _this4.onChange.bind(_this4, charge.id, 'kind'),\n            required: true,\n            onValidationError: _this4.props.onValidationError,\n            name: \"Tipo de otro pago\",\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            showId: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 251\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 263\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            value: charge.category,\n            onChange: _this4.onChange.bind(_this4, charge.id, 'category'),\n            required: true,\n            onValidationError: _this4.props.onValidationError,\n            name: \"Categor\\xEDa personalizada de otro pago\",\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            selectAllOnFocus: true,\n            minLength: 4,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 264\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 275\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            value: charge.concept,\n            onChange: _this4.onChange.bind(_this4, charge.id, 'concept'),\n            required: true,\n            onValidationError: _this4.props.onValidationError,\n            name: \"Concepto de otro pago\",\n            ref: function ref(r) {\n              return requiredFields.add(r);\n            },\n            selectAllOnFocus: true,\n            minLength: 4,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 276\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            style: {\n              minWidth: '7rem'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 287\n            },\n            __self: this\n          }, React.createElement(TextField, {\n            value: charge.amount,\n            onChange: _this4.onChange.bind(_this4, charge.id, 'amount'),\n            onBlur: _this4.formatPrice.bind(_this4, charge.id, 'amount'),\n            onFocus: _this4.unformatPrice.bind(_this4, charge.id, 'amount'),\n            selectAllOnFocus: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 288\n            },\n            __self: this\n          })), _this4.renderSubsidyField(charge), _this4.renderCompensationFields(charge), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 298\n            },\n            __self: this\n          }, React.createElement(\"p\", {\n            className: \"table--actions\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 299\n            },\n            __self: this\n          }, React.createElement(IconButton, {\n            icon: \"delete\",\n            onClick: _this4.deleteItem.bind(_this4, charge.id),\n            tooltip: \"Borrar\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 300\n            },\n            __self: this\n          }))));\n        });\n      }\n\n      return chargeList;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var charges = this.state.charges;\n      var subtotalColSpan = 2;\n      if (charges.some(function (charge) {\n        return charge.kind === '002';\n      })) subtotalColSpan += 1;\n      if (charges.some(function (charge) {\n        return charge.kind === '004';\n      })) subtotalColSpan += 3;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        className: \"subheader-green\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321\n        },\n        __self: this\n      }, \"Otros Pagos\"), React.createElement(Button, {\n        buttonStyle: \"primaryLink\",\n        icon: \"plus\",\n        className: classNames({\n          'is-hidden': charges.length >= 1\n        }),\n        onClick: this.addItem.bind(this),\n        style: {\n          marginBottom: '1.5rem'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322\n        },\n        __self: this\n      }, \"Agregar Otro Pago\"), React.createElement(\"table\", {\n        className: classNames('table', {\n          'is-hidden': charges.length < 1\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 331\n        },\n        __self: this\n      }, React.createElement(\"thead\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335\n        },\n        __self: this\n      }, React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 336\n        },\n        __self: this\n      }, \"Tipo\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 337\n        },\n        __self: this\n      }, \"Categor\\xEDa personalizada (Min 4 d\\xEDgitos)\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 338\n        },\n        __self: this\n      }, \"Concepto\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 339\n        },\n        __self: this\n      }, \"Importe\"), React.createElement(\"th\", {\n        className: classNames({\n          'is-hidden': charges.every(function (charge) {\n            return charge.kind !== '002';\n          })\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 340\n        },\n        __self: this\n      }, \"Subsidio Causado\"), React.createElement(\"th\", {\n        className: classNames({\n          'is-hidden': charges.every(function (charge) {\n            return charge.kind !== '004';\n          })\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 347\n        },\n        __self: this\n      }, \"Saldo a favor\"), React.createElement(\"th\", {\n        className: classNames({\n          'is-hidden': charges.every(function (charge) {\n            return charge.kind !== '004';\n          })\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 354\n        },\n        __self: this\n      }, \"A\\xF1o\"), React.createElement(\"th\", {\n        className: classNames({\n          'is-hidden': charges.every(function (charge) {\n            return charge.kind !== '004';\n          })\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 361\n        },\n        __self: this\n      }, \"Remanente del saldo a favor\"), React.createElement(\"th\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 368\n        },\n        __self: this\n      }, \"Acciones\"))), React.createElement(\"tbody\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 371\n        },\n        __self: this\n      }, this.renderItemList()), React.createElement(Button, {\n        buttonStyle: \"primaryLink\",\n        icon: \"plus\",\n        className: classNames({\n          'is-hidden': charges.length < 1\n        }),\n        onClick: this.addItem.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372\n        },\n        __self: this\n      }, \"Agregar Otro Pago\"), React.createElement(\"tfoot\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 380\n        },\n        __self: this\n      }, React.createElement(\"tr\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 381\n        },\n        __self: this\n      }, React.createElement(\"td\", {\n        colSpan: subtotalColSpan,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 382\n        },\n        __self: this\n      }), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 383\n        },\n        __self: this\n      }, \"Subtotal:\"), React.createElement(\"td\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 384\n        },\n        __self: this\n      }, accounting.formatMoney(this.state.chargesSubtotal, '$ ')), React.createElement(\"td\", {\n        colSpan: 1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 387\n        },\n        __self: this\n      })))));\n    }\n  }]);\n\n  return OtherPerceptions;\n}(Component);\n\nOtherPerceptions.propTypes = {\n  onValidationError: PropTypes.func,\n  updatePayrollTotals: PropTypes.func,\n  keyId: PropTypes.string\n};\nOtherPerceptions.defaultProps = {\n  onValidationError: function onValidationError() {}\n};\nexport default OtherPerceptions;","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/newInvoice/shared/payrollCharges/otherPerceptions/index.js"],"names":["React","Component","PropTypes","accounting","classNames","uuid","moment","OTHER_PAYMENT_TYPE","SelectField","IconButton","TextField","Button","amountToCents","absolutify","YEARS","year","toString","requiredFields","Set","OtherPerceptions","data","charges","chargesSubtotal","state","Object","assign","clear","map","charge","subsidyCausedCents","subsidy_caused_cents","subsidy_caused","employmentSubsidyMg","employment_subsidy_mg","favorBalanceCents","favor_balance_cents","favor_balance","Number","remainder_cents","remainder","compensationFavorBalanceMg","compensation_favor_balance_mg","type","kind","clave","category","concept","amount_cents","amount","filter","Boolean","form","validate","call","every","e","setState","id","chargeId","field","value","prevState","updateSubtotals","target","setCharges","find","formatted","formatMoney","unformatted","reduce","acc","props","updatePayrollTotals","keyId","toFixed","some","minWidth","onChange","bind","formatPrice","unformatPrice","onValidationError","r","add","chargeList","length","renderSubsidyField","renderCompensationFields","deleteItem","subtotalColSpan","addItem","marginBottom","renderItemList","propTypes","func","string","defaultProps"],"mappings":"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","sourcesContent":["// Libraries\nimport React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport accounting from 'accounting'\nimport classNames from 'classnames'\nimport uuid from 'uuid'\nimport moment from 'moment'\n\n// Catalogs\nimport { OTHER_PAYMENT_TYPE } from 'shared/catalogs'\nimport SelectField from 'shared/selectField'\nimport IconButton from 'shared/iconButton'\nimport TextField from 'shared/textField'\nimport Button from 'shared/button'\nimport { amountToCents, absolutify } from 'utils'\n\nconst YEARS = [\n  (moment().year() - 1).toString(),\n  moment()\n    .year()\n    .toString()\n]\n\nconst requiredFields = new Set()\n\nclass OtherPerceptions extends Component {\n  constructor () {\n    super()\n    this.data = {\n      charges: [],\n      chargesSubtotal: 0\n    }\n    this.state = Object.assign({}, this.data)\n  }\n\n  componentWillUnmount () {\n    // Clears the stored requiredFields\n    requiredFields.clear()\n  }\n\n  exportOtherPerceptions () {\n    return this.state.charges.map(charge => {\n      const subsidyCausedCents = {\n        subsidy_caused_cents: amountToCents(charge.subsidy_caused)\n      }\n\n      const employmentSubsidyMg = {\n        employment_subsidy_mg: subsidyCausedCents\n      }\n\n      const favorBalanceCents = {\n        favor_balance_cents: amountToCents(charge.favor_balance),\n        year: Number(charge.year),\n        remainder_cents: amountToCents(charge.remainder)\n      }\n\n      const compensationFavorBalanceMg = {\n        compensation_favor_balance_mg: favorBalanceCents\n      }\n\n      return {\n        type: charge.kind,\n        clave: charge.category,\n        concept: charge.concept,\n        amount_cents: amountToCents(charge.amount),\n        ...(charge.kind === '002' ? employmentSubsidyMg : {}),\n        ...(charge.kind === '004' ? compensationFavorBalanceMg : {})\n      }\n    })\n  }\n\n  // Iterates over required fields and validates every one of them\n  // Then it returns true if all validations succeedeed, else false.\n  validateRequiredFields () {\n    return [...requiredFields] // Converts the Set() into an array\n      .filter(Boolean) // Filters the array from any falsy value\n      .map(form => form.validate.call(this)) // Calls the validate() method on each form\n      .every(e => e) // Checks if all validations suceeded\n  }\n\n  // Adds one otherPerception to this.state.charges\n  addItem () {\n    this.setState({\n      charges: [\n        ...this.state.charges,\n        {\n          id: uuid(),\n          kind: '',\n          category: '',\n          concept: '',\n          amount: 0,\n          subsidy_caused: 0,\n          favor_balance: 0,\n          year: YEARS[0],\n          remainder: 0\n        }\n      ]\n    })\n  }\n\n  setCharges (chargeId, field, value) {\n    this.setState(\n      prevState => ({\n        charges: prevState.charges.map(\n          charge =>\n            charge.id === chargeId\n              ? Object.assign({}, charge, { [field]: value })\n              : charge\n        )\n      }),\n      () => {\n        if (field === 'amount') this.updateSubtotals()\n      }\n    )\n  }\n\n  // Persist fields to charge\n  onChange (chargeId, field, e) {\n    const value = e.target.value\n    this.setCharges(chargeId, field, value)\n  }\n\n  // Format price as $ 1,234.56\n  formatPrice (chargeId, field) {\n    const charge = this.state.charges.find(charge => charge.id === chargeId)\n    const formatted = accounting.formatMoney(absolutify(charge[field]), '$ ')\n    this.setCharges(chargeId, field, formatted)\n  }\n\n  // Parse formatted price\n  unformatPrice (chargeId, field) {\n    const charge = this.state.charges.find(charge => charge.id === chargeId)\n    const unformatted = absolutify(charge[field])\n    this.setCharges(chargeId, field, unformatted)\n  }\n\n  // Update subtotal\n  updateSubtotals () {\n    // Iterates over every charge and acumulativamente adds it and assigns the result to subtotal\n    const chargesSubtotal = this.state.charges.reduce((acc, charge) => {\n      return acc + absolutify(charge.amount)\n    }, 0)\n    // Update parent totals and subtotals\n    this.props.updatePayrollTotals(this.props.keyId, chargesSubtotal)\n    this.setState({\n      chargesSubtotal: chargesSubtotal.toFixed(2)\n    })\n  }\n\n  // Delete an otherPerception from this.state.charges\n  deleteItem (chargeId) {\n    requiredFields.clear()\n    this.setState(\n      {\n        charges: this.state.charges.filter(charge => charge.id !== chargeId)\n      },\n      this.updateSubtotals\n    )\n  }\n\n  renderSubsidyField (charge) {\n    if (this.state.charges.some(charge => charge.kind === '002')) {\n      return (\n        <td style={{ minWidth: '7rem' }}>\n          {charge.kind === '002' ? (\n            <TextField\n              value={charge.subsidy_caused}\n              onChange={this.onChange.bind(this, charge.id, 'subsidy_caused')}\n              onBlur={this.formatPrice.bind(this, charge.id, 'subsidy_caused')}\n              onFocus={this.unformatPrice.bind(\n                this,\n                charge.id,\n                'subsidy_caused'\n              )}\n              selectAllOnFocus\n              required\n              onValidationError={this.props.onValidationError}\n              name='Subsidio causado de otro pago'\n              ref={r => requiredFields.add(r)}\n              // agregar cosa de isValid con una funcion que regrese la validez del campo\n              // en este caso seria que debe ser mayor al charge.amount\n            />\n          ) : null}\n        </td>\n      )\n    }\n    return null\n  }\n\n  renderCompensationFields (charge) {\n    if (this.state.charges.some(charge => charge.kind === '004')) {\n      if (charge.kind === '004') {\n        return [\n          <td style={{ minWidth: '7rem' }}>\n            <TextField\n              value={charge.favor_balance}\n              onChange={this.onChange.bind(this, charge.id, 'favor_balance')}\n              onBlur={this.formatPrice.bind(this, charge.id, 'favor_balance')}\n              onFocus={this.unformatPrice.bind(\n                this,\n                charge.id,\n                'favor_balance'\n              )}\n              selectAllOnFocus\n              required\n              onValidationError={this.props.onValidationError}\n              name='Saldo a favor de otro pago'\n              ref={r => requiredFields.add(r)}\n            />\n          </td>,\n          <td style={{ minWidth: '7rem' }}>\n            <SelectField\n              value={charge.year}\n              options={YEARS}\n              onChange={this.onChange.bind(this, charge.id, 'year')}\n              required\n              onValidationError={this.props.onValidationError}\n              name='Año de otro pago'\n              ref={r => requiredFields.add(r)}\n            />\n          </td>,\n          <td style={{ minWidth: '7rem' }}>\n            <TextField\n              value={charge.remainder}\n              onChange={this.onChange.bind(this, charge.id, 'remainder')}\n              onBlur={this.formatPrice.bind(this, charge.id, 'remainder')}\n              onFocus={this.unformatPrice.bind(this, charge.id, 'remainder')}\n              selectAllOnFocus\n              required\n              onValidationError={this.props.onValidationError}\n              name='Remanente del saldo a favor de otro pago'\n              ref={r => requiredFields.add(r)}\n            />\n          </td>\n        ]\n      } else {\n        return [<td />, <td />, <td />]\n      }\n    }\n    return null\n  }\n\n  // Items\n  renderItemList () {\n    let chargeList = null\n    if (this.state.charges.length > 0) {\n      chargeList = this.state.charges.map(charge => {\n        return (\n          <tr key={charge.id}>\n            <td className='is-one-quarter'>\n              <SelectField\n                placeholder='Selecciona una opción'\n                options={OTHER_PAYMENT_TYPE}\n                value={charge.kind}\n                onChange={this.onChange.bind(this, charge.id, 'kind')}\n                required\n                onValidationError={this.props.onValidationError}\n                name='Tipo de otro pago'\n                ref={r => requiredFields.add(r)}\n                showId\n              />\n            </td>\n            <td>\n              <TextField\n                value={charge.category}\n                onChange={this.onChange.bind(this, charge.id, 'category')}\n                required\n                onValidationError={this.props.onValidationError}\n                name='Categoría personalizada de otro pago'\n                ref={r => requiredFields.add(r)}\n                selectAllOnFocus\n                minLength={4}\n              />\n            </td>\n            <td>\n              <TextField\n                value={charge.concept}\n                onChange={this.onChange.bind(this, charge.id, 'concept')}\n                required\n                onValidationError={this.props.onValidationError}\n                name='Concepto de otro pago'\n                ref={r => requiredFields.add(r)}\n                selectAllOnFocus\n                minLength={4}\n              />\n            </td>\n            <td style={{ minWidth: '7rem' }}>\n              <TextField\n                value={charge.amount}\n                onChange={this.onChange.bind(this, charge.id, 'amount')}\n                onBlur={this.formatPrice.bind(this, charge.id, 'amount')}\n                onFocus={this.unformatPrice.bind(this, charge.id, 'amount')}\n                selectAllOnFocus\n              />\n            </td>\n            {this.renderSubsidyField(charge)}\n            {this.renderCompensationFields(charge)}\n            <td>\n              <p className='table--actions'>\n                <IconButton\n                  icon='delete'\n                  onClick={this.deleteItem.bind(this, charge.id)}\n                  tooltip='Borrar'\n                />\n              </p>\n            </td>\n          </tr>\n        )\n      })\n    }\n    return chargeList\n  }\n\n  render () {\n    const { charges } = this.state\n    let subtotalColSpan = 2\n    if (charges.some(charge => charge.kind === '002')) subtotalColSpan += 1\n    if (charges.some(charge => charge.kind === '004')) subtotalColSpan += 3\n    return (\n      <div>\n        <h3 className='subheader-green'>Otros Pagos</h3>\n        <Button\n          buttonStyle='primaryLink'\n          icon='plus'\n          className={classNames({ 'is-hidden': charges.length >= 1 })}\n          onClick={this.addItem.bind(this)}\n          style={{ marginBottom: '1.5rem' }}\n        >\n          Agregar Otro Pago\n        </Button>\n        <table\n          className={classNames('table', { 'is-hidden': charges.length < 1 })}\n        >\n          <thead>\n            <tr>\n              <th>Tipo</th>\n              <th>Categoría personalizada (Min 4 dígitos)</th>\n              <th>Concepto</th>\n              <th>Importe</th>\n              <th\n                className={classNames({\n                  'is-hidden': charges.every(charge => charge.kind !== '002')\n                })}\n              >\n                Subsidio Causado\n              </th>\n              <th\n                className={classNames({\n                  'is-hidden': charges.every(charge => charge.kind !== '004')\n                })}\n              >\n                Saldo a favor\n              </th>\n              <th\n                className={classNames({\n                  'is-hidden': charges.every(charge => charge.kind !== '004')\n                })}\n              >\n                Año\n              </th>\n              <th\n                className={classNames({\n                  'is-hidden': charges.every(charge => charge.kind !== '004')\n                })}\n              >\n                Remanente del saldo a favor\n              </th>\n              <th>Acciones</th>\n            </tr>\n          </thead>\n          <tbody>{this.renderItemList()}</tbody>\n          <Button\n            buttonStyle='primaryLink'\n            icon='plus'\n            className={classNames({ 'is-hidden': charges.length < 1 })}\n            onClick={this.addItem.bind(this)}\n          >\n            Agregar Otro Pago\n          </Button>\n          <tfoot>\n            <tr>\n              <td colSpan={subtotalColSpan} />\n              <td>Subtotal:</td>\n              <td>\n                {accounting.formatMoney(this.state.chargesSubtotal, '$ ')}\n              </td>\n              <td colSpan={1} />\n            </tr>\n          </tfoot>\n        </table>\n      </div>\n    )\n  }\n}\n\nOtherPerceptions.propTypes = {\n  onValidationError: PropTypes.func,\n  updatePayrollTotals: PropTypes.func,\n  keyId: PropTypes.string\n}\n\nOtherPerceptions.defaultProps = {\n  onValidationError: () => {}\n}\n\nexport default OtherPerceptions\n"]},"metadata":{},"sourceType":"module"}