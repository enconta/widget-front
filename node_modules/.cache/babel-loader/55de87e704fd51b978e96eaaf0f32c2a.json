{"ast":null,"code":"import _defineProperty from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/usuario-rtd/Desktop/widget-front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/expense/index.js\";\nimport React, { Component, Fragment } from 'react';\nimport API from 'api';\nimport PropTypes from 'prop-types';\nimport { browserHistory, Link } from 'react-router';\nimport accounting from 'accounting';\nimport _debounce from 'lodash/debounce';\nimport classNames from 'classnames';\nimport { AsyncCreatable } from 'react-select';\nimport moment from 'moment';\nimport ReactGa from 'react-ga';\nimport AppSignal from 'appsignal';\nimport AppStorage from 'api/appStorage';\nimport { prettyDate, absolutify, createGaEvent, resetScroll, isDisabledInvoiceLabeling, askRemainingPlanDays, getClientsPlan } from 'utils';\nimport TextField from 'shared/textField';\nimport Datepicker from 'shared/datepicker';\nimport SelectField from 'shared/selectField';\nimport TableFilter from 'shared/tableFilter';\nimport Paginator from 'shared/paginator';\nimport Card from 'shared/card';\nimport StatusIcon from 'shared/statusIcon';\nimport IconButton from 'shared/iconButton';\nimport ExportButton from 'shared/exportButton';\nimport CredentialsExpire from 'shared/credentials';\nimport Modal from 'shared/modal';\nimport { INVOICE_PAYMENT_STATUS, FORMATTED_SAT_CATEGORIES } from 'shared/catalogs';\nimport Banner from 'shared/banner';\nimport { textIncomes, toggleBanner, modalPlans, toggleBannerModal, toggleUpdatePlanModal, modalUpdatePlan } from '../viewInvoice/utilsRestrictions';\nimport InvoicesActions from 'actions/invoices';\nimport NotificationsActions from 'actions/notifications';\nimport RestrictionsActions from 'actions/restrictions';\nimport InvoicesStore from 'stores/invoices';\nimport RestrictionsStore from 'stores/restrictions';\nvar EXPORT_SUCCESS_MESSAGE = 'Se ha iniciado la generacion del archivo, estará listo en la seccion de Descargas en unos momentos.';\nvar EXPORT_ERROR_MESSAGE_1 = 'La selección debe tener al menos un registro, por favor intentelo de nuevo optimizando los filtros de búsqueda.';\nvar windowGlobal = typeof window !== 'undefined' && window;\n\nfunction getCurrentState(type) {\n  return {\n    invoices: InvoicesStore.getInvoices([type]),\n    totalPages: InvoicesStore.getTotalPages([type]),\n    totalItems: InvoicesStore.getTotalItems([type]),\n    remainingDownloads: RestrictionsStore.getRemainingExcelDownloads()\n  };\n}\n\nvar EXPORT_BUTTONS = [{\n  icon: 'file-excel',\n  label: 'Exportar a excel',\n  format: 'invoice_excel'\n}, {\n  icon: 'file-xml',\n  label: 'Exportar a XML',\n  format: 'xml'\n}];\nvar STATUS_FILTERS = [{\n  value: 'pending_payment',\n  label: {\n    default: 'Por cobrar',\n    nomina: 'Por pagar'\n  }\n}, {\n  value: 'partially_paid',\n  label: {\n    default: 'Cobrada parcialmente',\n    nomina: 'Pagada parcialmente'\n  },\n  className: 'is-marginless'\n}, {\n  value: 'paid',\n  label: {\n    default: 'Cobrada',\n    nomina: 'Pagada'\n  },\n  className: 'is-marginless'\n}, {\n  value: 'cancelled',\n  label: {\n    default: 'Cancelada'\n  },\n  className: 'is-marginless'\n}];\n\nvar debouncedFetch = _debounce(function (searchTerm, callback) {\n  API.CustomCategories.List().then(function (r) {\n    return callback(null, {\n      options: r.invoice_categories.map(function (cat) {\n        return {\n          value: cat.name,\n          label: cat.name\n        };\n      })\n    });\n  }).catch(function (r) {\n    return callback(err);\n  }); // eslint-disable-line\n}, 700);\n\nvar Expense =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Expense, _Component);\n\n  function Expense(props) {\n    var _this;\n\n    _classCallCheck(this, Expense);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Expense).call(this, props));\n\n    _this.exportTo = function (format) {\n      var isPayroll = _this.props.route.tab === 'nomina';\n      var params = Object.assign({}, _this.props.location.query, {\n        invoice_type: isPayroll ? 'payroll_expenses' : 'expenses',\n        stamped: true\n      });\n      var totalItems = _this.state.totalItems;\n\n      if (totalItems > 500) {\n        ReactGa.event(createGaEvent('gastos', 'click on disabled button', format));\n      } else if (totalItems < 1) {\n        NotificationsActions.error(EXPORT_ERROR_MESSAGE_1);\n      } else {\n        ReactGa.event(createGaEvent('gastos', 'click on button', format));\n        InvoicesActions.exportInvoices(params, isPayroll ? 'payroll_excel' : format).then(function (r) {\n          return NotificationsActions.success(EXPORT_SUCCESS_MESSAGE);\n        }).catch(function (err) {\n          return NotificationsActions.error(err);\n        });\n      }\n    };\n\n    _this.data = {\n      sort: {\n        sort_by: 'issue_date',\n        sort_direction: 'desc'\n      },\n      filters: {\n        sat_folio: '',\n        startDate: moment().subtract(1, 'M'),\n        endDate: moment(),\n        status: '',\n        legalName: '',\n        rfc: '',\n        amountType: 'subtotal',\n        category: '',\n        amountMin: 0,\n        amountMax: 0\n      },\n      modal: {\n        open: false,\n        invoiceCategory: null,\n        invoiceId: null\n      },\n      datesOpen: false,\n      amountOpen: false,\n      statusOpen: false,\n      dataLoading: true,\n      formQuit: false,\n      showBannerExpenses: true,\n      showBannerModal: false,\n      updatePlanModal: false\n    };\n    _this.state = Object.assign({}, _this.data, getCurrentState(props.route.tab === 'nomina' ? 'payroll_expenses' : 'expenses'));\n    _this._onChange = _this._onChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Expense, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      InvoicesStore.addChangeListener(this._onChange);\n      RestrictionsStore.addChangeListener(this._onChange);\n      this.loadData();\n      askRemainingPlanDays();\n      resetScroll();\n      RestrictionsActions.getRestrictions().catch(function (error) {\n        NotificationsActions.error(error);\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.location.search !== prevProps.location.search) {\n        this.loadData(this.props);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      InvoicesStore.removeChangeListener(this._onChange);\n      RestrictionsStore.removeChangeListener(this._onChange);\n      if (this.state.formQuit) ReactGa.event(createGaEvent('gastos', 'form quit'));\n    }\n  }, {\n    key: \"onChangeTab\",\n    value: function onChangeTab(tab) {\n      var state = getCurrentState(tab === 'nomina' ? 'payroll_expenses' : 'expenses');\n      this.setState(state, this.loadData);\n    }\n  }, {\n    key: \"setFilters\",\n    value: function setFilters(field, value) {\n      this.setState(function (prevState) {\n        return {\n          filters: Object.assign({}, prevState.filters, _defineProperty({}, field, value))\n        };\n      });\n    }\n  }, {\n    key: \"onChangeFilter\",\n    value: function onChangeFilter(field, e) {\n      var value = e.target ? e.target.value : e;\n      this.setFilters(field, value);\n    }\n  }, {\n    key: \"formatAmount\",\n    value: function formatAmount(field) {\n      var value = accounting.formatMoney(absolutify(this.state.filters[field]), '$ ');\n      this.setFilters(field, value);\n    }\n  }, {\n    key: \"unformatAmount\",\n    value: function unformatAmount(field) {\n      var value = absolutify(this.state.filters[field]);\n      this.setFilters(field, value);\n    }\n  }, {\n    key: \"toggleFiltersOpen\",\n    value: function toggleFiltersOpen(field) {\n      this.setState(function (prevState) {\n        return _defineProperty({}, field, !prevState[field]);\n      });\n    }\n  }, {\n    key: \"prepareFilters\",\n    value: function prepareFilters(filters) {\n      var _filters2;\n\n      ReactGa.event(createGaEvent('gastos', 'click on button', 'filtrar tabla'));\n      var _this$state = this.state,\n          datesOpen = _this$state.datesOpen,\n          amountOpen = _this$state.amountOpen,\n          statusOpen = _this$state.statusOpen;\n      var legalName = filters.legalName,\n          amountType = filters.amountType,\n          rfc = filters.rfc,\n          startDate = filters.startDate,\n          endDate = filters.endDate,\n          amountMin = filters.amountMin,\n          amountMax = filters.amountMax,\n          status = filters.status;\n      var absAmountMin = absolutify(amountMin);\n      var absAmountMax = absolutify(amountMax);\n      var prefix = this.props.route.tab === 'nomina' ? 'recipient' : 'issuer';\n      var RFC_KEY = \"\".concat(prefix, \"_rfc\");\n      var LEGAL_NAME_KEY = \"\".concat(prefix, \"_legal_name\");\n      var AMOUNT_MIN_KEY = \"\".concat(amountType, \"_range[min]\");\n      var AMOUNT_MAX_KEY = \"\".concat(amountType, \"_range[max]\");\n\n      var _filters = (_filters2 = {}, _defineProperty(_filters2, RFC_KEY, rfc), _defineProperty(_filters2, LEGAL_NAME_KEY, legalName), _filters2);\n\n      if (datesOpen) {\n        if (startDate.isAfter(endDate, 'day')) {\n          ReactGa.event(createGaEvent('gastos', 'form error', 'fecha de inicio mayor a fecha de fin'));\n          NotificationsActions.error('La fecha de inicio no puede ser mayor a la fecha de fin.');\n          return {};\n        }\n\n        Object.assign(_filters, {\n          'date_range[start]': moment(startDate).format('YYYY-MM-DD'),\n          'date_range[end]': moment(endDate).format('YYYY-MM-DD')\n        });\n      }\n\n      if (amountOpen) {\n        var _Object$assign2;\n\n        if (absAmountMin > absAmountMax) {\n          ReactGa.event(createGaEvent('gastos', 'form error', 'importe minimo mayor que maximo'));\n          NotificationsActions.error('La cantidad mínima debe ser menor que la máxima.');\n          return {};\n        }\n\n        Object.assign(_filters, (_Object$assign2 = {}, _defineProperty(_Object$assign2, AMOUNT_MIN_KEY, absAmountMin.toString()), _defineProperty(_Object$assign2, AMOUNT_MAX_KEY, absAmountMax.toString()), _Object$assign2));\n      }\n\n      if (statusOpen) {\n        Object.assign(_filters, {\n          status: status\n        });\n      }\n\n      this.setState({\n        dataLoading: true,\n        filtersSuccess: false\n      });\n      return _filters;\n    }\n  }, {\n    key: \"clearFilters\",\n    value: function clearFilters() {\n      ReactGa.event(createGaEvent('gastos', 'click on button', 'limpiar filtros'));\n      this.setState({\n        filters: this.data.filters,\n        dataLoading: true\n      });\n    }\n  }, {\n    key: \"onSearchInvoice\",\n    value: function onSearchInvoice() {\n      browserHistory.push(\"/gastos/\".concat(this.props.route.tab, \"?sat_folio=\").concat(this.state.filters.sat_folio));\n    }\n  }, {\n    key: \"loadData\",\n    value: function loadData() {\n      var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.props;\n      var params = Object.assign({}, props.location.query, this.state.sort, {\n        invoice_type: props.route.tab === 'nomina' ? 'payroll_expenses' : 'expenses',\n        stamped: true\n      });\n      InvoicesActions.getInvoices(params);\n      this.setState(function (prevState) {\n        return {\n          filters: Object.assign({}, prevState.filters, params)\n        };\n      });\n    }\n  }, {\n    key: \"sortBy\",\n    value: function sortBy(column) {\n      var sort = this.state.sort;\n\n      if (sort.sort_by === column) {\n        switch (sort.sort_direction) {\n          case 'asc':\n            sort.sort_direction = 'desc';\n            break;\n\n          case 'desc':\n            sort.sort_direction = 'asc';\n            break;\n        }\n      } else {\n        sort = {\n          sort_by: column,\n          sort_direction: 'asc'\n        };\n      }\n\n      this.setState({\n        sort: sort\n      }, this.loadData);\n    }\n  }, {\n    key: \"getIcon\",\n    value: function getIcon(column) {\n      var sort = this.state.sort;\n      return React.createElement(\"i\", {\n        style: {\n          fontSize: '1rem'\n        },\n        className: classNames('mdi', {\n          'mdi-chevron-down': sort.sort_direction === 'desc',\n          'mdi-chevron-up': sort.sort_direction === 'asc',\n          'mdi-unfold-more-horizontal': sort.sort_by !== column\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 358\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"setCategory\",\n    value: function setCategory(id, category) {\n      var _this2 = this;\n\n      var invoice = this.state.invoices.find(function (invoice) {\n        return invoice.id === id;\n      });\n      var successMessage = 'Rubro asignado';\n\n      if (category === null) {\n        category = {\n          value: null,\n          label: null\n        };\n        successMessage = 'Rubro retirado de la factura';\n\n        if (invoice.sat_category === null) {\n          this.toggleCategoryModal();\n          return;\n        }\n      }\n\n      API.Invoice.SetCategory(id, {\n        category: {\n          sat_category: category.label\n        }\n      }).then(function () {\n        NotificationsActions.success(successMessage);\n\n        _this2.toggleCategoryModal();\n\n        _this2.loadData();\n      }).catch(function (error) {\n        AppSignal.sendError(error);\n        NotificationsActions.error('Error al asignar rubro');\n      });\n    }\n  }, {\n    key: \"_onChange\",\n    value: function _onChange() {\n      var state = getCurrentState(this.props.route.tab === 'nomina' ? 'payroll_expenses' : 'expenses');\n\n      if (this.state.dataLoading) {\n        this.setState({\n          dataLoading: false,\n          formQuit: false\n        });\n        ReactGa.event(createGaEvent('gastos', 'result', this.props.location.search, state.totalItems));\n      }\n\n      this.setState(state);\n    }\n  }, {\n    key: \"createCategory\",\n    value: function createCategory(id, category) {\n      var _this3 = this;\n\n      API.CustomCategories.Create({\n        invoice_category: {\n          name: category.value\n        }\n      }).then(function (r) {\n        NotificationsActions.success(\"Rubro creado: \".concat(r.invoice_category.name));\n\n        _this3.setCategory(id, category);\n      }).catch(function (r) {\n        NotificationsActions.error('Falla al crear rubro');\n        console.error(r);\n      });\n    }\n  }, {\n    key: \"toggleCategoryModal\",\n    value: function toggleCategoryModal(id, category) {\n      this.setState(function (prevState) {\n        return {\n          modal: Object.assign({}, prevState.modal, {\n            open: !prevState.modal.open,\n            invoiceId: prevState.modal.open ? null : id,\n            invoiceCategory: {\n              value: prevState.modal.open ? null : category,\n              label: prevState.modal.open ? null : category\n            }\n          })\n        };\n      });\n    }\n  }, {\n    key: \"renderTable\",\n    value: function renderTable() {\n      var _this4 = this;\n\n      var entityId = AppStorage.getCurrentEntity().id;\n      var _this$state2 = this.state,\n          invoices = _this$state2.invoices,\n          totalPages = _this$state2.totalPages,\n          sort = _this$state2.sort;\n      var renderTable = React.createElement(\"div\", {\n        className: \"block unselectable\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 443\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 444\n        },\n        __self: this\n      }, \"No hay facturas\"));\n\n      if (invoices.length > 0) {\n        var invoicesList = invoices.map(function (invoice) {\n          return React.createElement(\"tr\", {\n            key: invoice.id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 449\n            },\n            __self: this\n          }, React.createElement(\"td\", {\n            className: \"align-left\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 450\n            },\n            __self: this\n          }, React.createElement(Link, {\n            to: \"/facturas/ver/\".concat(invoice.id),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 451\n            },\n            __self: this\n          }, invoice.legal_name)), React.createElement(\"td\", {\n            className: \"align-right table--actions\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 453\n            },\n            __self: this\n          }, invoice.payment_status !== 'cancelled' ? invoice.sat_category : null, \"\\xA0\\xA0\\xA0\", React.createElement(IconButton, {\n            icon: \"pencil\",\n            tooltip: \"Modificar rubro\",\n            onClick: _this4.toggleCategoryModal.bind(_this4, invoice.id, invoice.sat_category),\n            disabled: isDisabledInvoiceLabeling(invoice.payment_status),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 458\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            className: \"nowrap\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 469\n            },\n            __self: this\n          }, invoice.issue_date ? prettyDate(invoice.issue_date, false, true, false, '/') : ''), React.createElement(\"td\", {\n            className: \"is-money\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 474\n            },\n            __self: this\n          }, accounting.formatMoney(invoice.subtotal, '', 2)), React.createElement(\"td\", {\n            className: \"is-money\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 477\n            },\n            __self: this\n          }, accounting.formatMoney(invoice.total, '', 2)), React.createElement(\"td\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 480\n            },\n            __self: this\n          }, React.createElement(StatusIcon, {\n            className: INVOICE_PAYMENT_STATUS[invoice.payment_status],\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 481\n            },\n            __self: this\n          })), React.createElement(\"td\", {\n            className: \"table--actions flex-center\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 485\n            },\n            __self: this\n          }, React.createElement(\"a\", {\n            onClick: function onClick() {\n              ReactGa.event(createGaEvent('gastos', 'click on button', 'Descargar PDF'));\n            },\n            href: \"\".concat(process.env.API_SERVER).concat(process.env.API_PREFIX, \"/pdfs/\").concat(invoice.id, \"/\").concat(entityId),\n            download: true,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 486\n            },\n            __self: this\n          }, React.createElement(IconButton, {\n            icon: \"file-pdf\",\n            tooltip: \"Descargar PDF\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 495\n            },\n            __self: this\n          })), invoice.version === '3.3' && invoice.payroll && React.createElement(Link, {\n            to: \"/facturas_de_nomina/nueva?invoice=\".concat(invoice.id),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 498\n            },\n            __self: this\n          }, React.createElement(IconButton, {\n            icon: \"autorenew\",\n            tooltip: \"Reemitir factura\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 499\n            },\n            __self: this\n          }))));\n        });\n        renderTable = React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 506\n          },\n          __self: this\n        }, React.createElement(\"table\", {\n          className: \"table is-sortable\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 507\n          },\n          __self: this\n        }, React.createElement(\"thead\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 508\n          },\n          __self: this\n        }, React.createElement(\"tr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 509\n          },\n          __self: this\n        }, React.createElement(\"th\", {\n          className: classNames('align-left', {\n            'is-sorting': sort.sort_by === 'legal_name'\n          }),\n          onClick: this.sortBy.bind(this, 'legal_name'),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 510\n          },\n          __self: this\n        }, \"Raz\\xF3n social \", this.getIcon('legal_name')), React.createElement(\"th\", {\n          style: {\n            width: '8rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 518\n          },\n          __self: this\n        }, \"Rubro\"), React.createElement(\"th\", {\n          className: classNames({\n            'is-sorting': sort.sort_by === 'issue_date'\n          }),\n          onClick: this.sortBy.bind(this, 'issue_date'),\n          style: {\n            width: '8rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 519\n          },\n          __self: this\n        }, \"Fecha \", this.getIcon('issue_date')), React.createElement(\"th\", {\n          className: classNames('is-money', {\n            'is-sorting': sort.sort_by === 'subtotal_cents'\n          }),\n          onClick: this.sortBy.bind(this, 'subtotal_cents'),\n          style: {\n            width: '10rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 528\n          },\n          __self: this\n        }, \"Subtotal \", this.getIcon('subtotal_cents')), React.createElement(\"th\", {\n          className: classNames('is-money', {\n            'is-sorting': sort.sort_by === 'total_cents'\n          }),\n          onClick: this.sortBy.bind(this, 'total_cents'),\n          style: {\n            width: '10rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 537\n          },\n          __self: this\n        }, \"Total \", this.getIcon('total_cents')), React.createElement(\"th\", {\n          style: {\n            width: '5rem'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 546\n          },\n          __self: this\n        }, \"Estado\"))), React.createElement(\"tbody\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 549\n          },\n          __self: this\n        }, invoicesList)), React.createElement(Paginator, {\n          onPageChanged: function onPageChanged(page) {\n            return ReactGa.event(createGaEvent('gastos', 'page changed', '', page));\n          },\n          totalPages: totalPages,\n          location: this.props.location,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 551\n          },\n          __self: this\n        }));\n      }\n\n      return renderTable;\n    } // Render category selector modal\n\n  }, {\n    key: \"renderCategorySelector\",\n    value: function renderCategorySelector() {\n      var _this$state$modal = this.state.modal,\n          open = _this$state$modal.open,\n          invoiceId = _this$state$modal.invoiceId;\n      var select = open ? React.createElement(AsyncCreatable, {\n        value: this.state.modal.invoiceCategory,\n        loadOptions: debouncedFetch,\n        clearable: true,\n        placeholder: \"Selecciona un rubro\",\n        loadingPlaceholder: \"Buscando\",\n        searchPromptText: \"Buscar un rubro\",\n        noResultsText: \"No encontrado\",\n        promptTextCreator: function promptTextCreator(label) {\n          return \"Crear rubro: \".concat(label);\n        },\n        onChange: this.setCategory.bind(this, invoiceId),\n        onNewOptionClick: this.createCategory.bind(this, invoiceId),\n        ignoreAccents: false,\n        openOnFocus: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 568\n        },\n        __self: this\n      }) : null;\n      return React.createElement(Modal, {\n        title: \"Rubro\",\n        isActive: open,\n        toggleModal: this.toggleCategoryModal.bind(this),\n        noFooter: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 584\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"espacio-xxlarge\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 590\n        },\n        __self: this\n      }, select, React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 592\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 593\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 594\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 595\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 596\n        },\n        __self: this\n      })));\n    }\n  }, {\n    key: \"renderLegalName\",\n    value: function renderLegalName() {\n      return React.createElement(TextField, {\n        placeholder: \"Raz\\xF3n Social\",\n        value: this.state.filters.legalName,\n        onChange: this.onChangeFilter.bind(this, 'legalName'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 604\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"renderRfc\",\n    value: function renderRfc() {\n      return React.createElement(TextField, {\n        placeholder: \"RFC\",\n        value: this.state.filters.rfc,\n        onChange: this.onChangeFilter.bind(this, 'rfc'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 614\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"renderCategory\",\n    value: function renderCategory() {\n      return React.createElement(SelectField, {\n        placeholder: \"Rubro\",\n        options: FORMATTED_SAT_CATEGORIES,\n        value: this.state.category,\n        onChange: this.onChangeFilter.bind(this, 'category'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 624\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"renderDates\",\n    value: function renderDates() {\n      var _this$state3 = this.state,\n          datesOpen = _this$state3.datesOpen,\n          filters = _this$state3.filters;\n      return React.createElement(\"div\", {\n        className: \"flex-column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 636\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: this.toggleFiltersOpen.bind(this, 'datesOpen'),\n        style: {\n          cursor: 'pointer'\n        },\n        className: \"subtitle-body flex-between\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 637\n        },\n        __self: this\n      }, \"Periodo\", React.createElement(\"i\", {\n        className: classNames('mdi', {\n          'mdi-plus': !datesOpen,\n          'mdi-minus': datesOpen\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 643\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: classNames({\n          'is-hidden': !datesOpen\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 650\n        },\n        __self: this\n      }, React.createElement(Datepicker, {\n        label: \"Del\",\n        placeholder: \"Fecha inicio\",\n        value: filters.startDate,\n        onChange: this.onChangeFilter.bind(this, 'startDate'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 651\n        },\n        __self: this\n      }), React.createElement(Datepicker, {\n        label: \"Al\",\n        placeholder: \"Fecha fin\",\n        value: filters.endDate,\n        onChange: this.onChangeFilter.bind(this, 'endDate'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 657\n        },\n        __self: this\n      })));\n    }\n  }, {\n    key: \"renderAmount\",\n    value: function renderAmount() {\n      var _this$state4 = this.state,\n          amountOpen = _this$state4.amountOpen,\n          filters = _this$state4.filters;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 671\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: this.toggleFiltersOpen.bind(this, 'amountOpen'),\n        style: {\n          cursor: 'pointer'\n        },\n        className: \"subtitle-body flex-between\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 672\n        },\n        __self: this\n      }, \"Importe\", React.createElement(\"i\", {\n        className: classNames('mdi', {\n          'mdi-plus': !amountOpen,\n          'mdi-minus': amountOpen\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 678\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: classNames('control flex-column', {\n          'is-hidden': !amountOpen\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 685\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        className: \"radio\",\n        htmlFor: \"subtotal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 690\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        id: \"subtotal\",\n        type: \"radio\",\n        value: \"subtotal\",\n        onChange: this.onChangeFilter.bind(this, 'amountType'),\n        checked: filters.amountType === 'subtotal',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 691\n        },\n        __self: this\n      }), \"\\xA0Subtotal\"), React.createElement(\"label\", {\n        className: \"radio is-marginless\",\n        htmlFor: \"total\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 700\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        id: \"total\",\n        type: \"radio\",\n        value: \"total\",\n        onChange: this.onChangeFilter.bind(this, 'amountType'),\n        checked: filters.amountType === 'total',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 701\n        },\n        __self: this\n      }), \"\\xA0Total\"), React.createElement(TextField, {\n        label: \"Desde\",\n        placeholder: \"0.00\",\n        value: filters.amountMin,\n        onChange: this.onChangeFilter.bind(this, 'amountMin'),\n        onBlur: this.formatAmount.bind(this, 'amountMin'),\n        onFocus: this.unformatAmount.bind(this, 'amountMin'),\n        selectAllOnFocus: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 710\n        },\n        __self: this\n      }), React.createElement(TextField, {\n        label: \"Hasta\",\n        placeholder: \"0.00\",\n        value: filters.amountMax,\n        onChange: this.onChangeFilter.bind(this, 'amountMax'),\n        onBlur: this.formatAmount.bind(this, 'amountMax'),\n        onFocus: this.unformatAmount.bind(this, 'amountMax'),\n        selectAllOnFocus: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 719\n        },\n        __self: this\n      })));\n    }\n  }, {\n    key: \"renderStatusFilter\",\n    value: function renderStatusFilter(_ref2) {\n      var value = _ref2.value,\n          label = _ref2.label,\n          _ref2$className = _ref2.className,\n          className = _ref2$className === void 0 ? '' : _ref2$className;\n      var filters = this.state.filters;\n      var tab = this.props.route.tab;\n      return React.createElement(\"label\", {\n        key: \"status-\".concat(value),\n        className: \"radio \".concat(className),\n        htmlFor: \"filterButton\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 737\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        id: \"filterButton\",\n        type: \"radio\",\n        onChange: this.onChangeFilter.bind(this, 'status'),\n        checked: filters.status === value,\n        value: value,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 742\n        },\n        __self: this\n      }), \"\\xA0\", label[tab] ? label[tab] : label.default);\n    }\n  }, {\n    key: \"renderStatus\",\n    value: function renderStatus() {\n      var statusOpen = this.state.statusOpen;\n      return React.createElement(\"div\", {\n        className: \"flex-column\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 758\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: this.toggleFiltersOpen.bind(this, 'statusOpen'),\n        style: {\n          cursor: 'pointer'\n        },\n        className: \"subtitle-body flex-between\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 759\n        },\n        __self: this\n      }, \"Estado\", React.createElement(\"i\", {\n        className: classNames('mdi', {\n          'mdi-plus': !statusOpen,\n          'mdi-minus': statusOpen\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 765\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: classNames('control flex-column', {\n          'is-hidden': !statusOpen\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 772\n        },\n        __self: this\n      }, STATUS_FILTERS.map(this.renderStatusFilter.bind(this))));\n    }\n  }, {\n    key: \"renderExportButton\",\n    value: function renderExportButton(_ref3) {\n      var _this5 = this;\n\n      var icon = _ref3.icon,\n          label = _ref3.label,\n          format = _ref3.format;\n      var _this$state5 = this.state,\n          totalItems = _this$state5.totalItems,\n          remainingDownloads = _this$state5.remainingDownloads,\n          updatePlanModal = _this$state5.updatePlanModal;\n      var disabledExfolioportButton = totalItems > 500;\n      var noMoreDowloads = remainingDownloads === 0 && format === 'invoice_excel';\n      return React.createElement(ExportButton, {\n        totalItems: totalItems,\n        label: label,\n        key: label,\n        disabled: disabledExfolioportButton,\n        icon: icon,\n        onClick: noMoreDowloads ? function () {\n          return toggleUpdatePlanModal(_this5, updatePlanModal, 'descargas de PDF');\n        } : function () {\n          return _this5.exportTo(format);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 790\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var _this$state6 = this.state,\n          totalItems = _this$state6.totalItems,\n          remainingDownloads = _this$state6.remainingDownloads,\n          filters = _this$state6.filters,\n          showBannerExpenses = _this$state6.showBannerExpenses,\n          showBannerModal = _this$state6.showBannerModal;\n      var showBannerExpense = windowGlobal.localStorage.showBannerExpense;\n      var plan = getClientsPlan();\n      var showEmailCounter = plan === 'free' && showBannerExpense !== 'seen' && showBannerExpenses;\n      return React.createElement(Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 819\n        },\n        __self: this\n      }, React.createElement(CredentialsExpire, {\n        fiel: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 820\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"flex-between\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 821\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        className: \"headline\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 822\n        },\n        __self: this\n      }, \"Gastos\"), React.createElement(\"div\", {\n        className: \"flex-column\",\n        style: {\n          display: 'inline-block'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 823\n        },\n        __self: this\n      }, EXPORT_BUTTONS.map(this.renderExportButton.bind(this)), React.createElement(\"p\", {\n        className: classNames('caption', {\n          'is-hidden': totalItems < 500\n        }),\n        style: {\n          padding: '0.5rem 1rem'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 825\n        },\n        __self: this\n      }, \"(Se debe aplicar un filtro para poder exportar las facturas)\"))), React.createElement(Card, {\n        title: [{\n          id: 'regulares',\n          label: 'Regulares'\n        }, {\n          id: 'nomina',\n          label: 'Nomina'\n        }],\n        searchbar: {\n          value: filters.sat_folio,\n          placeholder: 'Buscar por Folio Fiscal',\n          onEnter: this.onSearchInvoice.bind(this),\n          onChange: this.onChangeFilter.bind(this, 'sat_folio')\n        },\n        activeTab: this.props.route.tab,\n        baseUrl: \"/gastos\",\n        onTabSwitch: this.onChangeTab.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 835\n        },\n        __self: this\n      }, React.createElement(TableFilter, {\n        onOpenFilters: function onOpenFilters() {\n          ReactGa.event(createGaEvent('gastos', 'click on button', 'filtrar tabla toggle'));\n\n          _this6.setState({\n            formQuit: true\n          });\n        },\n        baseUrl: \"/gastos/\".concat(this.props.route.tab),\n        filters: filters,\n        prepareFilters: this.prepareFilters.bind(this),\n        onClearFilters: this.clearFilters.bind(this),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 850\n        },\n        __self: this\n      }, this.renderLegalName(), this.renderRfc(), this.renderDates(), this.renderAmount(), this.renderStatus()), showEmailCounter && React.createElement(Banner, {\n        color: 'blue',\n        buttonText: 'Mejora tu plan',\n        text: textIncomes(remainingDownloads),\n        controlBanner: function controlBanner() {\n          return toggleBanner(_this6, showBannerExpenses, 'showBannerExpense');\n        },\n        bannerAction: function bannerAction() {\n          return toggleBannerModal(_this6, showBannerModal);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 873\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"flex-between\",\n        style: {\n          paddingBottom: '1rem'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 883\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"caption\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 884\n        },\n        __self: this\n      }, accounting.formatNumber(totalItems), \" facturas visibles\"), React.createElement(\"div\", {\n        className: \"caption\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 887\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        style: {\n          marginLeft: '1.6rem'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 888\n        },\n        __self: this\n      }, React.createElement(StatusIcon, {\n        className: \"warning\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 889\n        },\n        __self: this\n      }), \"Por pagar\"), React.createElement(\"span\", {\n        style: {\n          marginLeft: '1.6rem'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 892\n        },\n        __self: this\n      }, React.createElement(StatusIcon, {\n        className: \"info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 893\n        },\n        __self: this\n      }), \"Pagada parcialmente\"), React.createElement(\"span\", {\n        style: {\n          marginLeft: '1.6rem'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 896\n        },\n        __self: this\n      }, React.createElement(StatusIcon, {\n        className: \"success\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 897\n        },\n        __self: this\n      }), \"Pagada\"), React.createElement(\"span\", {\n        style: {\n          marginLeft: '1.6rem'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 900\n        },\n        __self: this\n      }, React.createElement(StatusIcon, {\n        className: \"danger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 901\n        },\n        __self: this\n      }), \"Cancelada\"))), this.renderTable()), this.renderCategorySelector(), modalPlans(this), modalUpdatePlan(this));\n    }\n  }]);\n\n  return Expense;\n}(Component);\n\nExpense.propTypes = {\n  route: PropTypes.shape({\n    tab: PropTypes.number\n  }),\n  location: PropTypes.shape({\n    search: PropTypes.object,\n    query: PropTypes.object\n  })\n};\nexport default Expense;","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/expense/index.js"],"names":["React","Component","Fragment","API","PropTypes","browserHistory","Link","accounting","_debounce","classNames","AsyncCreatable","moment","ReactGa","AppSignal","AppStorage","prettyDate","absolutify","createGaEvent","resetScroll","isDisabledInvoiceLabeling","askRemainingPlanDays","getClientsPlan","TextField","Datepicker","SelectField","TableFilter","Paginator","Card","StatusIcon","IconButton","ExportButton","CredentialsExpire","Modal","INVOICE_PAYMENT_STATUS","FORMATTED_SAT_CATEGORIES","Banner","textIncomes","toggleBanner","modalPlans","toggleBannerModal","toggleUpdatePlanModal","modalUpdatePlan","InvoicesActions","NotificationsActions","RestrictionsActions","InvoicesStore","RestrictionsStore","EXPORT_SUCCESS_MESSAGE","EXPORT_ERROR_MESSAGE_1","windowGlobal","window","getCurrentState","type","invoices","getInvoices","totalPages","getTotalPages","totalItems","getTotalItems","remainingDownloads","getRemainingExcelDownloads","EXPORT_BUTTONS","icon","label","format","STATUS_FILTERS","value","default","nomina","className","debouncedFetch","searchTerm","callback","CustomCategories","List","then","r","options","invoice_categories","map","cat","name","catch","err","Expense","props","exportTo","isPayroll","route","tab","params","Object","assign","location","query","invoice_type","stamped","state","event","error","exportInvoices","success","data","sort","sort_by","sort_direction","filters","sat_folio","startDate","subtract","endDate","status","legalName","rfc","amountType","category","amountMin","amountMax","modal","open","invoiceCategory","invoiceId","datesOpen","amountOpen","statusOpen","dataLoading","formQuit","showBannerExpenses","showBannerModal","updatePlanModal","_onChange","bind","addChangeListener","loadData","getRestrictions","prevProps","search","removeChangeListener","setState","field","prevState","e","target","setFilters","formatMoney","absAmountMin","absAmountMax","prefix","RFC_KEY","LEGAL_NAME_KEY","AMOUNT_MIN_KEY","AMOUNT_MAX_KEY","_filters","isAfter","toString","filtersSuccess","push","column","fontSize","id","invoice","find","successMessage","sat_category","toggleCategoryModal","Invoice","SetCategory","sendError","Create","invoice_category","setCategory","console","entityId","getCurrentEntity","renderTable","length","invoicesList","legal_name","payment_status","issue_date","subtotal","total","process","env","API_SERVER","API_PREFIX","version","payroll","sortBy","getIcon","width","page","select","createCategory","onChangeFilter","toggleFiltersOpen","cursor","formatAmount","unformatAmount","renderStatusFilter","disabledExfolioportButton","noMoreDowloads","showBannerExpense","localStorage","plan","showEmailCounter","display","renderExportButton","padding","placeholder","onEnter","onSearchInvoice","onChange","onChangeTab","prepareFilters","clearFilters","renderLegalName","renderRfc","renderDates","renderAmount","renderStatus","paddingBottom","formatNumber","marginLeft","renderCategorySelector","propTypes","shape","number","object"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react'\nimport API from 'api'\nimport PropTypes from 'prop-types'\nimport { browserHistory, Link } from 'react-router'\nimport accounting from 'accounting'\nimport _debounce from 'lodash/debounce'\nimport classNames from 'classnames'\nimport { AsyncCreatable } from 'react-select'\nimport moment from 'moment'\nimport ReactGa from 'react-ga'\nimport AppSignal from 'appsignal'\nimport AppStorage from 'api/appStorage'\nimport {\n  prettyDate,\n  absolutify,\n  createGaEvent,\n  resetScroll,\n  isDisabledInvoiceLabeling,\n  askRemainingPlanDays,\n  getClientsPlan\n} from 'utils'\n\nimport TextField from 'shared/textField'\nimport Datepicker from 'shared/datepicker'\nimport SelectField from 'shared/selectField'\nimport TableFilter from 'shared/tableFilter'\nimport Paginator from 'shared/paginator'\nimport Card from 'shared/card'\nimport StatusIcon from 'shared/statusIcon'\nimport IconButton from 'shared/iconButton'\nimport ExportButton from 'shared/exportButton'\nimport CredentialsExpire from 'shared/credentials'\nimport Modal from 'shared/modal'\nimport { INVOICE_PAYMENT_STATUS, FORMATTED_SAT_CATEGORIES } from 'shared/catalogs'\nimport Banner from 'shared/banner'\nimport {\n  textIncomes,\n  toggleBanner,\n  modalPlans,\n  toggleBannerModal,\n  toggleUpdatePlanModal,\n  modalUpdatePlan\n} from '../viewInvoice/utilsRestrictions'\n\nimport InvoicesActions from 'actions/invoices'\nimport NotificationsActions from 'actions/notifications'\nimport RestrictionsActions from 'actions/restrictions'\n\nimport InvoicesStore from 'stores/invoices'\nimport RestrictionsStore from 'stores/restrictions'\n\nconst EXPORT_SUCCESS_MESSAGE =\n  'Se ha iniciado la generacion del archivo, estará listo en la seccion de Descargas en unos momentos.'\nconst EXPORT_ERROR_MESSAGE_1 =\n  'La selección debe tener al menos un registro, por favor intentelo de nuevo optimizando los filtros de búsqueda.'\nconst windowGlobal = typeof window !== 'undefined' && window\n\nfunction getCurrentState (type) {\n  return {\n    invoices: InvoicesStore.getInvoices([type]),\n    totalPages: InvoicesStore.getTotalPages([type]),\n    totalItems: InvoicesStore.getTotalItems([type]),\n    remainingDownloads: RestrictionsStore.getRemainingExcelDownloads()\n  }\n}\n\nconst EXPORT_BUTTONS = [\n  {\n    icon: 'file-excel',\n    label: 'Exportar a excel',\n    format: 'invoice_excel'\n  },\n  {\n    icon: 'file-xml',\n    label: 'Exportar a XML',\n    format: 'xml'\n  }\n]\n\nconst STATUS_FILTERS = [\n  {\n    value: 'pending_payment',\n    label: { default: 'Por cobrar', nomina: 'Por pagar' }\n  },\n  {\n    value: 'partially_paid',\n    label: { default: 'Cobrada parcialmente', nomina: 'Pagada parcialmente' },\n    className: 'is-marginless'\n  },\n  {\n    value: 'paid',\n    label: { default: 'Cobrada', nomina: 'Pagada' },\n    className: 'is-marginless'\n  },\n  {\n    value: 'cancelled',\n    label: { default: 'Cancelada' },\n    className: 'is-marginless'\n  }\n]\n\nconst debouncedFetch = _debounce((searchTerm, callback) => {\n  API.CustomCategories.List()\n    .then(r =>\n      callback(null, {\n        options: r.invoice_categories.map(cat => ({\n          value: cat.name,\n          label: cat.name\n        }))\n      })\n    )\n    .catch(r => callback(err)) // eslint-disable-line\n}, 700)\n\nclass Expense extends Component {\n  constructor (props) {\n    super(props)\n    this.data = {\n      sort: {\n        sort_by: 'issue_date',\n        sort_direction: 'desc'\n      },\n      filters: {\n        sat_folio: '',\n        startDate: moment().subtract(1, 'M'),\n        endDate: moment(),\n        status: '',\n        legalName: '',\n        rfc: '',\n        amountType: 'subtotal',\n        category: '',\n        amountMin: 0,\n        amountMax: 0\n      },\n      modal: {\n        open: false,\n        invoiceCategory: null,\n        invoiceId: null\n      },\n      datesOpen: false,\n      amountOpen: false,\n      statusOpen: false,\n      dataLoading: true,\n      formQuit: false,\n      showBannerExpenses: true,\n      showBannerModal: false,\n      updatePlanModal: false\n    }\n    this.state = Object.assign(\n      {},\n      this.data,\n      getCurrentState(\n        props.route.tab === 'nomina' ? 'payroll_expenses' : 'expenses'\n      )\n    )\n    this._onChange = this._onChange.bind(this)\n  }\n\n  componentDidMount () {\n    InvoicesStore.addChangeListener(this._onChange)\n    RestrictionsStore.addChangeListener(this._onChange)\n    this.loadData()\n    askRemainingPlanDays()\n    resetScroll()\n    RestrictionsActions.getRestrictions().catch(error => {\n      NotificationsActions.error(error)\n    })\n  }\n\n  componentDidUpdate (prevProps) {\n    if (this.props.location.search !== prevProps.location.search) {\n      this.loadData(this.props)\n    }\n  }\n\n  componentWillUnmount () {\n    InvoicesStore.removeChangeListener(this._onChange)\n    RestrictionsStore.removeChangeListener(this._onChange)\n    if (this.state.formQuit) ReactGa.event(createGaEvent('gastos', 'form quit'))\n  }\n\n  onChangeTab (tab) {\n    const state = getCurrentState(\n      tab === 'nomina' ? 'payroll_expenses' : 'expenses'\n    )\n    this.setState(state, this.loadData)\n  }\n\n  setFilters (field, value) {\n    this.setState(prevState => ({\n      filters: Object.assign({}, prevState.filters, {\n        [field]: value\n      })\n    }))\n  }\n\n  onChangeFilter (field, e) {\n    const value = e.target ? e.target.value : e\n    this.setFilters(field, value)\n  }\n\n  formatAmount (field) {\n    const value = accounting.formatMoney(\n      absolutify(this.state.filters[field]),\n      '$ '\n    )\n    this.setFilters(field, value)\n  }\n\n  unformatAmount (field) {\n    const value = absolutify(this.state.filters[field])\n    this.setFilters(field, value)\n  }\n\n  toggleFiltersOpen (field) {\n    this.setState(prevState => ({ [field]: !prevState[field] }))\n  }\n\n  prepareFilters (filters) {\n    ReactGa.event(createGaEvent('gastos', 'click on button', 'filtrar tabla'))\n    const { datesOpen, amountOpen, statusOpen } = this.state\n    const {\n      legalName,\n      amountType,\n      rfc,\n      startDate,\n      endDate,\n      amountMin,\n      amountMax,\n      status\n    } = filters\n    const absAmountMin = absolutify(amountMin)\n    const absAmountMax = absolutify(amountMax)\n    const prefix = this.props.route.tab === 'nomina' ? 'recipient' : 'issuer'\n    const RFC_KEY = `${prefix}_rfc`\n    const LEGAL_NAME_KEY = `${prefix}_legal_name`\n    const AMOUNT_MIN_KEY = `${amountType}_range[min]`\n    const AMOUNT_MAX_KEY = `${amountType}_range[max]`\n    const _filters = {\n      [RFC_KEY]: rfc,\n      [LEGAL_NAME_KEY]: legalName\n    }\n    if (datesOpen) {\n      if (startDate.isAfter(endDate, 'day')) {\n        ReactGa.event(\n          createGaEvent(\n            'gastos',\n            'form error',\n            'fecha de inicio mayor a fecha de fin'\n          )\n        )\n        NotificationsActions.error(\n          'La fecha de inicio no puede ser mayor a la fecha de fin.'\n        )\n        return {}\n      }\n      Object.assign(_filters, {\n        'date_range[start]': moment(startDate).format('YYYY-MM-DD'),\n        'date_range[end]': moment(endDate).format('YYYY-MM-DD')\n      })\n    }\n    if (amountOpen) {\n      if (absAmountMin > absAmountMax) {\n        ReactGa.event(\n          createGaEvent(\n            'gastos',\n            'form error',\n            'importe minimo mayor que maximo'\n          )\n        )\n        NotificationsActions.error(\n          'La cantidad mínima debe ser menor que la máxima.'\n        )\n        return {}\n      }\n      Object.assign(_filters, {\n        [AMOUNT_MIN_KEY]: absAmountMin.toString(),\n        [AMOUNT_MAX_KEY]: absAmountMax.toString()\n      })\n    }\n    if (statusOpen) {\n      Object.assign(_filters, {\n        status\n      })\n    }\n    this.setState({ dataLoading: true, filtersSuccess: false })\n    return _filters\n  }\n\n  clearFilters () {\n    ReactGa.event(createGaEvent('gastos', 'click on button', 'limpiar filtros'))\n    this.setState({ filters: this.data.filters, dataLoading: true })\n  }\n\n  onSearchInvoice () {\n    browserHistory.push(\n      `/gastos/${this.props.route.tab}?sat_folio=${this.state.filters.sat_folio}`\n    )\n  }\n\n  loadData (props = this.props) {\n    const params = Object.assign({}, props.location.query, this.state.sort, {\n      invoice_type:\n        props.route.tab === 'nomina' ? 'payroll_expenses' : 'expenses',\n      stamped: true\n    })\n    InvoicesActions.getInvoices(params)\n    this.setState(prevState => ({\n      filters: Object.assign({}, prevState.filters, params)\n    }))\n  }\n\n  exportTo = format => {\n    const isPayroll = this.props.route.tab === 'nomina'\n    const params = Object.assign({}, this.props.location.query, {\n      invoice_type: isPayroll ? 'payroll_expenses' : 'expenses',\n      stamped: true\n    })\n    const { totalItems } = this.state\n    if (totalItems > 500) {\n      ReactGa.event(createGaEvent('gastos', 'click on disabled button', format))\n    } else if (totalItems < 1) {\n      NotificationsActions.error(EXPORT_ERROR_MESSAGE_1)\n    } else {\n      ReactGa.event(createGaEvent('gastos', 'click on button', format))\n      InvoicesActions.exportInvoices(\n        params,\n        isPayroll ? 'payroll_excel' : format\n      )\n        .then(r => NotificationsActions.success(EXPORT_SUCCESS_MESSAGE))\n        .catch(err => NotificationsActions.error(err))\n    }\n  }\n\n  sortBy (column) {\n    let { sort } = this.state\n    if (sort.sort_by === column) {\n      switch (sort.sort_direction) {\n        case 'asc':\n          sort.sort_direction = 'desc'\n          break\n        case 'desc':\n          sort.sort_direction = 'asc'\n          break\n      }\n    } else {\n      sort = {\n        sort_by: column,\n        sort_direction: 'asc'\n      }\n    }\n    this.setState({ sort }, this.loadData)\n  }\n\n  getIcon (column) {\n    const { sort } = this.state\n    return (\n      <i\n        style={{ fontSize: '1rem' }}\n        className={classNames('mdi', {\n          'mdi-chevron-down': sort.sort_direction === 'desc',\n          'mdi-chevron-up': sort.sort_direction === 'asc',\n          'mdi-unfold-more-horizontal': sort.sort_by !== column\n        })}\n      />\n    )\n  }\n\n  setCategory (id, category) {\n    const invoice = this.state.invoices.find(invoice => invoice.id === id)\n    let successMessage = 'Rubro asignado'\n    if (category === null) {\n      category = { value: null, label: null }\n      successMessage = 'Rubro retirado de la factura'\n      if (invoice.sat_category === null) {\n        this.toggleCategoryModal()\n        return\n      }\n    }\n    API.Invoice.SetCategory(id, { category: { sat_category: category.label } })\n      .then(() => {\n        NotificationsActions.success(successMessage)\n        this.toggleCategoryModal()\n        this.loadData()\n      })\n      .catch(error => {\n        AppSignal.sendError(error)\n        NotificationsActions.error('Error al asignar rubro')\n      })\n  }\n\n  _onChange () {\n    const state = getCurrentState(\n      this.props.route.tab === 'nomina' ? 'payroll_expenses' : 'expenses'\n    )\n    if (this.state.dataLoading) {\n      this.setState({ dataLoading: false, formQuit: false })\n      ReactGa.event(\n        createGaEvent(\n          'gastos',\n          'result',\n          this.props.location.search,\n          state.totalItems\n        )\n      )\n    }\n    this.setState(state)\n  }\n\n  createCategory (id, category) {\n    API.CustomCategories.Create({\n      invoice_category: {\n        name: category.value\n      }\n    })\n      .then(r => {\n        NotificationsActions.success(`Rubro creado: ${r.invoice_category.name}`)\n        this.setCategory(id, category)\n      })\n      .catch(r => {\n        NotificationsActions.error('Falla al crear rubro')\n        console.error(r)\n      })\n  }\n\n  toggleCategoryModal (id, category) {\n    this.setState(prevState => ({\n      modal: Object.assign({}, prevState.modal, {\n        open: !prevState.modal.open,\n        invoiceId: prevState.modal.open ? null : id,\n        invoiceCategory: {\n          value: prevState.modal.open ? null : category,\n          label: prevState.modal.open ? null : category\n        }\n      })\n    }))\n  }\n\n  renderTable () {\n    const entityId = AppStorage.getCurrentEntity().id\n    const { invoices, totalPages, sort } = this.state\n    let renderTable = (\n      <div className='block unselectable'>\n        <p>No hay facturas</p>\n      </div>\n    )\n    if (invoices.length > 0) {\n      let invoicesList = invoices.map(invoice => (\n        <tr key={invoice.id}>\n          <td className='align-left'>\n            <Link to={`/facturas/ver/${invoice.id}`}>{invoice.legal_name}</Link>\n          </td>\n          <td className='align-right table--actions'>\n            {invoice.payment_status !== 'cancelled'\n              ? invoice.sat_category\n              : null}\n            &nbsp;&nbsp;&nbsp;\n            <IconButton\n              icon='pencil'\n              tooltip='Modificar rubro'\n              onClick={this.toggleCategoryModal.bind(\n                this,\n                invoice.id,\n                invoice.sat_category\n              )}\n              disabled={isDisabledInvoiceLabeling(invoice.payment_status)}\n            />\n          </td>\n          <td className='nowrap'>\n            {invoice.issue_date\n              ? prettyDate(invoice.issue_date, false, true, false, '/')\n              : ''}\n          </td>\n          <td className='is-money'>\n            {accounting.formatMoney(invoice.subtotal, '', 2)}\n          </td>\n          <td className='is-money'>\n            {accounting.formatMoney(invoice.total, '', 2)}\n          </td>\n          <td>\n            <StatusIcon\n              className={INVOICE_PAYMENT_STATUS[invoice.payment_status]}\n            />\n          </td>\n          <td className='table--actions flex-center'>\n            <a\n              onClick={() => {\n                ReactGa.event(\n                  createGaEvent('gastos', 'click on button', 'Descargar PDF')\n                )\n              }}\n              href={`${process.env.API_SERVER}${process.env.API_PREFIX}/pdfs/${invoice.id}/${entityId}`}\n              download\n            >\n              <IconButton icon='file-pdf' tooltip='Descargar PDF' />\n            </a>\n            {invoice.version === '3.3' && invoice.payroll && (\n              <Link to={`/facturas_de_nomina/nueva?invoice=${invoice.id}`}>\n                <IconButton icon='autorenew' tooltip='Reemitir factura' />\n              </Link>\n            )}\n          </td>\n        </tr>\n      ))\n      renderTable = (\n        <div>\n          <table className='table is-sortable'>\n            <thead>\n              <tr>\n                <th\n                  className={classNames('align-left', {\n                    'is-sorting': sort.sort_by === 'legal_name'\n                  })}\n                  onClick={this.sortBy.bind(this, 'legal_name')}\n                >\n                  Razón social {this.getIcon('legal_name')}\n                </th>\n                <th style={{ width: '8rem' }}>Rubro</th>\n                <th\n                  className={classNames({\n                    'is-sorting': sort.sort_by === 'issue_date'\n                  })}\n                  onClick={this.sortBy.bind(this, 'issue_date')}\n                  style={{ width: '8rem' }}\n                >\n                  Fecha {this.getIcon('issue_date')}\n                </th>\n                <th\n                  className={classNames('is-money', {\n                    'is-sorting': sort.sort_by === 'subtotal_cents'\n                  })}\n                  onClick={this.sortBy.bind(this, 'subtotal_cents')}\n                  style={{ width: '10rem' }}\n                >\n                  Subtotal {this.getIcon('subtotal_cents')}\n                </th>\n                <th\n                  className={classNames('is-money', {\n                    'is-sorting': sort.sort_by === 'total_cents'\n                  })}\n                  onClick={this.sortBy.bind(this, 'total_cents')}\n                  style={{ width: '10rem' }}\n                >\n                  Total {this.getIcon('total_cents')}\n                </th>\n                <th style={{ width: '5rem' }}>Estado</th>\n              </tr>\n            </thead>\n            <tbody>{invoicesList}</tbody>\n          </table>\n          <Paginator\n            onPageChanged={page =>\n              ReactGa.event(createGaEvent('gastos', 'page changed', '', page))\n            }\n            totalPages={totalPages}\n            location={this.props.location}\n          />\n        </div>\n      )\n    }\n    return renderTable\n  }\n\n  // Render category selector modal\n  renderCategorySelector () {\n    const { open, invoiceId } = this.state.modal\n    const select = open ? (\n      <AsyncCreatable\n        value={this.state.modal.invoiceCategory}\n        loadOptions={debouncedFetch}\n        clearable\n        placeholder='Selecciona un rubro'\n        loadingPlaceholder='Buscando'\n        searchPromptText='Buscar un rubro'\n        noResultsText='No encontrado'\n        promptTextCreator={label => `Crear rubro: ${label}`}\n        onChange={this.setCategory.bind(this, invoiceId)}\n        onNewOptionClick={this.createCategory.bind(this, invoiceId)}\n        ignoreAccents={false}\n        openOnFocus\n      />\n    ) : null\n    return (\n      <Modal\n        title='Rubro'\n        isActive={open}\n        toggleModal={this.toggleCategoryModal.bind(this)}\n        noFooter\n      >\n        <div className='espacio-xxlarge'>\n          {select}\n          <br />\n          <br />\n          <br />\n          <br />\n          <br />\n        </div>\n      </Modal>\n    )\n  }\n\n  renderLegalName () {\n    return (\n      <TextField\n        placeholder='Razón Social'\n        value={this.state.filters.legalName}\n        onChange={this.onChangeFilter.bind(this, 'legalName')}\n      />\n    )\n  }\n\n  renderRfc () {\n    return (\n      <TextField\n        placeholder='RFC'\n        value={this.state.filters.rfc}\n        onChange={this.onChangeFilter.bind(this, 'rfc')}\n      />\n    )\n  }\n\n  renderCategory () {\n    return (\n      <SelectField\n        placeholder='Rubro'\n        options={FORMATTED_SAT_CATEGORIES}\n        value={this.state.category}\n        onChange={this.onChangeFilter.bind(this, 'category')}\n      />\n    )\n  }\n\n  renderDates () {\n    const { datesOpen, filters } = this.state\n    return (\n      <div className='flex-column'>\n        <button\n          onClick={this.toggleFiltersOpen.bind(this, 'datesOpen')}\n          style={{ cursor: 'pointer' }}\n          className='subtitle-body flex-between'\n        >\n          Periodo\n          <i\n            className={classNames('mdi', {\n              'mdi-plus': !datesOpen,\n              'mdi-minus': datesOpen\n            })}\n          />\n        </button>\n        <div className={classNames({ 'is-hidden': !datesOpen })}>\n          <Datepicker\n            label='Del'\n            placeholder='Fecha inicio'\n            value={filters.startDate}\n            onChange={this.onChangeFilter.bind(this, 'startDate')}\n          />\n          <Datepicker\n            label='Al'\n            placeholder='Fecha fin'\n            value={filters.endDate}\n            onChange={this.onChangeFilter.bind(this, 'endDate')}\n          />\n        </div>\n      </div>\n    )\n  }\n\n  renderAmount () {\n    const { amountOpen, filters } = this.state\n    return (\n      <div>\n        <button\n          onClick={this.toggleFiltersOpen.bind(this, 'amountOpen')}\n          style={{ cursor: 'pointer' }}\n          className='subtitle-body flex-between'\n        >\n          Importe\n          <i\n            className={classNames('mdi', {\n              'mdi-plus': !amountOpen,\n              'mdi-minus': amountOpen\n            })}\n          />\n        </button>\n        <div\n          className={classNames('control flex-column', {\n            'is-hidden': !amountOpen\n          })}\n        >\n          <label className='radio' htmlFor='subtotal'>\n            <input\n              id='subtotal'\n              type='radio'\n              value='subtotal'\n              onChange={this.onChangeFilter.bind(this, 'amountType')}\n              checked={filters.amountType === 'subtotal'}\n            />\n            &nbsp;Subtotal\n          </label>\n          <label className='radio is-marginless' htmlFor='total'>\n            <input\n              id='total'\n              type='radio'\n              value='total'\n              onChange={this.onChangeFilter.bind(this, 'amountType')}\n              checked={filters.amountType === 'total'}\n            />\n            &nbsp;Total\n          </label>\n          <TextField\n            label='Desde'\n            placeholder='0.00'\n            value={filters.amountMin}\n            onChange={this.onChangeFilter.bind(this, 'amountMin')}\n            onBlur={this.formatAmount.bind(this, 'amountMin')}\n            onFocus={this.unformatAmount.bind(this, 'amountMin')}\n            selectAllOnFocus\n          />\n          <TextField\n            label='Hasta'\n            placeholder='0.00'\n            value={filters.amountMax}\n            onChange={this.onChangeFilter.bind(this, 'amountMax')}\n            onBlur={this.formatAmount.bind(this, 'amountMax')}\n            onFocus={this.unformatAmount.bind(this, 'amountMax')}\n            selectAllOnFocus\n          />\n        </div>\n      </div>\n    )\n  }\n\n  renderStatusFilter ({ value, label, className = '' }) {\n    const { filters } = this.state\n    const { tab } = this.props.route\n    return (\n      <label\n        key={`status-${value}`}\n        className={`radio ${className}`}\n        htmlFor='filterButton'\n      >\n        <input\n          id='filterButton'\n          type='radio'\n          onChange={this.onChangeFilter.bind(this, 'status')}\n          checked={filters.status === value}\n          value={value}\n        />\n        &nbsp;\n        {label[tab] ? label[tab] : label.default}\n      </label>\n    )\n  }\n\n  renderStatus () {\n    const { statusOpen } = this.state\n    return (\n      <div className='flex-column'>\n        <button\n          onClick={this.toggleFiltersOpen.bind(this, 'statusOpen')}\n          style={{ cursor: 'pointer' }}\n          className='subtitle-body flex-between'\n        >\n          Estado\n          <i\n            className={classNames('mdi', {\n              'mdi-plus': !statusOpen,\n              'mdi-minus': statusOpen\n            })}\n          />\n        </button>\n        <div\n          className={classNames('control flex-column', {\n            'is-hidden': !statusOpen\n          })}\n        >\n          {STATUS_FILTERS.map(this.renderStatusFilter.bind(this))}\n        </div>\n      </div>\n    )\n  }\n\n  renderExportButton ({ icon, label, format }) {\n    const { totalItems, remainingDownloads, updatePlanModal } = this.state\n    const disabledExfolioportButton = totalItems > 500\n    const noMoreDowloads =\n      remainingDownloads === 0 && format === 'invoice_excel'\n\n    return (\n      <ExportButton\n        totalItems={totalItems}\n        label={label}\n        key={label}\n        disabled={disabledExfolioportButton}\n        icon={icon}\n        onClick={\n          noMoreDowloads\n            ? () =>\n              toggleUpdatePlanModal(this, updatePlanModal, 'descargas de PDF')\n            : () => this.exportTo(format)\n        }\n      />\n    )\n  }\n\n  render () {\n    const {\n      totalItems,\n      remainingDownloads,\n      filters,\n      showBannerExpenses,\n      showBannerModal\n    } = this.state\n    const { showBannerExpense } = windowGlobal.localStorage\n    const plan = getClientsPlan()\n    const showEmailCounter =\n      plan === 'free' && showBannerExpense !== 'seen' && showBannerExpenses\n    return (\n      <Fragment>\n        <CredentialsExpire fiel />\n        <div className='flex-between'>\n          <h1 className='headline'>Gastos</h1>\n          <div className='flex-column' style={{ display: 'inline-block' }}>\n            {EXPORT_BUTTONS.map(this.renderExportButton.bind(this))}\n            <p\n              className={classNames('caption', {\n                'is-hidden': totalItems < 500\n              })}\n              style={{ padding: '0.5rem 1rem' }}\n            >\n              (Se debe aplicar un filtro para poder exportar las facturas)\n            </p>\n          </div>\n        </div>\n        <Card\n          title={[\n            { id: 'regulares', label: 'Regulares' },\n            { id: 'nomina', label: 'Nomina' }\n          ]}\n          searchbar={{\n            value: filters.sat_folio,\n            placeholder: 'Buscar por Folio Fiscal',\n            onEnter: this.onSearchInvoice.bind(this),\n            onChange: this.onChangeFilter.bind(this, 'sat_folio')\n          }}\n          activeTab={this.props.route.tab}\n          baseUrl='/gastos'\n          onTabSwitch={this.onChangeTab.bind(this)}\n        >\n          <TableFilter\n            onOpenFilters={() => {\n              ReactGa.event(\n                createGaEvent(\n                  'gastos',\n                  'click on button',\n                  'filtrar tabla toggle'\n                )\n              )\n              this.setState({ formQuit: true })\n            }}\n            baseUrl={`/gastos/${this.props.route.tab}`}\n            filters={filters}\n            prepareFilters={this.prepareFilters.bind(this)}\n            onClearFilters={this.clearFilters.bind(this)}\n          >\n            {this.renderLegalName()}\n            {this.renderRfc()}\n            {this.renderDates()}\n            {this.renderAmount()}\n            {this.renderStatus()}\n          </TableFilter>\n          {showEmailCounter && (\n            <Banner\n              color={'blue'}\n              buttonText={'Mejora tu plan'}\n              text={textIncomes(remainingDownloads)}\n              controlBanner={() =>\n                toggleBanner(this, showBannerExpenses, 'showBannerExpense')\n              }\n              bannerAction={() => toggleBannerModal(this, showBannerModal)}\n            />\n          )}\n          <div className='flex-between' style={{ paddingBottom: '1rem' }}>\n            <div className='caption'>\n              {accounting.formatNumber(totalItems)} facturas visibles\n            </div>\n            <div className='caption'>\n              <span style={{ marginLeft: '1.6rem' }}>\n                <StatusIcon className='warning' />\n                Por pagar\n              </span>\n              <span style={{ marginLeft: '1.6rem' }}>\n                <StatusIcon className='info' />\n                Pagada parcialmente\n              </span>\n              <span style={{ marginLeft: '1.6rem' }}>\n                <StatusIcon className='success' />\n                Pagada\n              </span>\n              <span style={{ marginLeft: '1.6rem' }}>\n                <StatusIcon className='danger' />\n                Cancelada\n              </span>\n            </div>\n          </div>\n          {this.renderTable()}\n        </Card>\n        {this.renderCategorySelector()}\n        {modalPlans(this)}\n        {modalUpdatePlan(this)}\n      </Fragment>\n    )\n  }\n}\n\nExpense.propTypes = {\n  route: PropTypes.shape({\n    tab: PropTypes.number\n  }),\n  location: PropTypes.shape({\n    search: PropTypes.object,\n    query: PropTypes.object\n  })\n}\n\nexport default Expense\n"]},"metadata":{},"sourceType":"module"}