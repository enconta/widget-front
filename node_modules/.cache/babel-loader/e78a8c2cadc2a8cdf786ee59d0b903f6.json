{"ast":null,"code":"var _jsxFileName = \"/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/viewInvoice/payments/index.js\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport accounting from 'accounting';\nimport classNames from 'classnames';\nimport _isNil from 'lodash/isNil';\nimport { Link, browserHistory } from 'react-router';\nimport AppSignal from 'appsignal'; // Components\n\nimport API from 'api';\nimport NotificationsActions from 'actions/notifications';\nimport StatusLabel from 'shared/statusLabel';\nimport IconButton from 'shared/iconButton';\nimport Button from 'shared/button';\nimport { prettyDate } from 'utils';\nvar PAYMENT_STATUS = ['pending_payment', 'partially_paid', 'cancelled', 'paid'];\n\nvar deletePayment = function deletePayment(paymentId, getInvoice) {\n  API.Payments.Delete(paymentId).then(function (r) {\n    getInvoice();\n    NotificationsActions.success('El pago fue borrado correctamente');\n  }).catch(function (error) {\n    AppSignal.sendError(error);\n    NotificationsActions.error(error);\n  });\n};\n\nvar showPaymentSupplement = function showPaymentSupplement(invoiceID) {\n  browserHistory.push(\"/facturas/ver/\".concat(invoiceID));\n};\n\nvar Payment = function Payment(_ref) {\n  var payment = _ref.payment,\n      toggleModal = _ref.toggleModal,\n      getInvoice = _ref.getInvoice;\n  return React.createElement(\"tr\", {\n    key: payment.id,\n    className: \"hover-row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    className: \"flex-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41\n    },\n    __self: this\n  }, prettyDate(payment.paid_on, '', true, false, '-'), !payment.invoice_payment_id && React.createElement(IconButton, {\n    icon: \"information-outline\",\n    tooltip: \"Creado por el cliente\",\n    className: \"aligned--icon-rigth\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44\n    },\n    __self: this\n  })), React.createElement(\"td\", {\n    className: \"has-text-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51\n    },\n    __self: this\n  }, accounting.formatMoney(payment.amount_cents / 100, '$ ')), payment.invoice_payment_id ? React.createElement(\"td\", {\n    className: payment.invoice_payment_id ? 'is-clickable' : '',\n    onClick: function onClick() {\n      return showPaymentSupplement(payment.invoice_payment_id);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/facturas/ver/\".concat(payment.invoice_payment_id),\n    className: \"hover-link\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }, \"Ver\")) : React.createElement(\"td\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67\n    },\n    __self: this\n  }, React.createElement(IconButton, {\n    icon: \"pencil\",\n    tooltip: \"Editar registro\",\n    onClick: function onClick() {\n      toggleModal(payment.id);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68\n    },\n    __self: this\n  }), React.createElement(IconButton, {\n    icon: \"delete\",\n    tooltip: \"Eliminar registro\",\n    onClick: function onClick() {\n      deletePayment(payment.id, getInvoice);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  })));\n};\n\nvar getTotalPaid = function getTotalPaid(_ref2) {\n  var payments = _ref2.payments;\n  var total = payments.reduce(function (total, _ref3) {\n    var amount = _ref3.amount_cents;\n    return total + amount;\n  }, 0);\n  return total;\n};\n\nvar PaymentsTable = function PaymentsTable(_ref4) {\n  var invoice = _ref4.invoice,\n      toggleModal = _ref4.toggleModal,\n      type = _ref4.type,\n      getInvoice = _ref4.getInvoice;\n  var payments = React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    colSpan: 4,\n    className: \"caption\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, \"No hay \", type === 0 ? 'cobros' : 'pagos', \" registrados\"));\n  var paidTotal = 0;\n  var outstandingAmount = 0;\n\n  if (invoice.payments && invoice.payments.length > 0) {\n    paidTotal = getTotalPaid(invoice);\n    outstandingAmount = invoice.total_cents - paidTotal;\n    payments = invoice.payments.map(function (payment) {\n      return React.createElement(Payment, {\n        payment: payment,\n        toggleModal: toggleModal,\n        getInvoice: getInvoice,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      });\n    });\n  }\n\n  return React.createElement(\"table\", {\n    className: \"paytable\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, React.createElement(\"thead\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, React.createElement(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, \"Fecha\"), React.createElement(\"th\", {\n    className: \"has-text-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, \"Importe\"), React.createElement(\"th\", {\n    className: \"align-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }))), React.createElement(\"tbody\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, payments, React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    colSpan: 3,\n    className: \"paid-amount-separator\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  })), React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    colSpan: 2,\n    className: \"has-text-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    className: \"total-to-pay\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"total-to-pay__amount total-to-pay__amount--normal\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }, accounting.formatMoney(paidTotal / 100, '$ ')), React.createElement(\"span\", {\n    className: \"total-to-pay__label\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, \"Total pagado\")))), outstandingAmount > 0 && React.createElement(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140\n    },\n    __self: this\n  }, React.createElement(\"td\", {\n    colSpan: 2,\n    className: \"outstanding-amount\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    className: \"body body--grey-darker\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, \"Resta por pagar: \".concat(accounting.formatMoney(outstandingAmount / 100, '$ ')))))));\n};\n\nvar Payments = function Payments(props) {\n  return React.createElement(\"div\", {\n    className: \"column\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    className: \"subheader-green\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, \"Informaci\\xF3n de \", props.type === 0 ? 'cobro' : 'pago'), React.createElement(\"div\", {\n    className: \"columns is-multiline\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"column\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    className: \"caption\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, \"Monto por \", props.type === 0 ? 'cobrar' : 'pagar', \":\"), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    className: \"body-bold\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, accounting.formatMoney(props.invoice.total_cents / 100, '$ '))), React.createElement(\"div\", {\n    className: classNames('column', {\n      'is-hidden': _isNil(props.invoice.currency)\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    className: \"caption\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, \"Moneda:\"), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    className: \"body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, props.invoice.currency)), React.createElement(\"div\", {\n    className: classNames('column', {\n      'is-hidden': _isNil(props.invoice.exchange_rate)\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    className: \"caption\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, \"Tipo de cambio:\"), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    className: \"body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187\n    },\n    __self: this\n  }, accounting.formatMoney(props.invoice.exchange_rate, ''))), React.createElement(\"div\", {\n    className: classNames('column', {\n      'is-hidden': _isNil(props.invoice.payment_status)\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    className: \"caption\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }, \"Estado:\"), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }), React.createElement(\"span\", {\n    className: \"body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }, React.createElement(StatusLabel, {\n    status: PAYMENT_STATUS[props.invoice.payment_status],\n    type: props.invoice.type === 0 ? 'income' : 'expense',\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199\n    },\n    __self: this\n  })))), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }), React.createElement(PaymentsTable, Object.assign({}, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  })), React.createElement(Button, {\n    className: classNames({\n      'is-hidden': props.invoice.payment_status === '3'\n    }),\n    buttonStyle: \"primaryLink\",\n    icon: \"plus\",\n    onClick: function onClick() {\n      props.toggleModal();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }, \"Registrar \".concat(props.type === 0 ? 'cobro' : 'pago')));\n};\n\nexport default Payments;\nPayments.propTypes = {\n  invoice: PropTypes.object.isRequired,\n  toggleModal: PropTypes.func,\n  getInvoice: PropTypes.func,\n  type: PropTypes.number\n};\nPayment.propTypes = {\n  payment: PropTypes.object,\n  toggleModal: PropTypes.func,\n  getInvoice: PropTypes.func\n};\nPayments.defaultProps = {\n  toggleModal: function toggleModal() {},\n  getInvoice: function getInvoice() {}\n};\nPaymentsTable.propTypes = {\n  invoice: PropTypes.object,\n  toggleModal: PropTypes.func,\n  type: PropTypes.number,\n  getInvoice: PropTypes.func\n};","map":{"version":3,"sources":["/Users/usuario-rtd/Desktop/widget-front/src/components/app/views/viewInvoice/payments/index.js"],"names":["React","PropTypes","accounting","classNames","_isNil","Link","browserHistory","AppSignal","API","NotificationsActions","StatusLabel","IconButton","Button","prettyDate","PAYMENT_STATUS","deletePayment","paymentId","getInvoice","Payments","Delete","then","r","success","catch","error","sendError","showPaymentSupplement","invoiceID","push","Payment","payment","toggleModal","id","paid_on","invoice_payment_id","formatMoney","amount_cents","getTotalPaid","payments","total","reduce","amount","PaymentsTable","invoice","type","paidTotal","outstandingAmount","length","total_cents","map","props","currency","exchange_rate","payment_status","propTypes","object","isRequired","func","number","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport accounting from 'accounting'\nimport classNames from 'classnames'\nimport _isNil from 'lodash/isNil'\nimport { Link, browserHistory } from 'react-router'\nimport AppSignal from 'appsignal'\n\n// Components\nimport API from 'api'\nimport NotificationsActions from 'actions/notifications'\nimport StatusLabel from 'shared/statusLabel'\nimport IconButton from 'shared/iconButton'\nimport Button from 'shared/button'\nimport { prettyDate } from 'utils'\n\nconst PAYMENT_STATUS = [\n  'pending_payment',\n  'partially_paid',\n  'cancelled',\n  'paid'\n]\n\nconst deletePayment = (paymentId, getInvoice) => {\n  API.Payments.Delete(paymentId)\n    .then(r => {\n      getInvoice()\n      NotificationsActions.success('El pago fue borrado correctamente')\n    })\n    .catch(error => {\n      AppSignal.sendError(error)\n      NotificationsActions.error(error)\n    })\n}\n\nconst showPaymentSupplement = invoiceID => {\n  browserHistory.push(`/facturas/ver/${invoiceID}`)\n}\nconst Payment = ({ payment, toggleModal, getInvoice }) => (\n  <tr key={payment.id} className='hover-row'>\n    <td className='flex-center'>\n      {prettyDate(payment.paid_on, '', true, false, '-')}\n      {!payment.invoice_payment_id && (\n        <IconButton\n          icon='information-outline'\n          tooltip='Creado por el cliente'\n          className='aligned--icon-rigth'\n        />\n      )}\n    </td>\n    <td className='has-text-right'>\n      {accounting.formatMoney(payment.amount_cents / 100, '$ ')}\n    </td>\n    {payment.invoice_payment_id ? (\n      <td\n        className={payment.invoice_payment_id ? 'is-clickable' : ''}\n        onClick={() => showPaymentSupplement(payment.invoice_payment_id)}\n      >\n        <Link\n          to={`/facturas/ver/${payment.invoice_payment_id}`}\n          className='hover-link'\n        >\n          Ver\n        </Link>\n      </td>\n    ) : (\n      <td>\n        <IconButton\n          icon='pencil'\n          tooltip='Editar registro'\n          onClick={() => {\n            toggleModal(payment.id)\n          }}\n        />\n        <IconButton\n          icon='delete'\n          tooltip='Eliminar registro'\n          onClick={() => {\n            deletePayment(payment.id, getInvoice)\n          }}\n        />\n      </td>\n    )}\n  </tr>\n)\nconst getTotalPaid = ({ payments }) => {\n  const total = payments.reduce(\n    (total, { amount_cents: amount }) => total + amount,\n    0\n  )\n  return total\n}\n\nconst PaymentsTable = ({ invoice, toggleModal, type, getInvoice }) => {\n  let payments = (\n    <tr>\n      <td colSpan={4} className='caption'>\n        No hay {type === 0 ? 'cobros' : 'pagos'} registrados\n      </td>\n    </tr>\n  )\n  let paidTotal = 0\n  let outstandingAmount = 0\n  if (invoice.payments && invoice.payments.length > 0) {\n    paidTotal = getTotalPaid(invoice)\n    outstandingAmount = invoice.total_cents - paidTotal\n    payments = invoice.payments.map(payment => (\n      <Payment\n        payment={payment}\n        toggleModal={toggleModal}\n        getInvoice={getInvoice}\n      />\n    ))\n  }\n  return (\n    <table className='paytable'>\n      <thead>\n        <tr>\n          <th>Fecha</th>\n          <th className='has-text-right'>Importe</th>\n          <th className='align-center' />\n        </tr>\n      </thead>\n      <tbody>\n        {payments}\n        <tr>\n          <td colSpan={3} className='paid-amount-separator' />\n        </tr>\n        <tr>\n          <td colSpan={2} className='has-text-right'>\n            <p className='total-to-pay'>\n              <span className='total-to-pay__amount total-to-pay__amount--normal'>\n                {accounting.formatMoney(paidTotal / 100, '$ ')}\n              </span>\n              <span className='total-to-pay__label'>Total pagado</span>\n            </p>\n          </td>\n        </tr>\n        {outstandingAmount > 0 && (\n          <tr>\n            <td colSpan={2} className='outstanding-amount'>\n              <p className='body body--grey-darker'>\n                {`Resta por pagar: ${accounting.formatMoney(\n                  outstandingAmount / 100,\n                  '$ '\n                )}`}\n              </p>\n            </td>\n          </tr>\n        )}\n      </tbody>\n    </table>\n  )\n}\n\nconst Payments = props => (\n  <div className='column'>\n    <h2 className='subheader-green'>\n      Información de {props.type === 0 ? 'cobro' : 'pago'}\n    </h2>\n    <div className='columns is-multiline'>\n      <div className='column'>\n        <label className='caption'>\n          Monto por {props.type === 0 ? 'cobrar' : 'pagar'}:\n        </label>\n        <br />\n        <span className='body-bold'>\n          {accounting.formatMoney(props.invoice.total_cents / 100, '$ ')}\n        </span>\n      </div>\n      <div\n        className={classNames('column', {\n          'is-hidden': _isNil(props.invoice.currency)\n        })}\n      >\n        <label className='caption'>Moneda:</label>\n        <br />\n        <span className='body'>{props.invoice.currency}</span>\n      </div>\n      <div\n        className={classNames('column', {\n          'is-hidden': _isNil(props.invoice.exchange_rate)\n        })}\n      >\n        <label className='caption'>Tipo de cambio:</label>\n        <br />\n        <span className='body'>\n          {accounting.formatMoney(props.invoice.exchange_rate, '')}\n        </span>\n      </div>\n      <div\n        className={classNames('column', {\n          'is-hidden': _isNil(props.invoice.payment_status)\n        })}\n      >\n        <label className='caption'>Estado:</label>\n        <br />\n        <span className='body'>\n          <StatusLabel\n            status={PAYMENT_STATUS[props.invoice.payment_status]}\n            type={props.invoice.type === 0 ? 'income' : 'expense'}\n          />\n        </span>\n      </div>\n    </div>\n    <br />\n    <PaymentsTable {...props} />\n    <Button\n      className={classNames({\n        'is-hidden': props.invoice.payment_status === '3'\n      })}\n      buttonStyle='primaryLink'\n      icon='plus'\n      onClick={() => {\n        props.toggleModal()\n      }}\n    >{`Registrar ${props.type === 0 ? 'cobro' : 'pago'}`}</Button>\n  </div>\n)\n\nexport default Payments\n\nPayments.propTypes = {\n  invoice: PropTypes.object.isRequired,\n  toggleModal: PropTypes.func,\n  getInvoice: PropTypes.func,\n  type: PropTypes.number\n}\n\nPayment.propTypes = {\n  payment: PropTypes.object,\n  toggleModal: PropTypes.func,\n  getInvoice: PropTypes.func\n}\n\nPayments.defaultProps = {\n  toggleModal: () => {},\n  getInvoice: () => {}\n}\n\nPaymentsTable.propTypes = {\n  invoice: PropTypes.object,\n  toggleModal: PropTypes.func,\n  type: PropTypes.number,\n  getInvoice: PropTypes.func\n}\n"]},"metadata":{},"sourceType":"module"}